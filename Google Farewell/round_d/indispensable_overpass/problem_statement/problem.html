
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Coding Competitions Farewell Rounds - Round D</h3><h1>Indispensable Overpass</h1><h3>Problem</h3>
<p>
A modern railroad system built in Ekiya's town bumped into a major hurdle: the main freeway
running north to south. $$$\mathbf{W}$$$ stations have already been built and connected
on the western side of the freeway and $$$\mathbf{E}$$$ on the eastern side. One more connection is needed
between a western and an eastern station, but because the freeway is in the way,
that connection needs to be built using an overpass.
</p><p>
Ekiya is assessing which stations would be most convenient to connect with the overpass. As part
of that assessment, she wants to know how the average length (in number of stations) of a path
within the system might change with each possible option.
</p><p>
A path between stations $$$s$$$ and $$$t$$$ is a list of distinct
stations that starts with $$$s$$$, ends with $$$t$$$, and such that any two consecutive stations
on the list share a connection.
The railroad system currently has $$$\mathbf{W}$$$ stations on the western side, connected through $$$\mathbf{W}-1$$$
connections such that there is exactly one path between any two distinct western stations.
Similarly, there are $$$\mathbf{E}$$$ eastern stations connected through $$$\mathbf{E}-1$$$ connections such that
there is exactly one path between any two distinct eastern stations.
After the overpass connection is built connecting one western and one eastern station,
there will be exactly one path between any two distinct stations.
</p><p>
A complete map is a map that has $$$\mathbf{W}+\mathbf{E}-1$$$ total connections and exactly one
path between any pair of stations. The average distance of a complete map is the average
of the length of paths between all pairs of different stations. The length of a path is one less
than the length of the list of stations that defines it (e.g., the path between directly connected
stations has a length of $$$1$$$).
</p><p>
As an example, the picture below illustrates a scenario with $$$\mathbf{W} = 2$$$ stations on the west
side and $$$\mathbf{E} = 3$$$ stations on the east side. There are $$$2$$$ possible overpasses shown.
</p><p style="text-align: center;">
<img src="img/sample_1.png" alt="Illustration of Sample Case #1"/>
</p><p>
This table shows the lengths of the paths between pairs of stations if each overpass were to be built.
</p>
<style>
table { border-collapse: collapse; }
td, th { border: 1px solid black; padding: 2px; text-align: center; }
</style>
<table>
<tr><th style="border: 0;"></th><th style="border: 0;"></th><th>$$$\color{darkred}{\mathbf{1 \leftrightarrow 1}}$$$</th><th>$$$\color{darkblue}{\mathbf{2 \leftrightarrow 3}}$$$</th></tr>
<tr><td>West $$$1$$$</td><td>West $$$2$$$</td><td>$$$1$$$</td><td>$$$1$$$</td></tr>
<tr><td>West $$$1$$$</td><td>East $$$1$$$</td><td>$$$1$$$</td><td>$$$3$$$</td></tr>
<tr><td>West $$$1$$$</td><td>East $$$2$$$</td><td>$$$3$$$</td><td>$$$3$$$</td></tr>
<tr><td>West $$$1$$$</td><td>East $$$3$$$</td><td>$$$2$$$</td><td>$$$2$$$</td></tr>
<tr><td>West $$$2$$$</td><td>East $$$1$$$</td><td>$$$2$$$</td><td>$$$2$$$</td></tr>
<tr><td>West $$$2$$$</td><td>East $$$2$$$</td><td>$$$4$$$</td><td>$$$2$$$</td></tr>
<tr><td>West $$$2$$$</td><td>East $$$3$$$</td><td>$$$3$$$</td><td>$$$1$$$</td></tr>
<tr><td>East $$$1$$$</td><td>East $$$2$$$</td><td>$$$2$$$</td><td>$$$2$$$</td></tr>
<tr><td>East $$$1$$$</td><td>East $$$3$$$</td><td>$$$1$$$</td><td>$$$1$$$</td></tr>
<tr><td>East $$$2$$$</td><td>East $$$3$$$</td><td>$$$1$$$</td><td>$$$1$$$</td></tr>
<tr><td style="border: 0;"></td><th>Average:</th><td>$$$2$$$</td><td>$$$1.8$$$</td></tr>
</table><p>
Given the current stations and connections, and a list of options for the overpass connection,
help Ekiya by calculating the average distance of the map that would result if that option was
the only overpass connection built.
</p>

<h3>Input</h3>
<p>
The first line of the input gives the number of test cases, $$$\mathbf{T}$$$. $$$\mathbf{T}$$$ test cases follow.
Each test case starts with a line with three integers $$$\mathbf{W}$$$, $$$\mathbf{E}$$$, and $$$\mathbf{C}$$$, the number of western
and eastern stations, and the number of options for the overpass connection, respectively.
Western stations are numbered between $$$1$$$ and $$$\mathbf{W}$$$ and eastern connections are numbered
between $$$1$$$ and $$$\mathbf{E}$$$.
</p><p>
The second line of a test case contains $$$\mathbf{W}-1$$$ integers $$$\mathbf{X_1}, \mathbf{X_2}, \dots, \mathbf{X_{W-1}}$$$
representing that the $$$i$$$-th existing connection among western stations connects western
stations $$$i$$$ and $$$\mathbf{X_i}$$$.
</p><p>
The third line of a test case contains $$$\mathbf{E}-1$$$ integers $$$\mathbf{F_1}, \mathbf{F_2}, \dots, \mathbf{F_{E-1}}$$$
representing that the $$$j$$$-th existing connection among eastern stations connects eastern
stations $$$j$$$ and $$$\mathbf{F_j}$$$.
</p><p>
Finally, the last $$$\mathbf{C}$$$ lines of a test case describe the options for the overpass connection.
The $$$k$$$-th of these lines contains two integers $$$\mathbf{A_k}$$$ and $$$\mathbf{B_k}$$$ representing the western and
eastern stations, respectively, that the $$$k$$$-th option for an overpass connection would connect.
</p>

<h3>Output</h3>
<p>
For each test case, output one line containing
<code>Case #$$$x$$$: $$$y_1 ~ y_2 ~ \cdots ~ y_{\mathbf{C}}$$$</code>,
where $$$x$$$ is the test case number (starting from 1) and $$$y_k$$$ is the average distance of
the map resulting in adding the $$$k$$$-th option as an overpass connection to all existing
connections.
<p><code>$$$y_1$$$</code>, <code>$$$y_2$$$</code>, <code>$$$\dots$$$</code> and <code>$$$y_k$$$</code> will be considered correct if they are within an
absolute or relative error of $$$10^{-6}$$$ of the correct answer. See the
<a href="/codejamio/faq#competing">FAQ</a>
for an explanation of what that means, and what formats of real numbers
we accept.</p>
</p>

<h3>Limits</h3>
<p>
Memory limit: 2 GB.<br/>

$$$1 \le \mathbf{T} \le 100$$$.<br/>
$$$2 \le \mathbf{W} \le 10^5$$$.<br/>
$$$2 \le \mathbf{E} \le 10^5$$$.<br/>
$$$i + 1 \le \mathbf{X_i} \le \mathbf{W}$$$, for all $$$i$$$. 
  (This implies that there is exactly one path between each pair of western stations.)<br/>
$$$j + 1 \le \mathbf{F_j} \le \mathbf{E}$$$, for all $$$j$$$.
  (This implies that there is exactly one path between each pair of eastern stations.)<br/>
$$$1 \le \mathbf{A_k} \le \mathbf{W}$$$, for all $$$k$$$.<br/>
$$$1 \le \mathbf{B_k} \le \mathbf{E}$$$, for all $$$k$$$.<br/>
$$$(\mathbf{A_k}, \mathbf{B_k}) \neq (\mathbf{A_\ell}, \mathbf{B_\ell})$$$, for all $$$k \neq \ell$$$. (Each listed overpass
  connection is different.)
</p>

<h4>Test Set 1 (Visible Verdict)</h4>
<p>
Time limit: 20 seconds.<br/>

$$$1 \le \mathbf{C} \le 2$$$.<br/>
</p>

<h4>Test Set 2 (Hidden Verdict)</h4>
<p>
Time limit: 40 seconds.<br/>

$$$1 \le \mathbf{C} \le 10^5$$$.<br/>
</p>


  <h3>Sample</h3>
  <div class="problem-io-wrapper-new">
    <div class="sampleio-wrapper">
      <div class="sample-input">
        <div class="sample-header">
          <div class="sample-header-text">Sample Input</div>
          <div class="sample-header-download-button">
            <a href="indispensable_overpass_sample_ts1_input.txt" target="_blank" aria-label="Download">
              <i class="material-icons grey">save_alt</i>
            </a>
          </div>
          <div class="sample-header-copy-button" onclick="
              const copyText = document.getElementById('sample_input_0').textContent;
              const textArea = document.createElement('textarea');
              textArea.textContent = copyText;
              textArea.style.position = 'absolute';
              textArea.style.left = '-100%';
              document.body.append(textArea);
              textArea.select();
              document.execCommand('copy');
              textArea.remove();
              const copyPopup = document.getElementById('sample_input_copy_popup_0');
              copyPopup.classList.add('sample-header-copy-popup-shown');
              setTimeout(function(){ copyPopup.classList.remove('sample-header-copy-popup-shown'); }, 2000);
          " aria-label="Copy to clipboard">
            <i class="material-icons grey">content_copy</i>
            <span class="sample-header-copy-popup" id="sample_input_copy_popup_0">
              Copied!
            </span>
          </div>
        </div>
        <div class="sample-content">
          <pre class="sample-content-text" id="sample_input_0">3
2 3 2
2
3 3
1 1
2 3
3 4 2
2 3
3 3 4
1 3
1 2
3 4 1
2 3
3 3 4
2 2
</pre>
        </div>
      </div>
      <div class="sample-output">
        <div class="sample-header">
          <div class="sample-header-text">Sample Output</div>
          <div class="sample-header-download-button">
            <a href="indispensable_overpass_sample_ts1_output.txt" target="_blank" aria-label="Download">
              <i class="material-icons grey">save_alt</i>
            </a>
          </div>
          <div class="sample-header-copy-button" onclick="
              const copyText = document.getElementById('sample_output_0').textContent;
              const textArea = document.createElement('textarea');
              textArea.textContent = copyText;
              textArea.style.position = 'absolute';
              textArea.style.left = '-100%';
              document.body.append(textArea);
              textArea.select();
              document.execCommand('copy');
              textArea.remove();
              const copyPopup = document.getElementById('sample_output_copy_popup_0');
              copyPopup.classList.add('sample-header-copy-popup-shown');
              setTimeout(function(){ copyPopup.classList.remove('sample-header-copy-popup-shown'); }, 2000);
          " aria-label="Copy to clipboard">
            <i class="material-icons grey">content_copy</i>
            <span class="sample-header-copy-popup" id="sample_output_copy_popup_0">
              Copied!
            </span>
          </div>
        </div>
        <div class="sample-content">
          <pre class="sample-content-text" id="sample_output_0">Case #1: 2.0 1.8
Case #2: 2.19047619 2.47619048
Case #3: 2.2857142857
</pre>
        </div>
      </div>
    </div>
  </div>


<p>
  Sample Case #1 is explained and illustrated in the problem statement. Sample Case #2 and Sample
  Case #3 are illustrated below.
</p><p style="text-align: center;">
<img src="img/sample_2_and_3.png" alt="Illustration of Sample Case #2 and Sample Case #3 together"/>
</p>

    </div>
  </body>
</html>
