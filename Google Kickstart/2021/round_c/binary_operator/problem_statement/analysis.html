
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Kick Start 2021 - Round C</h3><h1>Analysis: Binary Operator</h1><p>
  For each expression, we could
  <a href="https://en.wikipedia.org/wiki/Binary_expression_tree#Construction_of_an_expression_tree" target-"_blank">
  construct an expression tree</a> for it and consider it as an
  <a href="https://en.wikipedia.org/wiki/Binary_expression_tree" target-"_blank">arthimetric tree</a>,
  with, <code>+, *, #</code> as its operators.
  We can then start trying to reduce the whole tree so that we could compare different expressions
  more easily.
</p>
<h3>
  Test Set 1
</h3>
<p>
  In the first test set, for each expression we could first examine if there is a <code>#</code> in it. If not,
  a simple traversal through the arthimetric tree would give us the value represented by the equation.
  Otherwise, we could start from the node where the operator is <code>#</code>. We can reduce this
  node's left and right subtrees into a single node each by traversing each subtree and calculating
  its value accordingly. This will result in a subtree with leaf values $$$L$$$ and $$$R$$$,
  and root <code>#</code> (i.e. <code>$$$L$$$#$$$R$$$</code> in expression form). Now we have a
  tree where there are only leaf nodes under the single <code>#</code>,
  the next step will be trying to process node <code>#</code>'s ancestors, and ultimately we want to
reduce the whole expression into a general form of <code>($$$A$$$#$$$B$$$)*$$$C$$$+$$$D$$$</code> in order to do further
  categorization. For simplicity we would denote <code>$$$L$$$#$$$R$$$</code> as $$$X$$$ from now on.
</p>
<p>

  We would start try to transform the expression into our desired form from the subtree where $$$X$$$
  is the left leaf. Specifically we want to
  Consider $$$X$$$'s sibling tree, since there is no <code>#</code> in that tree, we could use the
  same traversal method to get its value $$$S$$$. Now consider the parent node of $$$X$$$:
  <ol>
    <li>$$$X$$$'s parent is a <code>+</code>, or $$$X$$$ is the root node: we would reconstruct
      $$$X$$$ into a subtree, where its root node is a $$$*$$$, and its left node being $$$X$$$,
      and right node being $$$1$$$.</li>
    <img src="images/reduction1.png" style="height: 300px;" alt="Reduction example when the parent node is +">

    <li>$$$X$$$'s parent is a <code>*</code>: in this case, we added a $$$+$$$ node as a new parent, and
    the value $$$0$$$ as the new right-sibling $$$S_p$$$.</li>
    <img src="images/reduction2.png" style="height: 300px;" alt="Reduction example when the parent node is *">

  </ol>
  We then consider $$$X$$$'s great-grandparent, and the corresponded reduced sibling $$$S_p'$$$:
  <ol>
    <li>the node is a <code>+</code>, or there is no such node: we could reduce the height of the tree by
    replacing the tree with its left subtree, and substitute the value of its right subtree from $$$S_p$$$
    to $$$S_p + S_p'$$$</li>
    <img src="images/reduction3.png" style="height: 300px;" alt="Reduction example when the grandparent node is +">

    <li>the node is a <code>*</code>: samely, we would reduce the subtree with its left subtree, but this time
    we substitute the value of its right subtree with $$$S_p * S_p'$$$, and also replace $$$X$$$'s sibling
    with $$$S * S_p'$$$</li>
    <img src="images/reduction4.png" style="height: 300px;" alt="Reduction example when the grandparent node is +">

  </ol>
  Notice that, with this process, we could reduce the height of the tree by $$$1$$$ each time, we could then
  perform this reduction process recursively until the expression is irreducible.

</p>
  After the reduction process, the expression would be simplfied into the form of <code>($$$A$$$#$$$B$$$)*$$$C$$$+$$$D$$$</code>,
  where $$$A, B, C, D$$$ are all integers. Therefore the expression can
  be represented by a 4-tuple $$$(A, B, C, D)$$$. We can then use a hashtable or any similar data structure
  to categorize them into different equilavence classes. Note that when $$$C = 0$$$, the only comparator matters
  here will be $$$D$$$ only, since any value of <code>$$$A$$$#$$$B$$$</code> does not affect the value at all.
</p>
<h3>
  Test Set 2
</h3>
<p>
  For the second test set, we could follow the similar solution as mentioned above: reduce the
  expressions, then categorized into different classes. However, this method would become much more
  complicated since there might be more than one <code>#</code> in each expression. As a result, we
  cannot represent each expression as a 4-tuple, and the reduction rules are much more complicated.
  In fact, consider the following expression (not fully parenthesized for the sake of simplicity):
  <div style="text-align:center;">
    <code>((0#1)+1)*((0#2)+1)*((0#3)+1)*$$$\dots$$$ </code>
  </div>
  If we utilize the same denotation in test set 1, naming each expression as $$$x_1, x_2, \dots, x_n$$$,
  this will result in a polynomial with $$$n$$$ variables, and therefore $$$2^n$$$ coeffcients to consider
  in terms of categorization. Luckily, since <code>((0#1)+1)</code> already takes $$$9$$$ characters per block,
  and there is also need to spend additional characters on enclosing brackets and operators, the total number
  of coefficients for any given input string will be small enough to allow such deterministic solution to pass.
</p>
<h4>
Alternative solution
</h4>
<p>
  There is also a simpler nondeterministic approach to this problem. Since the operator <code>#</code>
  represents a total function, for each calculation of some <code>$$$X$$$#$$$Y$$$</code>, we could randomly assign a
  value as the result, and memorize it for further calculation of the same <code>$$$X$$$#$$$Y$$$</code>.
  We could utilize it to calculate the exact value of an expression, then state that two expressions
  belong to the same equivalence class if their corresponding values are the same. This process will never put two
  expressions from the same class into different classes, but may result in a collision that mistakenly puts two
  expressions from different classes into the same class. Unfortunately, we do not have a simple proof that such solution has
  sufficiently small probability of failure. To further decrease the probability of false matches, the
  process can be repeated several times, putting two expressions into the same class only if their evaluations matched every time.
</p>


  <div class="test-data-download-wrapper">
    <div class="test-data-download-header">
      <div class="test-data-download-header-text">Test Data</div>
      <div class="test-data-download-header-download-button">
        <a href="test_data.zip" target="_blank">
          <i class="material-icons grey">save_alt</i>
        </a>
      </div>
    </div>
    <div class="test-data-download-content">
      <div class="test-data-download-warning">
        <span class="material-icons" style="color: grey; vertical-align: middle;">info</span>
        <span style="vertical-align: middle;">We recommend that you practice debugging solutions without looking at the test data.</span>
      </div>
    </div>
  </div>


    </div>
  </body>
</html>
