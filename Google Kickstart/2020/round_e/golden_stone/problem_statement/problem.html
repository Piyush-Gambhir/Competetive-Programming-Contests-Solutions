
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Kick Start 2020 - Round E</h3><h1>Golden Stone</h1><h3>Problem</h3>
<p>
  Leopold's friend Kate likes stones, so he decided to give her a golden stone as a gift. There are
  <b>S</b> types of stones numbered from 1 to <b>S</b>, 1 being the golden stone. Some types of
  stones are available free of charge in various parts of the city. The city consists of <b>N</b>
  junctions numbered from 1 to <b>N</b> and <b>M</b> two-way streets between pairs of distinct
  junctions. At each junction, zero or more types of stones are available in unlimited supply.
</p>
<p>
  Unfortunately, the golden stone is not available anywhere. Luckily, Leopold is a bit of a magician
  and knows how to combine a group of stones and turn them into another stone. For example, one of
  his recipes could produce a golden stone out of one silver stone and two marble stones. He could
  collect those stones in some of the junctions if they are available, or he could use some of
  his many other recipes to produce any of those stones. Formally, Leopold has <b>R</b> recipes,
  where a recipe is in the form (<i>a</i><sub>1</sub>, <i>a</i><sub>2</sub>, ...,
  <i>a<sub>k</sub></i>) -> <i>b</i> for some <i>k</i> &ge; 1. If Leopold has gathered <i>k</i>
  stones of types <i>a</i><sub>1</sub>, <i>a</i><sub>2</sub>, ..., and
  <i>a<sub>k</sub></i> at a certain junction, he can choose to apply the recipe and turn these
  stones into one stone of type <i>b</i>.
</p>

<p>
  Leopold likes puzzles much more than physical activity, therefore, he does not want to carry
  stones around the city unnecessarily. Carrying a stone along a street costs him one unit of
  energy. Leopold can carry no more than one stone at a time, however, he can drop off a stone at
  any junction and pick it up later at any time.
</p>

<p>
  What is the minimum amount of energy Leopold must spend to produce one golden stone?
  Leopold is very scared of large numbers. If the answer is greater than or equal to
  10<sup>12</sup>, print <code>-1</code> instead.
</p>

<h3>Input</h3>
<p>
  The first line of the input gives the number of test cases <b>T</b>. <b>T</b> test cases follow.
  The first line of each test case consists of four integers <b>N</b>, <b>M</b>, <b>S</b>, and
  <b>R</b> giving the number of junctions, streets, stone types, and recipes, respectively.
  The following <b>M</b> lines describe the map of the city. The i-th of these lines contains two
  distinct integers <b>U<sub>i</sub></b> and <b>V<sub>i</sub></b> denoting the pair of junctions
  connected by the i-th street.
</p>
<p>
  The subsequent <b>N</b> lines describe the types of stones available in each junction.
  The i-th of these lines starts with the number of stone types <b>C<sub>i</sub></b> available in
  i-th junction followed by <b>C<sub>i</sub></b> distinct integers in the range [2, <b>S</b>]
  enumerating the stone types. The golden stone is always numbered 1 and is not available.
</p>
<p>
  The last <b>R</b> lines of each test case describe Leopold's magic recipes. The i-th of these
  lines starts with the number of ingredient stones <b>K<sub>i</sub></b> required for the i-th
  recipe followed by <b>K<sub>i</sub></b> not necessarily distinct integers in the range
  [2, <b>S</b>] enumerating the types of necessary ingredients. The i-th line ends with an integer
  in the range [1, <b>S</b>], which is the type of the resulting stone after applying the i-th
  recipe. For example <code>3 6 5 6 3</code> denotes a recipe that requires two stones of type 6,
  one stone of type 5, and produces a stone of type 3.
</p>
<p>
  It is guaranteed that it is possible to produce a golden stone in each of the test cases.
</p>

<h3>Output</h3>
<p>
  For each test case, output one line containing <code>Case #x: y</code>, where <code>x</code> is
  the test case number (starting from 1) and <code>y</code> is the answer for the test case
  <code>x</code>, namely, the minimum amount of energy Leopold must spend to produce one golden
  stone.
  If the answer is greater than or equal to 10<sup>12</sup>, print <code>-1</code> instead.
</p>

<h3>Limits</h3>
<p>
Time limit: 20 seconds.<br/>
Memory limit: 1 GB.<br/>

1 &le; <b>T</b> &le; 100.<br/>
1 &le; <b>U<sub>i</sub></b>, <b>V<sub>i</sub></b> &le; <b>N</b>, <b>U<sub>i</sub></b> &ne;
  <b>V<sub>i</sub></b><br/>
0 &le; <b>C<sub>i</sub></b> &lt; <b>S</b>.<br/>
1 &le; <b>K<sub>i</sub></b> &le; 3.<br/>
Each pair of junctions is connected by at most one street.<br/>
It is possible to get from any junction to any other junction by following a sequence of streets.
<br/>
It is possible to create a golden stone.<br/>
</p>

<h4>Test Set 1</h4>
<p>

2 &le; <b>N</b> &le; 50.<br/>
1 &le; <b>M</b> &le; 80.<br/>
2 &le; <b>S</b> &le; 50.<br/>
1 &le; <b>R</b> &le; 50.<br/>
</p>

<h4>Test Set 2</h4>
<p>

2 &le; <b>N</b> &le; 300.<br/>
1 &le; <b>M</b> &le; 500.<br/>
2 &le; <b>S</b> &le; 300.<br/>
1 &le; <b>R</b> &le; 300.<br/>
</p>


  <h3>Sample</h3>
  <div class="problem-io-wrapper-new">
    <div class="sampleio-wrapper">
      <div class="sample-input">
        <div class="sample-header">
          <div class="sample-header-text">Sample Input</div>
          <div class="sample-header-download-button">
            <a href="golden_stone_sample_ts1_input.txt" target="_blank" aria-label="Download">
              <i class="material-icons grey">save_alt</i>
            </a>
          </div>
          <div class="sample-header-copy-button" onclick="
              const copyText = document.getElementById('sample_input_0').textContent;
              const textArea = document.createElement('textarea');
              textArea.textContent = copyText;
              textArea.style.position = 'absolute';
              textArea.style.left = '-100%';
              document.body.append(textArea);
              textArea.select();
              document.execCommand('copy');
              textArea.remove();
              const copyPopup = document.getElementById('sample_input_copy_popup_0');
              copyPopup.classList.add('sample-header-copy-popup-shown');
              setTimeout(function(){ copyPopup.classList.remove('sample-header-copy-popup-shown'); }, 2000);
          " aria-label="Copy to clipboard">
            <i class="material-icons grey">content_copy</i>
            <span class="sample-header-copy-popup" id="sample_input_copy_popup_0">
              Copied!
            </span>
          </div>
        </div>
        <div class="sample-content">
          <pre class="sample-content-text" id="sample_input_0">3
4 3 4 1
1 2
1 3
1 4
0
1 2
1 3
1 4
3 2 3 4 1
4 3 4 1
1 2
1 3
1 4
0
2 2 3
1 3
1 4
3 2 3 4 1
2 1 4 2
1 2
2 2 3
1 4
3 2 3 4 1
2 2 3 4
</pre>
        </div>
      </div>
      <div class="sample-output">
        <div class="sample-header">
          <div class="sample-header-text">Sample Output</div>
          <div class="sample-header-download-button">
            <a href="golden_stone_sample_ts1_output.txt" target="_blank" aria-label="Download">
              <i class="material-icons grey">save_alt</i>
            </a>
          </div>
          <div class="sample-header-copy-button" onclick="
              const copyText = document.getElementById('sample_output_0').textContent;
              const textArea = document.createElement('textarea');
              textArea.textContent = copyText;
              textArea.style.position = 'absolute';
              textArea.style.left = '-100%';
              document.body.append(textArea);
              textArea.select();
              document.execCommand('copy');
              textArea.remove();
              const copyPopup = document.getElementById('sample_output_copy_popup_0');
              copyPopup.classList.add('sample-header-copy-popup-shown');
              setTimeout(function(){ copyPopup.classList.remove('sample-header-copy-popup-shown'); }, 2000);
          " aria-label="Copy to clipboard">
            <i class="material-icons grey">content_copy</i>
            <span class="sample-header-copy-popup" id="sample_output_copy_popup_0">
              Copied!
            </span>
          </div>
        </div>
        <div class="sample-content">
          <pre class="sample-content-text" id="sample_output_0">Case #1: 3
Case #2: 2
Case #3: 0
</pre>
        </div>
      </div>
    </div>
  </div>


<p>
  In the first test case, the minimum amount of energy is achieved if Leopold collects the stones 2,
  3, and 4 at the junctions 2, 3, and 4, respectively, carries the stones to the junction 1,
  and uses his only recipe to transform the three stones into a golden stone. This way, three stones
  are carried along one street each, therefore, the total amount of energy spent is 3.
</p>

<p>
  The only difference between the first two test cases is that the stone 3 is now available at the
  junction 2 as well. This time it is optimal to carry one stone of type 4 from junction 4 to
  junction 2 spending 2 units of energy, and then collect the missing stones of types 2 and 3 there
  to produce a golden stone using the only recipe.
</p>

<p>
  In the third test case, Leopold can produce a golden stone without ever leaving junction 1. First,
  he should collect stones of types 2 and 3 to produce a stone of type 4 using the second recipe. In
  a second step, he should collect the stones 2 and 3 again and combine them with the stone 4 to
  produce a golden stone using the first recipe.
</p>

    </div>
  </body>
</html>
