
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Kick Start 2018 - Round G</h3><h1>Combining Classes</h1><h3>Problem</h3>
<p>
  Supervin is teaching <b>N</b> classes, which are numbered from 1 to <b>N</b>. After giving his
  most recent exam, he noticed that in each of his classes, the test scores of his students form a
  sequence of consecutive integers. Therefore, Supervin can summarize the scores for the i-th class
  as two integers <b>L</b><sub>i</sub> and <b>R</b><sub>i</sub>. This means that the i-th class has
  <b>R</b><sub>i</sub> - <b>L</b><sub>i</sub> + 1 students, and for each x (<b>L</b><sub>i</sub>
  &le; x &le; <b>R</b><sub>i</sub>), there is exactly one student with score x.
</p>
<p>
  Supervin would like to combine the scores from the students from all of his classes and sort the
  scores in non-increasing order. He has <b>Q</b> questions (numbered from 1 to <b>Q</b>) about this
  list; for the i-th question, he wants to know what the <b>K</b><sub>i</sub>-th highest score is.
  (If <b>K</b><sub>i</sub> is greater than the number of students, then the answer for the i-th
  question is 0.)
</p>
<p>
  Can you help Supervin answer all of his questions? Since there may be many answers, instead of
  outputting all of them, output proof that you have answered them: the sum of
  (S<sub>i</sub> &times; i) for all 1 &le; i &le; <b>Q</b>, where S<sub>i</sub> is the answer to the
  i-th question.
</p>

<h3>Input</h3>
<p>
  The first line of the input gives the number of test cases, <b>T</b>. <b>T</b> test cases follow.
  Each test case contains four lines. The first line contains two integers <b>N</b> and <b>Q</b> as
  described above. The next three lines each contain six integers in the following format,
  respectively:
  <ul>
    <li><b>X</b><sub>1</sub> <b>X</b><sub>2</sub> <b>A</b><sub>1</sub> <b>B</b><sub>1</sub> <b>C</b><sub>1</sub> <b>M</b><sub>1</sub></li>
    <li><b>Y</b><sub>1</sub> <b>Y</b><sub>2</sub> <b>A</b><sub>2</sub> <b>B</b><sub>2</sub> <b>C</b><sub>2</sub> <b>M</b><sub>2</sub></li>
    <li><b>Z</b><sub>1</sub> <b>Z</b><sub>2</sub> <b>A</b><sub>3</sub> <b>B</b><sub>3</sub> <b>C</b><sub>3</sub> <b>M</b><sub>3</sub></li>
  </ul>

  These values are used to generate <b>L</b><sub>i</sub>, <b>R</b><sub>i</sub>, and <b>K</b><sub>i</sub> as follows:
</p>
<p>
  We define:
  <ul>
    <li><b>X</b><sub>i</sub> = (<b>A</b><sub>1</sub> &times; <b>X</b><sub>i - 1</sub> + <b>B</b><sub>1</sub> &times; <b>X</b><sub>i - 2</sub> + <b>C</b><sub>1</sub>) modulo <b>M</b><sub>1</sub>, for i = 3 to <b>N</b>.</li>
    <li><b>Y</b><sub>i</sub> = (<b>A</b><sub>2</sub> &times; <b>Y</b><sub>i - 1</sub> + <b>B</b><sub>2</sub> &times; <b>Y</b><sub>i - 2</sub> + <b>C</b><sub>2</sub>) modulo <b>M</b><sub>2</sub>, for i = 3 to <b>N</b>.</li>
    <li><b>Z</b><sub>i</sub> = (<b>A</b><sub>3</sub> &times; <b>Z</b><sub>i - 1</sub> + <b>B</b><sub>3</sub> &times; <b>Z</b><sub>i - 2</sub> + <b>C</b><sub>3</sub>) modulo <b>M</b><sub>3</sub>, for i = 3 to <b>Q</b>.</li>
  </ul>
  We also define:
  <ul>
    <li><b>L</b><sub>i</sub> = min(<b>X</b><sub>i</sub>, <b>Y</b><sub>i</sub>) + 1, for i = 1 to <b>N</b>.</li>
    <li><b>R</b><sub>i</sub> = max(<b>X</b><sub>i</sub>, <b>Y</b><sub>i</sub>) + 1, for i = 1 to <b>N</b>.</li>
    <li><b>K</b><sub>i</sub> = <b>Z</b><sub>i</sub> + 1, for i = 1 to <b>Q</b>.</li>
  </ul>
</p>

<h3>Output</h3>
<p>
  For each test case, output one line containing <code>Case #x: y</code>, where <code>x</code> is
  the test case number (starting from 1) and <code>y</code> is the sum of (S<sub>i</sub> &times; i)
  for all 1 &le; i &le; <b>Q</b>, where S<sub>i</sub> is the answer to the i-th question.
</p>

<h3>Limits</h3>
<p>
  1 &le; <b>T</b> &le; 100.<br/>
  Time limit: 180 seconds per test set.<br/>
  Memory limit: 1 GB.<br/>
  1 &le; <b>N</b> &le; 4 &times; 10<sup>5</sup>.<br/>
  0 &le; <b>A</b><sub>i</sub> &lt; <b>M</b><sub>i</sub>, for all i.<br/>
  0 &le; <b>B</b><sub>i</sub> &lt; <b>M</b><sub>i</sub>, for all i.<br/>
  0 &le; <b>C</b><sub>i</sub> &lt; <b>M</b><sub>i</sub>, for all i.<br/>
  0 &le; <b>X</b><sub>1</sub> &lt; <b>M</b><sub>1</sub>.<br/>
  0 &le; <b>X</b><sub>2</sub> &lt; <b>M</b><sub>1</sub>.<br/>
  0 &le; <b>Y</b><sub>1</sub> &lt; <b>M</b><sub>2</sub>.<br/>
  0 &le; <b>Y</b><sub>2</sub> &lt; <b>M</b><sub>2</sub>.<br/>
  0 &le; <b>Z</b><sub>1</sub> &lt; <b>M</b><sub>3</sub>.<br/>
  0 &le; <b>Z</b><sub>2</sub> &lt; <b>M</b><sub>3</sub>.<br/>
  1 &le; <b>M</b><sub>i</sub> &le; 10<sup>9</sup>, for all i.<br/>
</p>

<h4>Small dataset (Test set 1 - Visible)</h4>
<p>
  <b>Q</b> = 1.<br/>
</p>

<h4>Large dataset (Test set 2 - Hidden)</h4>
<p>
  1 &le; <b>Q</b> &le; 10<sup>5</sup>.<br/>
</p>


  <h3>Sample</h3>
  <i>
    Note: there are additional samples that are not run on submissions down below.
  </i>
  <div class="problem-io-wrapper-new">
    <div class="sampleio-wrapper">
      <div class="sample-input">
        <div class="sample-header">
          <div class="sample-header-text">Sample Input</div>
          <div class="sample-header-download-button">
            <a href="combining_classes_sample_ts1_input.txt" target="_blank" aria-label="Download">
              <i class="material-icons grey">save_alt</i>
            </a>
          </div>
          <div class="sample-header-copy-button" onclick="
              const copyText = document.getElementById('sample_input_0').textContent;
              const textArea = document.createElement('textarea');
              textArea.textContent = copyText;
              textArea.style.position = 'absolute';
              textArea.style.left = '-100%';
              document.body.append(textArea);
              textArea.select();
              document.execCommand('copy');
              textArea.remove();
              const copyPopup = document.getElementById('sample_input_copy_popup_0');
              copyPopup.classList.add('sample-header-copy-popup-shown');
              setTimeout(function(){ copyPopup.classList.remove('sample-header-copy-popup-shown'); }, 2000);
          " aria-label="Copy to clipboard">
            <i class="material-icons grey">content_copy</i>
            <span class="sample-header-copy-popup" id="sample_input_copy_popup_0">
              Copied!
            </span>
          </div>
        </div>
        <div class="sample-content">
          <pre class="sample-content-text" id="sample_input_0">2
5 1
3 1 4 1 5 9
2 7 1 8 2 9
4 8 15 16 23 42
7 1
2 3 4 5 6 31
1 3 4 5 5 17
2 2 1 3 2 100
</pre>
        </div>
      </div>
      <div class="sample-output">
        <div class="sample-header">
          <div class="sample-header-text">Sample Output</div>
          <div class="sample-header-download-button">
            <a href="combining_classes_sample_ts1_output.txt" target="_blank" aria-label="Download">
              <i class="material-icons grey">save_alt</i>
            </a>
          </div>
          <div class="sample-header-copy-button" onclick="
              const copyText = document.getElementById('sample_output_0').textContent;
              const textArea = document.createElement('textarea');
              textArea.textContent = copyText;
              textArea.style.position = 'absolute';
              textArea.style.left = '-100%';
              document.body.append(textArea);
              textArea.select();
              document.execCommand('copy');
              textArea.remove();
              const copyPopup = document.getElementById('sample_output_copy_popup_0');
              copyPopup.classList.add('sample-header-copy-popup-shown');
              setTimeout(function(){ copyPopup.classList.remove('sample-header-copy-popup-shown'); }, 2000);
          " aria-label="Copy to clipboard">
            <i class="material-icons grey">content_copy</i>
            <span class="sample-header-copy-popup" id="sample_output_copy_popup_0">
              Copied!
            </span>
          </div>
        </div>
        <div class="sample-content">
          <pre class="sample-content-text" id="sample_output_0">Case #1: 7
Case #2: 28
</pre>
        </div>
      </div>
    </div>
  </div>


<p>
  In Sample Case #1, the generated arrays <b>X</b>, <b>Y</b>, <b>Z</b> are:
  <ul>
    <li><b>X</b> = [3, 1, 3, 0, 8].</li>
    <li><b>Y</b> = [2, 7, 7, 2, 6].</li>
    <li><b>Z</b> = [4].</li>
  </ul>
  Therefore,
  <ul>
    <li><b>L</b> = [3, 2, 4, 1, 7].</li>
    <li><b>R</b> = [4, 8, 8, 3, 9].</li>
    <li><b>K</b> = [5].</li>
  </ul>
  The students' scores for each of the classes are [3, 4], [2, 3, 4, 5, 6, 7, 8], [4, 5, 6, 7, 8],
  [1, 2, 3], and [7, 8, 9]. This means that the students' scores for all classes combined are
  [3, 4, 2, 3, 4, 5, 6, 7, 8, 4, 5, 6, 7, 8, 1, 2, 3, 7, 8, 9]. If we sort them in non-increasing
  order, they are [9, 8, 8, 8, 7, 7, 7, 6, 6, 5, 5, 4, 4, 4, 3, 3, 3, 2, 2, 1].
  Therefore, the student with the 5th highest score has score 7. Thus, S = [7] and the answer is
  7 &times; 1 = 7.
</p>


  <br/>
  <h3>Additional Sample - Test Set 2</h3>
  <i>
    The following additional sample fits the limits of Test Set 2. It will not
    be run against your submitted solutions.
  </i>
  <div class="problem-io-wrapper-new">
    <div class="sampleio-wrapper">
      <div class="sample-input">
        <div class="sample-header">
          <div class="sample-header-text">Sample Input</div>
          <div class="sample-header-download-button">
            <a href="combining_classes_sample_ts2_input.txt" target="_blank" aria-label="Download">
              <i class="material-icons grey">save_alt</i>
            </a>
          </div>
          <div class="sample-header-copy-button" onclick="
              const copyText = document.getElementById('sample_input_1').textContent;
              const textArea = document.createElement('textarea');
              textArea.textContent = copyText;
              textArea.style.position = 'absolute';
              textArea.style.left = '-100%';
              document.body.append(textArea);
              textArea.select();
              document.execCommand('copy');
              textArea.remove();
              const copyPopup = document.getElementById('sample_input_copy_popup_1');
              copyPopup.classList.add('sample-header-copy-popup-shown');
              setTimeout(function(){ copyPopup.classList.remove('sample-header-copy-popup-shown'); }, 2000);
          " aria-label="Copy to clipboard">
            <i class="material-icons grey">content_copy</i>
            <span class="sample-header-copy-popup" id="sample_input_copy_popup_1">
              Copied!
            </span>
          </div>
        </div>
        <div class="sample-content">
          <pre class="sample-content-text" id="sample_input_1">2
5 5
3 1 4 1 5 9
2 7 1 8 2 9
4 8 15 16 23 42
1 2
0 0 0 0 0 1
0 0 0 0 0 1
0 1 0 0 0 2
</pre>
        </div>
      </div>
      <div class="sample-output">
        <div class="sample-header">
          <div class="sample-header-text">Sample Output</div>
          <div class="sample-header-download-button">
            <a href="combining_classes_sample_ts2_output.txt" target="_blank" aria-label="Download">
              <i class="material-icons grey">save_alt</i>
            </a>
          </div>
          <div class="sample-header-copy-button" onclick="
              const copyText = document.getElementById('sample_output_1').textContent;
              const textArea = document.createElement('textarea');
              textArea.textContent = copyText;
              textArea.style.position = 'absolute';
              textArea.style.left = '-100%';
              document.body.append(textArea);
              textArea.select();
              document.execCommand('copy');
              textArea.remove();
              const copyPopup = document.getElementById('sample_output_copy_popup_1');
              copyPopup.classList.add('sample-header-copy-popup-shown');
              setTimeout(function(){ copyPopup.classList.remove('sample-header-copy-popup-shown'); }, 2000);
          " aria-label="Copy to clipboard">
            <i class="material-icons grey">content_copy</i>
            <span class="sample-header-copy-popup" id="sample_output_copy_popup_1">
              Copied!
            </span>
          </div>
        </div>
        <div class="sample-content">
          <pre class="sample-content-text" id="sample_output_1">Case #1: 39
Case #2: 1
</pre>
        </div>
      </div>
    </div>
  </div>

<p>
  In Sample Case #1, every parameter is the same as Sample Case #1 except the value of <b>Q</b>.
  Therefore, the values of <b>L</b> and <b>R</b>, and the students' scores for all classes combined
  are still the same as Sample Case #1. However, the queries are now <b>K</b> = [5, 9, 40, 23, 12].
  The students with the 5th, 9th, and 12th highest scores have scores of 7, 6, and 4, respectively.
  Since there are only 20 students, the 23rd and 40th students do not exist. Therefore,
  S = [7, 6, 0, 0, 4] and the answer is
  7 &times; 1 + 6 &times; 2 + 0 &times; 3 + 0 &times; 4 + 4 &times; 5 = 7 + 12 + 20 = 39.
</p>
<p>
  In Sample Case #2, the generated arrays <b>X</b>, <b>Y</b>, <b>Z</b> are:
  <ul>
    <li><b>X</b> = [0].</li>
    <li><b>Y</b> = [0].</li>
    <li><b>Z</b> = [0, 1].</li>
  </ul>
  Therefore,
  <ul>
    <li><b>L</b> = [1].</li>
    <li><b>R</b> = [1].</li>
    <li><b>K</b> = [1, 2].</li>
  </ul>
  Therefore, there is only one student, and S = [1, 0], so the answer is
  1 &times; 1 + 0 &times; 2 = 1.
</p>

    </div>
  </body>
</html>
