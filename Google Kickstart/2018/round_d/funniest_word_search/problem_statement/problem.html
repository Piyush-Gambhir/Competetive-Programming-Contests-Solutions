
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Kick Start 2018 - Round D</h3><h1>Funniest Word Search</h1><h3>Problem</h3>
<p>
  Siv's birthday is next week and Cel is preparing a birthday present for her. Because Siv loves
  puzzles, Cel is creating a word search puzzle as a gift.
</p><p>
  In a word search puzzle, the solver is given a rectangular grid with <b>R</b> rows and <b>C</b>
  columns, and the solver must find all valid words hidden inside the grid. Each hidden word may
  appear horizontally or vertically (but NOT diagonally) in the grid, forward or in reverse.
  Hidden words may overlap.
</p><p>
  Cel has a dictionary with <b>W</b> different words; these are the only words that can be hidden
  within the puzzle grid. (Of course, not every contiguous horizontal or vertical part of the grid
  will necessarily contain one of the hidden words.) These words are not necessarily real English
  words. Each word might appear in the grid one or more times, or not at all.
</p><p>
  Cel has already created the word search puzzle. However, there is a problem: the puzzle is too big
  to print on a sheet of paper. As Siv's birthday is coming soon, there is not enough time to create
  a new word search puzzle from scratch. So Cel is wondering whether she can reduce the size of the
  grid, simply by selecting a non-empty, grid-aligned subgrid from the original grid.
</p><p>
  Randomly selecting a subgrid might result in a boring puzzle without a lot of hidden words. So Cel
  wants to select a subgrid with the largest <i>fun value</i>, where the <i>fun value</i> of a
  subgrid is defined as:
</p><p>
<i>fun value</i> = (total length of words matched) / ((width of subgrid) + (height of subgrid))
</p><p>
  Notes:
  <ul>
    <li>The entire word has to appear in the subgrid to be counted.</li>
    <li>If a word appears <b>x</b> times in the subgrid, its length should be added <b>x</b> times
        in the above formula.</li>
    <li>If a word and its reverse both appear in the subgrid (even at the same position!), we count
        both occurrences.</li>
    <li>The subgrid with largest <i>fun value</i> might be the entire original grid.</li>
  </ul>
</p><p>
  Can you please help Cel find the largest <i>fun value</i> that a subgrid could have, and the
  number of different subgrids that have this <i>fun value</i>? Two subgrids are considered
  different if and only if there is some cell in the grid&mdash;that is, some (row, column)
  position&mdash;that is in one subgrid, but not the other.
</p>

<h3>Input</h3>
<p>
  The first line of the input gives the number of test cases, <b>T</b>. <b>T</b> test cases follow.
  Each test case is structured as follows:
  <ul>
    <li>The first line contains 3 integers <b>R</b>, <b>C</b> and <b>W</b>, as described above.</li>
    <li>Each of the next <b>R</b> lines contains exactly <b>C</b> uppercase English letters.</li>
    <li>Each of the next <b>W</b> lines contain exactly one valid word. Each word contains only
        uppercase English letters.</li>
  </ul>
</p>

<h3>Output</h3>
<p>
  For each test case, output one line containing <code>Case #x: y/z n</code>, where:
  <ul>
    <li><code>x</code> is the test case number (starting from 1).</li>
    <li><code>y/z</code> is an irreducible fraction equal to the largest possible <i>fun value</i>
        (as described above) of a subgrid.</li>
    <li><code>y</code> is a non-negative integer.</li>
    <li><code>z</code> is a positive integer.</li>
    <li><code>n</code> is the number of subgrids with <i>fun value</i> equal to
        <code>y/z</code>.</li>
  </ul>
</p><p>
<code>y/z</code> is called an irreducible fraction if the greatest common divisor of y and z is 1.
</p>

<h3>Limits</h3>
<p>
  <ul>
    <li>1 &le; <b>T</b> &le; 100.</li>
    <li>Time limit: 240 seconds per test set.</li>
    <li>Memory limit: 1 GB.</li>
    <li>1 &le; <b>R</b> &le; 100.</li>
    <li>1 &le; <b>C</b> &le; 100.</li>
    <li>No word appears more than once in the list of valid words.</li>
    <li>The combined length of all words in the list of valid words is at most 5000 letters.</li>
  </ul>
</p>

<h4>Small dataset (Test set 1 - Visible)</h4>
<p>
  <ul>
    <li>The length of each valid word is exactly 1.</li>
    <li>1 &le; <b>W</b> &le; 26.</li>
  </ul>
</p>

<h4>Large dataset (Test set 2 - Hidden)</h4>
<p>
  <ul>
    <li>1 &le; <b>W</b> &le; 1000.</li>
  </ul>
</p>


  <h3>Sample</h3>
  <i>
    Note: there are additional samples that are not run on submissions down below.
  </i>
  <div class="problem-io-wrapper-new">
    <div class="sampleio-wrapper">
      <div class="sample-input">
        <div class="sample-header">
          <div class="sample-header-text">Sample Input</div>
          <div class="sample-header-download-button">
            <a href="funniest_word_search_sample_ts1_input.txt" target="_blank" aria-label="Download">
              <i class="material-icons grey">save_alt</i>
            </a>
          </div>
          <div class="sample-header-copy-button" onclick="
              const copyText = document.getElementById('sample_input_0').textContent;
              const textArea = document.createElement('textarea');
              textArea.textContent = copyText;
              textArea.style.position = 'absolute';
              textArea.style.left = '-100%';
              document.body.append(textArea);
              textArea.select();
              document.execCommand('copy');
              textArea.remove();
              const copyPopup = document.getElementById('sample_input_copy_popup_0');
              copyPopup.classList.add('sample-header-copy-popup-shown');
              setTimeout(function(){ copyPopup.classList.remove('sample-header-copy-popup-shown'); }, 2000);
          " aria-label="Copy to clipboard">
            <i class="material-icons grey">content_copy</i>
            <span class="sample-header-copy-popup" id="sample_input_copy_popup_0">
              Copied!
            </span>
          </div>
        </div>
        <div class="sample-content">
          <pre class="sample-content-text" id="sample_input_0">2
1 2 1
AA
A
1 2 1
AA
B
</pre>
        </div>
      </div>
      <div class="sample-output">
        <div class="sample-header">
          <div class="sample-header-text">Sample Output</div>
          <div class="sample-header-download-button">
            <a href="funniest_word_search_sample_ts1_output.txt" target="_blank" aria-label="Download">
              <i class="material-icons grey">save_alt</i>
            </a>
          </div>
          <div class="sample-header-copy-button" onclick="
              const copyText = document.getElementById('sample_output_0').textContent;
              const textArea = document.createElement('textarea');
              textArea.textContent = copyText;
              textArea.style.position = 'absolute';
              textArea.style.left = '-100%';
              document.body.append(textArea);
              textArea.select();
              document.execCommand('copy');
              textArea.remove();
              const copyPopup = document.getElementById('sample_output_copy_popup_0');
              copyPopup.classList.add('sample-header-copy-popup-shown');
              setTimeout(function(){ copyPopup.classList.remove('sample-header-copy-popup-shown'); }, 2000);
          " aria-label="Copy to clipboard">
            <i class="material-icons grey">content_copy</i>
            <span class="sample-header-copy-popup" id="sample_output_copy_popup_0">
              Copied!
            </span>
          </div>
        </div>
        <div class="sample-content">
          <pre class="sample-content-text" id="sample_output_0">Case #1: 8/3 1
Case #2: 0/1 3
</pre>
        </div>
      </div>
    </div>
  </div>


<p>
  Let (i, j) denotes the cell at i-th row and j-th column.
</p><p>
  In Sample Case #1, the subgrid with highest <i>fun value</i> is the entire grid. The valid word
  <code>A</code> appears 8 times in the grid:
  <ul>
    <li>2 times horizontally (once forward and once in reverse) at cell (1, 1).</li>
    <li>2 times vertically (once forward and once in reverse) at cell (1, 1).</li>
    <li>4 times (horizontally and vertically, forward and reverse) at cell (1, 2).</li>
  </ul>
</p><p>
  In Sample Case #2, there are 3 subgrids with <i>fun value</i> equals 0:
  <ul>
    <li>Subgrid consists of only one cell (1, 1).</li>
    <li>Subgrid consists of only one cell (1, 2).</li>
    <li>Subgrid with top-left corner at cell (1, 1) and bottom-right corner at cell (1, 2).</li>
  </ul>
</p>


  <br/>
  <h3>Additional Sample - Test Set 2</h3>
  <i>
    The following additional sample fits the limits of Test Set 2. It will not
    be run against your submitted solutions.
  </i>
  <div class="problem-io-wrapper-new">
    <div class="sampleio-wrapper">
      <div class="sample-input">
        <div class="sample-header">
          <div class="sample-header-text">Sample Input</div>
          <div class="sample-header-download-button">
            <a href="funniest_word_search_sample_ts2_input.txt" target="_blank" aria-label="Download">
              <i class="material-icons grey">save_alt</i>
            </a>
          </div>
          <div class="sample-header-copy-button" onclick="
              const copyText = document.getElementById('sample_input_1').textContent;
              const textArea = document.createElement('textarea');
              textArea.textContent = copyText;
              textArea.style.position = 'absolute';
              textArea.style.left = '-100%';
              document.body.append(textArea);
              textArea.select();
              document.execCommand('copy');
              textArea.remove();
              const copyPopup = document.getElementById('sample_input_copy_popup_1');
              copyPopup.classList.add('sample-header-copy-popup-shown');
              setTimeout(function(){ copyPopup.classList.remove('sample-header-copy-popup-shown'); }, 2000);
          " aria-label="Copy to clipboard">
            <i class="material-icons grey">content_copy</i>
            <span class="sample-header-copy-popup" id="sample_input_copy_popup_1">
              Copied!
            </span>
          </div>
        </div>
        <div class="sample-content">
          <pre class="sample-content-text" id="sample_input_1">2
1 3 2
ABC
ABC
CBA
4 4 1
AAAB
AAAB
AAAB
BBBB
AA
</pre>
        </div>
      </div>
      <div class="sample-output">
        <div class="sample-header">
          <div class="sample-header-text">Sample Output</div>
          <div class="sample-header-download-button">
            <a href="funniest_word_search_sample_ts2_output.txt" target="_blank" aria-label="Download">
              <i class="material-icons grey">save_alt</i>
            </a>
          </div>
          <div class="sample-header-copy-button" onclick="
              const copyText = document.getElementById('sample_output_1').textContent;
              const textArea = document.createElement('textarea');
              textArea.textContent = copyText;
              textArea.style.position = 'absolute';
              textArea.style.left = '-100%';
              document.body.append(textArea);
              textArea.select();
              document.execCommand('copy');
              textArea.remove();
              const copyPopup = document.getElementById('sample_output_copy_popup_1');
              copyPopup.classList.add('sample-header-copy-popup-shown');
              setTimeout(function(){ copyPopup.classList.remove('sample-header-copy-popup-shown'); }, 2000);
          " aria-label="Copy to clipboard">
            <i class="material-icons grey">content_copy</i>
            <span class="sample-header-copy-popup" id="sample_output_copy_popup_1">
              Copied!
            </span>
          </div>
        </div>
        <div class="sample-content">
          <pre class="sample-content-text" id="sample_output_1">Case #1: 3/2 1
Case #2: 8/1 1
</pre>
        </div>
      </div>
    </div>
  </div>


<p>
  In Sample Case #1, the subgrid with highest <i>fun value</i> is the entire grid. The valid word
  <code>ABC</code> appears horizontally from cell (1, 1), and the valid word <code>CBA</code>
  appears horizontally in reverse from cell (1, 1). So the <i>fun value</i> of the entire grid
  equals <code>6/(1 + 3) = 3/2</code>.
</p><p>
  In Sample Case #2, the subgrid with highest <i>fun value</i> has top-left corner at cell (1, 1)
  and bottom-right corner at cell (3, 3). The valid word <code>AA</code> appears 24 times in the
  subgrid:
  <ul>
    <li>12 times horizontally (6 times forward and 6 times in reverse).</li>
    <li>12 times vertically (6 times forward and 6 times in reverse).</li>
  </ul>
</p><p>
  <b>Note</b>: We do not recommend using interpreted/slower languages for this problem.
</p>

    </div>
  </body>
</html>
