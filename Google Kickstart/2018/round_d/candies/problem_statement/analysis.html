
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Kick Start 2018 - Round D</h3><h1>Analysis: Candies</h1><h2>Candies: Analysis</h2>
<p>
  To make our discussion easier, for each range (L, R), let us define SS(L, R) to be the sum of
  sweetness of the candies from index L to R (inclusive), and SO(L, R) to be the number of odd
  candies from index L to R (inclusive). Our problem is equivalent to finding a range (L, R) such
  that:
  <ul>
    <li>SO(L, R) &le; <b>O</b>.</li>
    <li>SS(L, R) &le; <b>D</b>.</li>
    <li>SS(L, R) is maximized.</li>
  </ul>
</p>
<h3>Small dataset</h3>
<p>
  We will use the technique of <b>two pointers</b> to solve the Small dataset. For each value of L
  from 1 to <b>N</b>, we would like to find the value of R such that the value of SS(L, R) is
  maximized while observing the constraints stated above. Since the candies have non-negative
  sweetness in the Small dataset, for every L, we simply have to find the rightmost index R that
  satisfies SO(L, R) &le; <b>O</b> and SS(L, R) &le; <b>D</b>.
</p>
<p>
  For any fixed L', suppose we have identified that R' is the rightmost index that satisifes
  SO(L', R') &le; <b>O</b> and SS(L', R') &le; <b>D</b>. For L'+1, note that S(L' + 1, R')
  necessarily satisfies SO(L' + 1, R') &le; <b>O</b> and SS(L' + 1, R') &le; <b>D</b>. Thus, we do
  not need to iterate through the entire array to find the value of R that maximizes SS(L'+1, R). We
  simply have to iterate from R' + 1 to <b>N</b> to find the largest value of R that still satisfies
  our constraints. This dramatically reduces the runtime of the algorithm, as we only iterate the
  array once to find the optimal value of R for each L (Hence the name two pointers &mdash; the
  pointers L and R only iterate over the array once). Once we obtain the optimal sweetness for each
  L, we can simply take the maximum and return as the answer. Total runtime of the solution is
  O(<b>N</b>).
</p>

<h3>Large dataset</h3>
<p>
  Since <b>S</b><sub>i</sub> may be negative in the Large dataset, for each L, we can no longer
  assume that the rightmost index that satisfies the constraints will give us the optimal value for
  SS(L, R). However, we can still use the above sliding window technique to identify the rightmost
  index that still satisfies the oddness constraint. For any fixed L', suppose we have identified
  that R<sub>O</sub>' is the rightmost index that satisfies the oddness constraint. That is to say,
  we have SO(L', R<sub>O</sub>') &le; <b>O</b> and SO(L', R<sub>O</sub>' + 1) &gt; <b>O</b>. Now we
  need to find the index R in the range [L', R<sub>O</sub>'] that maximizes the value of SS(L', R),
  while observing the constraint SS(L', R) &le; <b>D</b>.
</p>
<p>
  To do so, we shall precompute the prefix sum of the sweetness of the candies (i.e. the values of
  SS(1, 1), SS(1, 2), ..., SS(1, <b>N</b>)). Notice that SS(L, R) = SS(1, R) - SS(1, L - 1). Thus,
  finding the value of R that maximizes S(L', R) is equivalent to finding the value of R that
  maximizes SS(1, R) - SS(1, L' - 1), which is the same as finding <b>the value of R that maximizes
  the prefix sum SS(1, R) while observing SS(L', R) &le; D.</b>
</p>
<p>
  In order to identify the value of R quickly, we will need a data structure that supports adding
  integers, removing integers, and finding the largest integer smaller than a queried integer.
  A <b>balanced binary search tree</b> (e.g. C++ multiset) can perform each of these operations in
  logarithmic time. As we iterate over the value of L, we will add or remove the values of SS(1, R)
  to the tree such that the tree only contains prefix sums for the indices in the range
  [L, R<sub>O</sub>]. Then, we will query for the largest prefix sum such that SS(1, R) &le;
  SS(1, L - 1) + D. This allows us to compute the maximum sweetness for a subarray that starts from
  L, and we may then compute the overall maximum sweetness across all subarrays.
</p>
<p>
  The time needed to preprocess all prefix sums and values of R<sub>O</sub> is O(<b>N</b>).
  Subsequently, each prefix sum may only be added or removed at most once from our data structure.
  In addition, we will only query the data structure once for each value of L. Using a balanced
  binary search tree, this gives us a total runtime of O(<b>N</b> log <b>N</b>).
</p>


  <div class="test-data-download-wrapper">
    <div class="test-data-download-header">
      <div class="test-data-download-header-text">Test Data</div>
      <div class="test-data-download-header-download-button">
        <a href="test_data.zip" target="_blank">
          <i class="material-icons grey">save_alt</i>
        </a>
      </div>
    </div>
    <div class="test-data-download-content">
      <div class="test-data-download-warning">
        <span class="material-icons" style="color: grey; vertical-align: middle;">info</span>
        <span style="vertical-align: middle;">We recommend that you practice debugging solutions without looking at the test data.</span>
      </div>
    </div>
  </div>


    </div>
  </body>
</html>
