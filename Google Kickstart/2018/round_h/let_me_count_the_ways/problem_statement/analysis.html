
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Kick Start 2018 - Round H</h3><h1>Analysis: Let Me Count The Ways</h1><h2>Let Me Count The Ways: Analysis</h2>

<h3>Small dataset</h3>
<p>
  We can solve the Small dataset using <a href="https://en.wikipedia.org/wiki/Dynamic_programming">
  dynamic programming</a>. Let <i>f(x, y, z)</i> (<i>x</i> and
  <i>y</i> are non-negative integers, while <i>z</i> is 0 or 1) be the number of
  ways to arrange a seating order for <i>x</i> non-newlywed people and <i>y</i> newlywed couples
  (thus the total is <i>x</i> + 2<i>y</i> people and seats), such that:
  <ul>
    <li>There is no newlywed couple for which the two members are seated next to each other,
        and</li>
    <li>If <i>z</i> = 1, then one of the <i>x</i> non-newlywed people must not sit in the first
        remaining unassigned seat.</li>
  </ul>
</p>
<p>
  The base case of this function occurs when there are no people left
  (i.e. <i>x</i> = <i>y</i> = 0), then <i>f(x, y, z)</i> = 1. Otherwise, <i>f(x, y, 0)</i> can be
  defined recursively as follows:
  <ul>
    <li>We can put one of the <i>x</i> non-newlywed people in the first seat. Therefore, we need to
        assign the remaining <i>x</i> - 1 non-newlywed people and <i>y</i> newlywed couples. This
        contributes <i>x</i> &times; <i>f(x - 1, y, 0)</i> to the total number of ways captured by
        <i>f(x, y, 0)</i>.</li>
    <li>We can put one of the member of the <i>y</i> newlywed couples in the first seat. The other
        member of this couple can be considered as an additional non-newlywed person. Therefore, we
        need to assign the remaining <i>x</i> + 1 non-newlywed people and <i>y</i> - 1 newlywed
        couples. However, note that this additional person cannot be seated next to his/her newlywed
        partner (i.e. cannot be seated on the first unassigned seat after his/her newlywed partner
        sit down). Therefore, this contributes 2 &times; <i>y</i> &times; <i>f(x + 1, y - 1, 1)</i>
        to the total number of ways captured by<i>f(x, y, 0)</i>.</li>
  </ul>
</p>
<p>
  Therefore, <i>f(x, y, 0)</i> =
  <i>x</i> &times; <i>f(x - 1, y, 0)</i> + 2 &times; <i>y</i> &times; <i>f(x + 1, y - 1, 1)</i>. The
  cases for <i>f(x, y, 1)</i> are similar, except that we can't put one of the <i>x</i> non-newlywed
  people in the first seat. Therefore, <i>f(x, y, 1)</i> =
  (<i>x</i> - 1) &times; <i>f(x - 1, y, 0)</i> + 2 &times; <i>y</i> &times; <i>f(x + 1, y - 1, 1)</i>.
</p>
<p>
  This dynamic programming solution runs in O(<b>N</b> &times; <b>M</b>) space and time.
</p>

<h3>Large dataset</h3>
<p>
  We can solve the Large dataset using the
  <a href="https://en.wikipedia.org/wiki/Inclusion%E2%80%93exclusion_principle">inclusion-exclusion
  principle</a>. Since <b>M</b> can be up to 100000, it is infeasible to iterate all possible subset
  of the newlywed couples. However, we can observe that the number of ways to arrange a seating
  order such that the newlywed couple P sits adjacently (i.e. the two members of a newlywed couple P
  sit next to each other) is the same as the number of ways to arrange a seating order such that the
  newlywed couple Q sits adjacently. In general, for a fixed number <i>k</i> of newlywed couples,
  regardless of which particular couples we choose, the number of seating orders in which all of
  those <i>k</i> newlywed couples have their two members adjacent is the same.
</p>
<p>
  Therefore, we can define a function <i>g(k)</i> as the number of ways to arrange a seating order
  such that for each of the first <i>k</i> newlywed couples, the two members of a couple are sitting
  next to each other. <i>g(k)</i> can be computed by multiplying the following:
  <ul>
    <li>The number of ways these newlywed couples sit. Since the members of each newlywed couple
        must sit next to each other, we can treat each newlywed couple as if it were one person.
        Therefore, there are 2<b>N</b> - <i>k</i> seats for <i>k</i> couples. Since the couples are
        not identical and the order of the couples matters, there are
        C(2<b>N</b> - <i>k</i>, <i>k</i>) &times; <i>k</i>! ways, where C(n, k) is the number of
        ways of picking k unordered outcomes from n possibilities (i.e. "n choose k").</li>
    <li>The number of ways of ordering two people in each newlywed couple, which is
        2<sup><i>k</i></sup>.</li>
    <li>The number of ways in which the remaining people can sit, which is
        (2(<b>N</b> - <i>k</i>))!.</li>
  </ul>
  Therefore, <i>g(k)</i> = C(2<b>N</b> - <i>k</i>, <i>k</i>) &times; <i>k</i>! &times;
  2<sup><i>k</i></sup> &times; (2(<b>N</b> - <i>k</i>))!
</p>
<p>
  Finally, we should not forget that <i>g(k)</i> counts the number of ways to arrange a seating
  order such that the first <i>k</i> newlywed couples sit adjacently. To consider all subset of
  newlywed couples of size <i>k</i>, we need to multiply <i>g(k)</i> by C(<b>M</b>, <i>k</i>).
</p>
<p>
  Putting all the pieces together, the answer we are looking for is
  &Sigma; (-1)<sup><i>k</i></sup> &times; <i>g(k)</i> &times; C(<b>M</b>, <i>k</i>) for all
  0 &le; <i>k</i> &le; <b>M</b>. By precomputing the value of powers of two, factorials, and their
  modular inverses, this answer can be computed in O(<b>N</b> + <b>M</b>) space and time.
</p>


  <div class="test-data-download-wrapper">
    <div class="test-data-download-header">
      <div class="test-data-download-header-text">Test Data</div>
      <div class="test-data-download-header-download-button">
        <a href="test_data.zip" target="_blank">
          <i class="material-icons grey">save_alt</i>
        </a>
      </div>
    </div>
    <div class="test-data-download-content">
      <div class="test-data-download-warning">
        <span class="material-icons" style="color: grey; vertical-align: middle;">info</span>
        <span style="vertical-align: middle;">We recommend that you practice debugging solutions without looking at the test data.</span>
      </div>
    </div>
  </div>


    </div>
  </body>
</html>
