
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Kick Start 2018 - Round B</h3><h1>Analysis: Sherlock and the Bit Strings</h1><h2>Bit String: Analysis</h2>
<p>
  The main challenge of finding the <b>P</b>-th lexicographically smallest valid
  string is to count the number of valid strings given a prefix requirement
  (i.e. the string must begin with a given prefix) and the <b>K</b> constraints
  given in the problem. The prefix requirement is necessary since we're going to
  fill the characters of the string one by one from the first character. Once we
  have solved the counting problem, the original problem becomes easier.
</p>
<p>
  We can loop through each of the valid characters i in lexicographically
  increasing order (i.e. 0 and 1 in this problem) for the first position. Then
  we count the number of valid strings with prefix i. Let's say this
  value is X. If X &geq; <b>P</b>, we know that i is the right character
  for the first position. Otherwise, we continue the loop and subtract X from
  <b>P</b> until we find the right character for the first position. We keep
  doing this for each position until the last position.
</p>
<p>
  To avoid an overflow when counting the number of valid strings, we can limit
  our computation to maxP, where maxP is the maximum value of <b>P</b> (i.e.
  10<sup>18</sup> in this problem). In other words, whenever we find that the
  number of valid strings would be more than maxP, we can set it to maxP.
</p>
<h3>Small dataset</h3>
<p>
  Finding the number of valid strings in the Small dataset is easier since
  <b>A<sub>i</sub></b> = <b>B<sub>i</sub></b> in each of the constraints. It is
  the same as saying that the <b>A<sub>i</sub></b>-th character must be
  <b>C<sub>i</sub></b>. Therefore, the set of possible characters for each
  position is independent of what character we choose for any other position.
  The number of valid strings is simply 2<sup>Y</sup>, where Y is the number of
  positions without a constraint. For example, the number of valid strings
  without a given prefix requirement is 2<sup><b>N</b> - <b>K</b></sup>.
</p>
<h3>Large dataset</h3>
<p>
  Finding the number of valid strings in the Large dataset is trickier since
  the set of possible characters for each position is no longer independent of
  what character we choose for any other position.
</p>
<p>
  We can solve this dataset using a dynamic programming solution. Let us define
  a function <code>f(x, last)</code>, where <code>x</code> is a [1, <b>N</b>]
  integer and <code>last</code> is a 15-bit (15 is the maximum possible value of
  <b>B<sub>j</sub></b> - <b>A<sub>j</sub></b>) integer, is the number of ways
  of:
<ul>
  <li> assigning <code>0</code>s and <code>1</code>s to the bit string from the
       <code>x</code>-th position to the <b>N</b>-th position (in other words,
       assume that the bit string has been "filled" until the
       (<code>x</code> - 1)-th position),
  <li> the last 15 characters (i.e. from (<code>x</code> - 15)-th position to
       the (<code>x</code> - 1)-th position) are represented in
       <code>last</code>, and
  <li> the assignment has to satisfy all the constraints i where
       <b>B<sub>i</sub></b> &ge; x.
</ul>
</p>
<p>
  How do we calculate <code>f(x, last)</code>? We loop over i in the list
  [0, 1], the character that we consider putting in the <code>x</code>-th
  position. Together with <code>last</code>, we now know what the last 16
  characters we have placed are. Since
  <b>B<sub>j</sub></b> - <b>A<sub>j</sub></b> &leq; 15, and using the
  information of last 16 characters that we have placed, we can check all the
  constraints j where <b>B<sub>j</sub></b> = x.
</p>
<p>
  If at least one of these constraints is violated, then i is not a valid
  character to be placed in on the <code>x</code>-th position. Otherwise,
  placing in i on the <code>x</code>-th position contributes
  <code>f(x + 1, g(last, i))</code> to <code>f(x, last)</code>, where
  <code>g(last ,i)</code> is updating the <code>last</code> mask by ignoring the
  first bit of <code>last</code> (since we won't need the character from the
  (<code>x</code> - 15)-th position anymore) and appending an i bit to
  the end.
</p>
<p>
  With the prefix requirement <code>s</code>, the number of valid strings is the
  value of <code>f(length(s) + 1, the last 15 characters of s)</code>. Since
  there are <b>N</b> possible values for <code>x</code>, 2<sup>15</sup> possible
  values for <code>last</code>, and each computation of <code>f(x, y)</code>
  requires a loop for checking the constraints, this solution runs in
  2<sup>15</sup> &times; O(<b>N</b> + <b>K</b>) time. Even though 2<sup>15</sup>
  is a constant multiplicative factor that does not affect the big-O time of the
  solution, it is relevant to the running time, particularly because
  2<sup>15</sup> is much greater than the largest possible value of
  <b>N</b> + <b>K</b>, so we include it here for clarity.
</p>


  <div class="test-data-download-wrapper">
    <div class="test-data-download-header">
      <div class="test-data-download-header-text">Test Data</div>
      <div class="test-data-download-header-download-button">
        <a href="test_data.zip" target="_blank">
          <i class="material-icons grey">save_alt</i>
        </a>
      </div>
    </div>
    <div class="test-data-download-content">
      <div class="test-data-download-warning">
        <span class="material-icons" style="color: grey; vertical-align: middle;">info</span>
        <span style="vertical-align: middle;">We recommend that you practice debugging solutions without looking at the test data.</span>
      </div>
    </div>
  </div>


    </div>
  </body>
</html>
