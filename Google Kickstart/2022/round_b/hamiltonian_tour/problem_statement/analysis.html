
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Kick Start 2022 - Round B</h3><h1>Analysis: Hamiltonian Tour</h1><h3>
  Test Set 1
</h3>
<p>
  The regular structure of the grid allows for many simple constructions of a
  <a href="https://en.wikipedia.org/wiki/Hamiltonian_path" target="_blank">Hamiltonian cycle</a> by
  using repeated patterns as building blocks. For example, if both $$$\mathbf{R}$$$ and $$$\mathbf{C}$$$ are even, we can
  define $$$P=E^{2\mathbf{C}-2}S(W^2S^2WN^2W)^\frac{\mathbf{C}-2}{2}W^2S^2$$$ and use
  $$$E(PS)^{\frac{\mathbf{R}}{2}-1}PWN^{2\mathbf{R}-1}$$$ as our Hamiltonian cycle. This is illustrated in the
  picture below, where the same pattern $$$P$$$ is used to walk between cells $$$S$$$ and $$$T$$$ or
  cells $$$S'$$$ and $$$T'$$$.
</p>
<img src="images/ts1_pattern.png" width="60%"
     alt="An example grid for Test Set 1, R = 4, and C = 6 with one potential Hamiltonian cycle."/>
<p>
  Similar patterns can be defined when one or both of $$$\mathbf{R}$$$ and $$$\mathbf{C}$$$ are odd. For example:
</p>
<ul>
  <li>If $$$\mathbf{R}$$$ is even and $$$\mathbf{C}$$$ is odd, use the cycle $$$E(PS)^{\frac{\mathbf{R}}{2}-1}PWN^{2\mathbf{R}-1}$$$, where
  $$$P=E^{2\mathbf{C}-2}S(S^2WN^2W^3)^\frac{\mathbf{C}-1}{2}S^2$$$.</li>
  <li>If $$$\mathbf{R}$$$ is odd and $$$\mathbf{C}$$$ is even, use the cycle
    $$$EP^\frac{\mathbf{R}-1}{2}E^{2\mathbf{C}-2}SW^{2\mathbf{C}-1}N^{2\mathbf{R}-1}$$$, where
    $$$P=E^{2\mathbf{C}-2}S(W^2S^2WN^2W)^\frac{\mathbf{C}-2}{2}W^2S^3$$$.</li>
  <li>If both $$$\mathbf{R}$$$ and $$$\mathbf{C}$$$ are odd, use the cycle
    $$$EP^\frac{\mathbf{R}-1}{2}E^{2\mathbf{C}-2}SW^{2\mathbf{C}-1}N^{2\mathbf{R}-1}$$$, where
    $$$P=E^{2\mathbf{C}-2}S(S^2WN^2W^3)^\frac{\mathbf{C}-1}{2}S^3$$$.</li>
</ul>
<p>
  The time complexity of
  this construction is proportional to the length of the resulting cycle, which is $$$O(\mathbf{R}\mathbf{C})$$$.
</p>
<h3>
  Test Set 2
</h3>

<p>
  We are going to discuss two different approaches here. In both of them, we will use an undirected
  graph $$$G$$$ with the empty $$$2 \times 2$$$ blocks as nodes and two blocks connected by an edge
  if and only if the blocks share a side. If the graph is disconnected, then the answer is
  <code>IMPOSSIBLE</code>, as there are empty cells that are not even reachable from the cell
  $$$A_{1,1}$$$. We will see that a Hamiltonian cycle exists if $$$G$$$ is connected.
</p>

<h4>
  Merging Cycles
</h4>

<p>
  The idea in this approach is to perform a depth-first search (DFS) on the graph $$$G$$$,
  starting at the top-left block, and maintain a cycle traversing all four empty cells of every
  visited $$$2 \times 2$$$ block. The cycle is extended incrementally as more blocks are visited
  by the DFS.
  A detailed description follows.
</p>

<p>
  First, let us connect the four cells of each empty $$$2 \times 2$$$ block in a clockwise cycle of
  length four. Technically, it can be implemented by maintaining
  pointers <code>next[i,j]</code>, where <code>next[i,j]=={p,q}</code> if the cell $$$A_{p,q}$$$
  follows the cell $$$A_{i,j}$$$ in a cycle.
</p>
<p>
  The following picture shows the construction for the third example
  test case.
</p>
<img src="images/small_cycles.png" width="60%"
     alt="The image shows the grid of the third example test case, where the empty cells of each
          2x2 block are connected in a clockwise cycle."/>
<p>
  Now perform a DFS on $$$G$$$ starting at the
  top-left block. During the search, we maintain a single cycle containing all four cells of all
  empty blocks that are visited by the DFS so far. Let us call it the <em>main cycle</em>, which
  is initially the small $$$4$$$-cycle of the top-left block. As we visit a new block $$$X$$$ from
  its parent block $$$P$$$ in the DFS tree, we merge the $$$4$$$-cycle of $$$X$$$ into the main
  cycle at the common side between blocks $$$P$$$ and $$$X$$$. The merging operation can be
  implemented in constant time by reconnecting two pointers. For example, if $$$X$$$ has
  $$$A_{i,j}$$$
  as its top-left cell and $$$X$$$ is on the right of $$$P$$$, then the cycles can be merged by
  setting <code>next[i][j-1]={i,j}</code> and <code>next[i+1][j]={i+1,j-1}</code>.
</p>
<p>
  The following picture illustrates the merging operations for our example.
</p>
<img src="images/dfs_cycles.png" width="100%"
     alt="The image shows the merging operations for the third example test case."/>
<p>
  Since cycles can be merged in constant time and DFS is a linear time algorithm, the overall
  time complexity of this approach is $$$O(\mathbf{R}\mathbf{C})$$$.
</p>

<h4>
  Following the Walls
</h4>

<p>
  If you are familiar with the
  <a href="https://en.wikipedia.org/wiki/Maze-solving_algorithm#Wall_follower" target="_blank">
    Wall follower</a>
  algorithm for escaping a maze, the same intuition can be applied directly to construct the
  Hamiltonian tour in our grid. The idea is to keep walking while sliding one hand along the wall
  without ever loosing contact with the wall. In the context of a maze, you would either exit the
  maze eventually or return to the starting position. Similarly, if we were to use the wall follower
  algorithm in our grid of Hamilton starting at the top-left cell $$$A_{1,1}$$$, we would eventually
  return to that cell and thus form a cycle.
</p>

<p>
  If $$$G$$$ is a tree, then
  every empty cell is touching a wall at least at a corner. Therefore, the wall follower algorithm
  would necessarily visit every empty cell and result in a Hamiltonian cycle.
</p>

<p>
  But what if $$$G$$$ is not a tree? We can construct a
  <a href="https://en.wikipedia.org/wiki/Spanning_tree" target="_blank">spanning tree</a> $$$T$$$
  of $$$G$$$ and introduce thin walls between $$$2 \times 2$$$ blocks that are connected in $$$G$$$,
  but not in the tree $$$T$$$. And again, using the wall follower algorithm would yield a
  Hamiltonian cycle.
</p>

<p>
  This whole construction is illustrated in the following picture. The spanning tree $$$T$$$ of
  $$$G$$$ is marked with blue lines, the wall being followed is outlined in red, and the green cycle
  is the resulting Hamiltonian tour.
</p>
<img src="images/wall_follower.png" width="60%"
     alt="The image shows a spanning tree of G and the Hamiltonian tour constructed by the wall follower algorithm."/>

<p>
  The time complexity of both the spanning tree construction and the wall follower algorithm is
  $$$O(\mathbf{R}\mathbf{C})$$$.
</p>


  <div class="test-data-download-wrapper">
    <div class="test-data-download-header">
      <div class="test-data-download-header-text">Test Data</div>
      <div class="test-data-download-header-download-button">
        <a href="test_data.zip" target="_blank">
          <i class="material-icons grey">save_alt</i>
        </a>
      </div>
    </div>
    <div class="test-data-download-content">
      <div class="test-data-download-warning">
        <span class="material-icons" style="color: grey; vertical-align: middle;">info</span>
        <span style="vertical-align: middle;">We recommend that you practice debugging solutions without looking at the test data.</span>
      </div>
    </div>
  </div>


    </div>
  </body>
</html>
