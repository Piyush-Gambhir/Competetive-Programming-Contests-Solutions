
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Code Jam 2009 - Round 3</h3><h1>Analysis: Alphabetomials</h1><h3>1. Product of two sets</h3>
<p>
The problem was created during a short walk in Manhattan in a summer evening. At first there came the picture of an N by M matrix. Let <i>A</i> be a set of N words  {A<sub>i</sub> | 1 &le; i &le; N}, and <i>B</i> be a set of M words {B<sub>j</sub> | 1 &le; j &le; M}. For any word X, let us denote X(<i>c</i>) the number of occurrences of character <i>c</i> in X. In the (i,j)-entry of the matrix, we write, say, the product A<sub>i</sub>('a')B<sub>j</sub>('a')B<sub>j</sub>('b'). What is the sum of all the entries in the matrix?<br/>
One can compute the NM terms one by one. But it is easy to see, as you can sum them row by row, as well as column by column, it is nothing but the full expansion of the following expression
<blockquote> (1) &nbsp;&nbsp;&nbsp; &sum;<sub>X &isin; A, Y &isin; B</sub>X('a')Y('a')Y('b') = &sum;<sub>X &isin; A</sub>X('a') &sum;<sub>Y &isin; B</sub>Y('a')Y('b').
</blockquote>
i.e., you can compute the sum on A and B separately, then compute their product.
</p>
<p>
What if, as in our problem, instead of writing A<sub>i</sub>('a')B<sub>j</sub>('a')B<sub>j</sub>('b') for the (i,j)-entry, we write Z('a')<sup>2</sup>Z('b'), where Z is the concatenation of A<sub>i</sub> and B<sub>j</sub>? i.e., we do not care which 'a's are from the first set, and which are from the second. In this case we do not have something as simple as (1). But, we can reduce it if we <i>do care</i> which of the 'a's are from the first set. We use a somehow simplified notation (which is closer to our problem statement) -- the symbol <i>a</i> now also represent the number of 'a's in a string. For a fixed string Z that is a concatenation of words from <i>A</i> and <i>B</i>, let a<sub>1</sub> denote the number of 'a's contributed by the first set, and a<sub>2</sub> the number of 'a's contributed by the second set. For each entry in the matrix, we write a<sup>2</sup>b, this is equal to (a<sub>1</sub>+a<sub>2</sub>)<sup>2</sup>(b<sub>1</sub>+b<sub>2</sub>). Expand it, we have
<blockquote> (2) &nbsp;&nbsp;&nbsp; &sum;<sub>X &isin; A, Y &isin; B</sub> a<sup>2</sup>b = 
&sum;<sub>X &isin; A, Y &isin; B</sub> (a<sub>1</sub>+a<sub>2</sub>)<sup>2</sup>(b<sub>1</sub>+b<sub>2</sub>) <br/>
=
&sum;<sub>X &isin; A, Y &isin; B</sub> (a<sub>1</sub><sup>2</sup>b<sub>1</sub> + a<sub>1</sub><sup>2</sup>b<sub>2</sub> + 2a<sub>1</sub>a<sub>2</sub>b<sub>1</sub> + 2a<sub>1</sub>a<sub>2</sub>b<sub>2</sub> + a<sub>2</sub><sup>2</sup>b<sub>1</sub> + a<sub>2</sub><sup>2</sup>b<sub>2</sub>) <br/>
= 
&sum;<sub>A,B</sub> (a<sub>1</sub><sup>2</sup>b<sub>1</sub>) + &sum;<sub>A,B</sub> (a<sub>1</sub><sup>2</sup>b<sub>2</sub>) + 2&sum;<sub>A,B</sub> (a<sub>1</sub>a<sub>2</sub>b<sub>1</sub>) + <br/>&nbsp;&nbsp;&nbsp; 2&sum;<sub>A,B</sub> (a<sub>1</sub>a<sub>2</sub>b<sub>2</sub>) + &sum;<sub>A,B</sub> (a<sub>2</sub><sup>2</sup>b<sub>1</sub>) + &sum;<sub>A,B</sub> (a<sub>2</sub><sup>2</sup>b<sub>2</sub>) <br/>
=
&sum;<sub>A</sub> a<sup>2</sup>b &sum;<sub>B</sub> 1 + 
&sum;<sub>A</sub> a<sup>2</sup> &sum;<sub>B</sub> b + 
2&sum;<sub>A</sub> ab &sum;<sub>B</sub> a + <br/>&nbsp;&nbsp;&nbsp;
2&sum;<sub>A</sub> a &sum;<sub>B</sub> ab + 
&sum;<sub>A</sub> b &sum;<sub>B</sub> a<sup>2</sup> + 
&sum;<sub>A</sub> 1 &sum;<sub>B</sub> a<sup>2</sup>b
</blockquote>
In the last step, for each summand, since the characters from the first set and those from the second set are nicely separated, we can apply the same reason for (1).
</p>
<br/>
<h3>2. Product of ten sets</h3>
Our problem asks to compute the sum of expressions such like a<sup>2</sup>b over the product of a dictionary set by itself up to 10 times. (Or more generally, we can think of the product of 10 sets.) The size of the product set is the huge number n<sup>10</sup>. But if we use the same trick as in the previous section, write a<sup>2</sup>b as
<blockquote>
(a<sub>1</sub> + a<sub>2</sub> + ... + a<sub>10</sub>)<sup>2</sup>
(b<sub>1</sub> + b<sub>2</sub> + ... + b<sub>10</sub>)
</blockquote>
and expand it. Then we reduce the problem to at most K<sup>D</sup> easier problems, where D is the maximal degree (K &le; 10 and D &le; 4 in our problem). Each of the easier problems can be solved similar as in (1).
</p>
<p>
This gives one solution to our problem. Focus on one monomial a time. We are basically choosing the origin (one of the ten sets) for each letter in the monomial, so each set gets a sub-monomial, which can be expressed as a subset of the indices of the letters in the original monomial.<br/>
We pre-compute &sum;<sub>X &isin; A</sub>q(X) for each sub-monomial <i>q</i>, there are at most 16 of these. Then for each of the K<sup>D</sup> "easier problems", the computation involves only multiplying K of the pre-computed numbers.
</p>
<br/>
<h3>3. Speedups</h3>
<p>
The solution above can be easily sped up to solve for much bigger K and slightly bigger D, if one compute the summations incrementally, do the product of two sets in each step (you call it dynamic programming or not).<br/>
First, we compute the sum for A &times; A, not only for the monomial, but for all its sub-monomials. Then we compute the sums over A<sup>3</sup>. Now we can view A<sup>3</sup> as A<sup>2</sup> &times; A. Each sub-monomial can be expanded to at most 2<sup>D</sup> terms, and every one of them submit to the simple trick in (1). Because we already have the summation of A<sup>2</sup> on any sub-monomial, each of the 2<sup>D</sup> problems can be solved in constant time. The running time of this solution is mostly dominated by O(3<sup>D</sup>K) for each monomial form the input.
</p>
<p>
Observe the last line in (2), notice that we only have one dictionary set in our problems, so we can ignore the subscripts -- A, B, etc are the same set. There are other speedups available along this line by exploring the symmetry in indices. We omit the details.
</p>
<br/>
<h3>4. The theory behind it</h3>
<p>
In case you are familiar with discrete probability, you may well know that probability theory provides some powerful abstract machinery for counting. What we went through so far are just some easy exercises in probability. And solving this problem with the abstract theory in mind certainly speeds up your thinking and boosts your confidence in the solution.<br/>
Especially, we went through the important fact that the expectation of the product of K random variables equals to the product of the expectation of each of the variables, given that the K random variables are mutually independent. The interested readers may carry the formal correspondences out.
</p>



  <div class="test-data-download-wrapper">
    <div class="test-data-download-header">
      <div class="test-data-download-header-text">Test Data</div>
      <div class="test-data-download-header-download-button">
        <a href="test_data.zip" target="_blank">
          <i class="material-icons grey">save_alt</i>
        </a>
      </div>
    </div>
    <div class="test-data-download-content">
      <div class="test-data-download-warning">
        <span class="material-icons" style="color: grey; vertical-align: middle;">info</span>
        <span style="vertical-align: middle;">We recommend that you practice debugging solutions without looking at the test data.</span>
      </div>
    </div>
  </div>



    </div>
  </body>
</html>
