
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Code Jam 2022 - World Finals</h3><h1>Analysis: Triangles</h1><h3>Test Set 1</h3>
<p>
In Test Set 1 there are so few points that we can just try every possible way to assign them
to triangles. With a maximum of $$$\mathbf{N}=12$$$ points, there are $$$12! / (3!^4 \cdot 4!) = 15400$$$
ways of getting $$$3$$$ or $$$4$$$ triangles, even less to get $$$1$$$ or $$$2$$$, and a single
way to get $$$0$$$, which means there are less than $$$4 \cdot 15400 + 1 = 61601$$$
things to try. For each one, we need to check that every triangle is valid (i.e., made up
of non-collinear points) and that each pair of triangles meets the definition given in the
statement. Since there are very few triangles, this requires quite a bit of code but not
a lot of computation time.
<h3>Test Set 2</h3>
<p>
We solve this problem by constructively proving the following theorem: a set $$$S$$$ of
$$$3t$$$ points can be split to form $$$t$$$ triangles that fulfill the conditions of the statement
if and only if it does not contain a subset of $$$2t + 1$$$ collinear points.
</p><p>
The case where $$$t=1$$$ is trivial. If $$$t \gt 1$$$ we consider $$$3$$$ different cases. Let
$$$C$$$ be the largest subset of $$$S$$$ made up of collinear points.
<ul>
<li>If $$$|C| \lt 2t - 1$$$, we find a triangle that is separated from all other points by
  a line and then recursively solve an instance with less points. Since a triangle can use
  at most $$$2$$$ points from $$$C$$$, this does not make the remaining set exceed the maximum
  number of collinear points allowed. One way of finding such a triangle is to get the
  $$$2$$$ maximal points in the lexicographical order (i.e., ordering by X-coordinate and breaking
  ties by Y-coordinate) $$$v$$$ and $$$w$$$, and then find the
  third points $$$x_1$$$ and $$$x_2$$$ that minimize and maximize, respectively, the angle
  $$$vwx_i$$$, breaking ties by the distance $$$|wx_i|$$$. Then, pick $$$x_1$$$ if the angle
  is less than $$$\pi$$$ or $$$x_2$$$ otherwise (in that
  case, $$$vwx_2$$$ is guaranteed to be greater than $$$\pi$$$). Notice that this makes The
  line $$$wx_i$$$ separate the three points from all others (there could be more points over
  that line, but $$$w$$$ and $$$x_i$$$ are the extreme points over it, so any triangles we can make
  from the remaining points will not interfere with this triangle).
</li>
<li>If $$$|C| \ge 2t - 1$$$ and $$$|C| \ne 3$$$, let $$$B, D \subseteq S$$$ be the subsets of
points on each side of the line that goes through $$$C$$$. If neither is empty, assuming without
loss of generality that $$$|B| \le |D|$$$, we can match
the lexicographically greatest $$$2|B|$$$ points of $$$C$$$, let us call that $$$C'$$$ with
$$$B$$$ to
recursively solve $$$B \cup C'$$$ and $$$D \cup (C \setminus C_1)$$$. Notice that there is a
separation line between those two sets, so the recursive solutions do not interfere with each
other. If one of $$$B$$$ or $$$C$$$ is empty we can take the two lexicographically greatest
points in $$$C$$$ and match it with one of the remaining points, as in the previous step,
solving the rest recursively. If $$$|C|=2$$$, this makes a single triangle. Otherwise,
$$$|C| \gt 3$$$, so after removing two points from $$$C$$$ and one point from $$$S \setminus C$$$,
the requirements of the theorem applies to the remaining points.
<li>Otherwise, $$$|C|=3$$$ and $$$t=2$$$. If the convex hull of $$$S$$$ has $$$3$$$ vertices,
  we can use those for one triangle, and the other $$$3$$$ for the other. If the convex hull of
  $$$S$$$ has $$$5$$$ or $$$6$$$ vertices, it contains at least two from $$$C$$$, so we can use
  those $$$2$$$ plus a single intermediate or adjacent point to form one triangle, and the
  rest for the other. If the convex hull of $$$C$$$ has $$$4$$$ points, there are a few
  cases to consider depending on where the other $$$2$$$ points are located, but all are solvable.
  Implementation-wise, we can simply try all possible ways to match it, since there is a small
  amount anyway.
</li>
</ul><p>
Because of the above, we can do the following: find a largest set of collinear points in the
input $$$C$$$. If it is larger than $$$\lceil 2 \mathbf{N} / 3 \rceil$$$, ignore points from it
to make it equal to that amount. After that, ignore points not in $$$C$$$ to make the set
of non-ignored points have size multiple of $$$3$$$. We will match all those points into triangles
using the above idea. If we keep the points sorted lexicographically, we can implement each step
finding a new triangle in linear time, except for the fact that after each step of the first type
we may need to recalculate $$$C$$$.
</p><p>
To speed up the calculation of largest subset of collinear points, we can use three techniques.
The first two speed it up in complexity, but can be really slow in practice due to a combination
of large constants and an accumulation of logarithmic factors depending on the exact
implementation.
<ul>
<li>Calculate all subsets of collinear points and keep them updated and on a priority queue
  to quickly identify the largest. There are $$$\mathbf{N}$$$ point removals and each one updates up to
  $$$\mathbf{N} - 1$$$ sets, so there are $$$O(\mathbf{N}^2)$$$ updates overall. If the sets are
  linked lists and the priority queue is over an array (the sizes are limited to the range
  $$$1$$$ through $$$\mathbf{N}$$$), this can be theoretically be done in $$$O(\mathbf{N}^2)$$$ overall. However,
  since an initial calculation of $$$C$$$ for the entire input necessitates $$$O(\mathbf{N}^2 \log \mathbf{N})$$$
  operations, it might be tempting to use less efficient but quicker to code structures.
</li>
<li>If $$$|C|$$$ is a lot smaller than the threshold needed to not be in the first case,
  we can simply take multiple steps of the first case without recalculating. It can be shown
  that doing this leads to only a logarithmic number of recalculations. Notice that this still
  makes the overall complexity $$$O(\mathbf{N}^2 \log^2 \mathbf{N})$$$ and it has large constants because
  the input size before each recalculation is not halved, but reduced by about $$$1/5$$$ in the
  worst case.
</li>
</ul>
</p><p>
A simpler and a lot faster way is to not calculate $$$C$$$ explicitly at all. Just keep
doing the first case until you detect all remaining points are collinear (this happens
when both $$$vwx_1$$$ and $$$vwx_2$$$ are planar angles). At that point, undo just enough
of the latest made triangles to make that identified set of collinear points big enough
to not be in the first case, and continue with the second and third cases. This makes the
overall time complexity $$$O(\mathbf{N}^2)$$$ and, not having complicated structures or logarithms
with small bases, it does not hide any large constants.
</p>


  <div class="test-data-download-wrapper">
    <div class="test-data-download-header">
      <div class="test-data-download-header-text">Test Data</div>
      <div class="test-data-download-header-download-button">
        <a href="test_data.zip" target="_blank">
          <i class="material-icons grey">save_alt</i>
        </a>
      </div>
    </div>
    <div class="test-data-download-content">
      <div class="test-data-download-warning">
        <span class="material-icons" style="color: grey; vertical-align: middle;">info</span>
        <span style="vertical-align: middle;">We recommend that you practice debugging solutions without looking at the test data.</span>
      </div>
    </div>
  </div>


    </div>
  </body>
</html>
