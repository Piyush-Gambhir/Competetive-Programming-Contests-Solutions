
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Code Jam 2022 - World Finals</h3><h1>Wonderland Chase</h1><h3>Problem</h3>

<p>
Alice is trapped in Wonderland's labyrinth, being chased by the Queen of Hearts and her
herald! The labyrinth is a set of $$$\mathbf{J}$$$ junctions numbered $$$1$$$ through $$$\mathbf{J}$$$,
connected by $$$\mathbf{C}$$$ bidirectional corridors.
</p><p>
Alice and the Queen of Hearts take turns making moves, and each knows the location of the other
at all times. A move (by either of them) consists of either staying at the current junction or moving to
another one that is connected to it by a corridor.
</p><p>
The Queen's herald, however, announces the next move the Queen makes in advance. That means
that before anyone makes a move, he announces the Queen's first move. Then, Alice moves first.
Then, each time the Queen moves, she must respect the previous announcement, and then decide
her next move so the herald can announce it. Alice hears the announcements, so she always knows the
Queen's next move before making her own.
</p><p align="center">
  <img src="img/wonderland_chase_example_1.png" alt="Illustration of Sample Case #1."/>
</p><p>
If Alice and the Queen are at the same junction after either of them moves, then Alice is caught.
Otherwise, the pursuit continues. After $$$10^9$$$ total moves (half of them for Alice and half
for the Queen), if Alice and the Queen are not in the same junction, then the Queen will give up
and Alice will be safe.
</p><p>
Alice chooses her moves optimally to escape. If she cannot escape, she chooses her moves to
maximize the total number of moves until she is caught. The Queen chooses her moves optimally
to try to catch Alice in as few total moves as possible.
</p><p>
Given the labyrinth's layout and the initial locations of both the Queen and Alice,
find out whether Alice will be caught by the Queen and, if so, in how many moves.
</p>

<h3>Input</h3>
<p>
The first line of the input gives the number of test cases, $$$\mathbf{T}$$$. $$$\mathbf{T}$$$ test cases follow.
Each test case starts with a line containing four integers $$$\mathbf{J}$$$, $$$\mathbf{C}$$$, $$$\mathbf{A}$$$, and $$$\mathbf{Q}$$$: the
number of junctions, the number of corridors, the junction where Alice starts, and the junction
where the Queen starts, respectively. Then,
$$$\mathbf{C}$$$ lines follow. The $$$i$$$&NoBreak;-&NoBreak;th of these lines contains two integers
$$$\mathbf{U_i}$$$ and $$$\mathbf{V_i}$$$, indicating that the $$$i$$$&NoBreak;-&NoBreak;th corridor bidirectionally connects junctions
$$$\mathbf{U_i}$$$ and $$$\mathbf{V_i}$$$.
</p>

<h3>Output</h3>
<p>
For each test case, output one line containing <code>Case #$$$x$$$: $$$y$$$</code>,
where $$$x$$$ is the test case number (starting from 1) and $$$y$$$ is <code>SAFE</code>
if Alice can avoid being caught for $$$10^9$$$ total moves. Otherwise, $$$y$$$ is the total number of
moves (including Alice's and the Queen's) that it takes for the Queen to catch Alice.
</p>

<h3>Limits</h3>
<p>
Memory limit: 1 GB.<br/>

$$$1 \le \mathbf{T} \le 100$$$.<br/>
$$$1 \le \mathbf{A} \le \mathbf{J}$$$.<br/>
$$$1 \le \mathbf{Q} \le \mathbf{J}$$$.<br/>
$$$\mathbf{A} \ne \mathbf{Q}$$$.<br/>
$$$1 \le \mathbf{U_i} \lt \mathbf{V_i} \le \mathbf{J}$$$, for all $$$i$$$.<br/>
$$$(\mathbf{U_i}, \mathbf{V_i}) \ne (\mathbf{U_j}, \mathbf{V_j})$$$, for all $$$i \ne j$$$.<br/>
</p>

<h4>Test Set 1 (Visible Verdict)</h4>
<p>
Time limit: 10 seconds.<br/>

$$$2 \le \mathbf{J} \le 30$$$.<br/>
$$$1 \le \mathbf{C} \le 60$$$.<br/>
</p>

<h4>Test Set 2 (Hidden Verdict)</h4>
<p>
Time limit: 60 seconds.<br/>

$$$2 \le \mathbf{J} \le 10^5$$$.<br/>
$$$1 \le \mathbf{C} \le 2 \times 10^5$$$.<br/>
</p>


  <h3>Sample</h3>
  <div class="problem-io-wrapper-new">
    <div class="sampleio-wrapper">
      <div class="sample-input">
        <div class="sample-header">
          <div class="sample-header-text">Sample Input</div>
          <div class="sample-header-download-button">
            <a href="wonderland_chase_sample_ts1_input.txt" target="_blank" aria-label="Download">
              <i class="material-icons grey">save_alt</i>
            </a>
          </div>
          <div class="sample-header-copy-button" onclick="
              const copyText = document.getElementById('sample_input_0').textContent;
              const textArea = document.createElement('textarea');
              textArea.textContent = copyText;
              textArea.style.position = 'absolute';
              textArea.style.left = '-100%';
              document.body.append(textArea);
              textArea.select();
              document.execCommand('copy');
              textArea.remove();
              const copyPopup = document.getElementById('sample_input_copy_popup_0');
              copyPopup.classList.add('sample-header-copy-popup-shown');
              setTimeout(function(){ copyPopup.classList.remove('sample-header-copy-popup-shown'); }, 2000);
          " aria-label="Copy to clipboard">
            <i class="material-icons grey">content_copy</i>
            <span class="sample-header-copy-popup" id="sample_input_copy_popup_0">
              Copied!
            </span>
          </div>
        </div>
        <div class="sample-content">
          <pre class="sample-content-text" id="sample_input_0">4
5 5 5 1
1 2
1 3
2 4
3 4
4 5
5 5 5 2
1 2
1 3
2 4
3 4
4 5
3 1 2 3
1 3
2 1 1 2
1 2
</pre>
        </div>
      </div>
      <div class="sample-output">
        <div class="sample-header">
          <div class="sample-header-text">Sample Output</div>
          <div class="sample-header-download-button">
            <a href="wonderland_chase_sample_ts1_output.txt" target="_blank" aria-label="Download">
              <i class="material-icons grey">save_alt</i>
            </a>
          </div>
          <div class="sample-header-copy-button" onclick="
              const copyText = document.getElementById('sample_output_0').textContent;
              const textArea = document.createElement('textarea');
              textArea.textContent = copyText;
              textArea.style.position = 'absolute';
              textArea.style.left = '-100%';
              document.body.append(textArea);
              textArea.select();
              document.execCommand('copy');
              textArea.remove();
              const copyPopup = document.getElementById('sample_output_copy_popup_0');
              copyPopup.classList.add('sample-header-copy-popup-shown');
              setTimeout(function(){ copyPopup.classList.remove('sample-header-copy-popup-shown'); }, 2000);
          " aria-label="Copy to clipboard">
            <i class="material-icons grey">content_copy</i>
            <span class="sample-header-copy-popup" id="sample_output_copy_popup_0">
              Copied!
            </span>
          </div>
        </div>
        <div class="sample-content">
          <pre class="sample-content-text" id="sample_output_0">Case #1: SAFE
Case #2: 4
Case #3: SAFE
Case #4: 2
</pre>
        </div>
      </div>
    </div>
  </div>

<p>
  Sample Case #1 is the one pictured in the problem statement. Alice's optimal first move is to move
  to junction $$$4$$$.
</p>
<p>
  Sample Case #2 is the same as Sample Case #1 but the Queen starts at junction $$$2$$$. The Queen
  can catch Alice by first announcing a move to junction $$$4$$$. If Alice were to move to junction
  $$$4$$$&NoBreak;, she would be caught in $$$2$$$ moves. Alice can evade capture for an
  extra $$$2$$$ moves by staying put and waiting until the Queen then moves to junction $$$5$$$ where she is
  located.
</p>
<p align="center">
  <img src="img/wonderland_chase_example_2.png" alt="Illustration of Sample Case #2."/>
</p>
<p>
  In Sample Case #3, the Queen cannot reach Alice no matter what she does.
</p>
<p align="center">
  <img src="img/wonderland_chase_example_3.png" alt="Illustration of Sample Case #3."/>
</p>
<p>
  In Sample Case #4, the Queen can begin by announcing that she will move to Alice's current
  junction. Alice has to move before then. If Alice moves to where the Queen already is, she gets
  caught immediately; if Alice remains in place, then she gets caught when the Queen moves. The
  second option is better, since it requires $$$2$$$ total moves (Alice's and the Queen's) instead of
  $$$1$$$.
</p>
<p align="center">
  <img src="img/wonderland_chase_example_4.png" alt="Illustration of Sample Case #4."/>
</p>

    </div>
  </body>
</html>
