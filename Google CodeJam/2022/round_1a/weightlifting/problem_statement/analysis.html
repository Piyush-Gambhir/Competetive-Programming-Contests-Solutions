
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Code Jam 2022 - Round 1A</h3><h1>Analysis: Weightlifting</h1><h3>Test Set 1</h3>
<p>
The limits for Test Set 1 are small enough that we can afford to use brute force.
Since there is no reason to have more than $$$\max_j \mathbf{X_{i,j}}$$$ weights of type $$$i$$$,
the number of possible states of the stack to consider is very limited
(in fact, it is $$$\sum_{0 \le a,b,c \le 3} \frac{(a+b+c)!}{a!b!c!} = 5248$$$).
To solve for the minimum number of operations to finish all of the exercises, you can use a
<a href="https://en.wikipedia.org/wiki/Breadth-first_search" target="_blank">breadth-first search</a>
over all possible combinations of the stack states and the number of completed exercises.
Specifically, the breadth-first search starts at the state of an empty stack with no completeted
exercises, and the final answer is the distance from that to the state where the stack is empty but
all exercises are completed.
</p>
<h3>Test Set 2</h3>
<p>
The first observation we can make to solve Test Set 2 of this problem is the following:
if there are any weights that are used in every exercise, it is always optimal to put them at the
bottom of the stack before the first exercise, and leave them there until after the last one.
Moreover, if there are multiple such weights, putting them in any order is equivalent. Formally,
if $$$C$$$ is the multiset of weights that is common to all exercises, there is an optimal solution
that has $$$C$$$ at the bottom of the stack during all exercises.
</p><p>
Now, for a given full sequence of exercises, let us call $$$A$$$ to the largest sequence of weights
that appears at the bottom of the stack for all exercises ($$$A$$$ could be empty). Since $$$A$$$ is
used for all exercises, $$$A \subseteq C$$$. If we use the first observation, then also
$$$C \subseteq A$$$, so $$$A = C$$$. Therefore, we can make a second observation: if there is more
than one exercise, there is at least one time in between exercises in which the stack contains exactly $$$C$$$.
This points towards a divide and conquer solution: find that intermediate point and then
recursively solve the problem of minimizing the operations before and after that point,
disregarding $$$C$$$.
</p><p>
As it is common with divide and conquer approaches, we can either find the place to split without
recursion, or we can use <a href="https://en.wikipedia.org/wiki/Memoization" target="_blank">memoization</a> to be
able to simply try every possible split point, without incurring significant additional
computation time.
</p><p>
To formalize the approach, let $$$C(\ell,r)$$$ be the multiset of weights that is the
intersection of the multiset of weights needed for each exercise between $$$\ell$$$ and $$$r$$$,
inclusive. Additionally, let $$$M(\ell, r)$$$ be the minimum number of operations to get from a
stack containing $$$C(\ell,r)$$$, in any order, perform all operations between $$$\ell$$$ and
$$$r$$$, inclusive, and leave the stack with $$$C(\ell, r)$$$ on it, in the same order. To calculate
$$$M(\ell, r)$$$ we follow the strategy above: for some mid-point $$$x$$$ we do this twice:
load the additional weights for one part of the split, optimize according to a recursive result,
then unload those additional weights. The additional weights for the left part of the split
are $$$C(\ell, x) \setminus C(\ell, r)$$$ and for the right part of the split
are $$$C(x+1, r) \setminus C(\ell, r)$$$ (notice that $$$C(\ell, r)$$$ is included in the other
two multisets by definition). Therefore, the cost in addition to the recursion for the mid-point
$$$x$$$ is $$$2 \times (|C(\ell, x)| + |C(x+1, r)| - 2 \times |C(\ell, r)|)$$$.
Putting it all together:
<ul>
<li>$$$M(\ell, r) = 0$$$, if $$$\ell = r$$$;</li>
<li>$$$M(\ell, r) = \min_{\ell \le x \lt r} \bigl(M(\ell, x) + M(x+1, r) +
  2 \times (|C(\ell, x)| + |C(x+1, r)| - 2 \times |C(\ell, r)|)\bigr)$$$, otherwise.</li>
</ul>
</p><p>
Precomputing the $$$O(\mathbf{E}^2)$$$ values of $$$C$$$ takes $$$O(\mathbf{E}^2 \times \mathbf{W})$$$ time.
With memoization, we can compute the $$$O(\mathbf{E}^2)$$$ values $$$M$$$ in $$$O(\mathbf{E}^3)$$$ overall time.
This is fast enough to pass Test Set 2.
</p>


  <div class="test-data-download-wrapper">
    <div class="test-data-download-header">
      <div class="test-data-download-header-text">Test Data</div>
      <div class="test-data-download-header-download-button">
        <a href="test_data.zip" target="_blank">
          <i class="material-icons grey">save_alt</i>
        </a>
      </div>
    </div>
    <div class="test-data-download-content">
      <div class="test-data-download-warning">
        <span class="material-icons" style="color: grey; vertical-align: middle;">info</span>
        <span style="vertical-align: middle;">We recommend that you practice debugging solutions without looking at the test data.</span>
      </div>
    </div>
  </div>


    </div>
  </body>
</html>
