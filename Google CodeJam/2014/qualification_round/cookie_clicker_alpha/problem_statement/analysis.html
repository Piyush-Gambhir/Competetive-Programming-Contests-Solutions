
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Code Jam 2014 - Qualification Round</h3><h1>Analysis: Cookie Clicker Alpha</h1><p>
In this problem, we need to decide on the number of cookie farms to buy and also need to decide on when to buy the farms.
</p>
<p>
The strategy is perhaps surprisingly simple: first, collect enough cookies to buy a farm. Then figure out whether it's faster to buy one farm and <i>then</i> collect <b>X</b> cookies, or simply to collect <b>X</b> cookies now. If it's faster to collect <b>X</b> cookies now, you should do that. If it's faster to buy a farm first, buy that farm and then repeat this process (collect enough cookies to buy another farm...).
</p>
<p>
It's very easy to <i>say</i> that, but it's not as easy to prove it works. How many farms might you end up buying? If it's in the billions, your program might be too slow, and we never proved it wouldn't be. We also didn't prove that it's best to buy a farm <i>right away</i> as soon as you have enough cookies. The rest of this editorial will go into those questions in detail.
</p>
<p>
We build the intuition for the solution by using geometry. We represent the problem in the 2d plane. Let the x-axis represent time (in seconds) and the y-axis represent the number of cookies. Initially, we gain cookies at the rate of 2 cookies per second which is shown by line L<sub>0</sub> in Figure 1. Let’s say the target number of cookies (X) is 16. We can represent it with line y=16 (L<sub>X</sub>). This means that if we do not buy any cookie farm then the time it takes to get 16 cookies is given by the intersection between L<sub>X</sub> and L<sub>0</sub>. See Figure 1.
</p>

<p>
<img src="Figure1CookieClicker.png">
<br>
Figure 1
</p>

<p>
Now, let’s delve into what happens (geometrically speaking) when we buy a cookie farm. Let’s say the cost for buying a cookie farm (C) is 6, and the extra cookies per second (F) is 2. In Figure 2, we buy a farm as soon as we have 6 cookies. This means at time = 3, we go from having 6 cookies to 0 cookies (to pay for the cookie farm), and our cookies per second increases to 4. This information is represented by L<sub>1</sub> in Figure 2. Note that the dashed lines represent the drop of current cookies when we buy a cookie farm. Notice that L<sub>0</sub> and L<sub>1</sub> intersect at the 6 second mark (and correspondingly, X=12 cookies). It means that, if our target number of cookies X is anywhere between 0 and 12 then it is not advantageous to buy a cookie farm! Why? Let’s look at an example line L<sub>X</sub>a which is in that range. In Figure 2, we see that L<sub>0</sub> intersects L<sub>X</sub>a earlier (at 4 second mark) than L<sub>1</sub> intersects L<sub>X</sub>a (at 5 second mark). At X = 12 (represented by L<sub>X</sub>b), it does not matter if we buy a cookie farm or not. But if X is higher than 12, for example X = 16 (represented by L<sub>X</sub>), we should buy a cookie farm since L<sub>1</sub> intersect L<sub>X</sub> earlier (at 7 second mark) than L<sub>0</sub> (at 8 second mark). Jumping ahead briefly, we notice a similar behavior for the intersection between L<sub>1</sub>, L<sub>2</sub> and L<sub>X</sub> in Figure 4 (we'll describe how we compute L<sub>2</sub> in subsequent paragraphs). If we choose X = 18, it doesn't matter if we choose L<sub>1</sub> or L<sub>2</sub>, but if X is below 18 then L<sub>1</sub> intersection is better than L<sub>2</sub> intersection, but if X is above 18 then L<sub>2</sub> intersection is better than L<sub>1</sub> intersection.
</p>

<p>
<img src="Figure2CookieClicker.png">
<br>
Figure 2
</p>

<p>
Now we discuss the strategy for how early we should buy a cookie farm i.e. should we buy a cookie farm as soon as we have C cookies, or should we wait a little longer before buying a cookie farm? We claim that we should buy a farm as soon as we have C cookies (and not wait any second longer). 
</p>


<p>
<img src="Figure3CookieClicker.png">
<br>
Figure 3
</p>

<p>
In Figure 3 as before, L<sub>1</sub> represents buying a cookie farm as soon as we have 6 cookies (at 3 second), while L<sub>1</sub>a represents delaying buying a cookie farm by a second (at 4 second). Note that L<sub>1</sub> and L<sub>1</sub>a are going to be parallel to each other (i.e. they have the same rate: 4 cookies for second) but L<sub>1</sub> is located to the left of L<sub>1</sub>a. What does this mean? It means that the intersection between any line L<sub>X</sub> and L<sub>1</sub> will always be at an earlier time than the intersection between L<sub>X</sub> and L<sub>1</sub>a. Therefore we should not wait to buy cookie farms any more than needed. This means that if buying a cookie farm contributes to your winning strategy, then we should buy a cookie farm as soon as possible, i.e. as soon as we have C cookies.
</p>

<p>
In Figure 4, we can observe that the earliest time to buy the first cookie farm is on the intersection of line L<sub>0</sub> with line L<sub>C</sub> (y=C). Then, the earliest time to buy the second cookie farm is on the intersection of line L<sub>1</sub> with L<sub>C</sub>.
</p>

<p>
<img src="Figure4CookieClicker.png">
<br>
Figure 4
</p>

<p>
Now, we are ready to describe our solution strategy. We first determine the time t<sub>0</sub> it takes to get X cookies without buying a cookie farm (i.e. intersection between L<sub>0</sub> and L<sub>X</sub>). Then we try to buy 1 cookie farm and figure out the time t<sub>1</sub> it takes to get X cookies (i.e. intersection between L<sub>1</sub> and L<sub>X</sub>). Then compute t<sub>2</sub> for buying another cookie farm (i.e. intersection between L<sub>2</sub> and L<sub>X</sub>), and so on. We stop when t<sub>n+1</sub> is greater than t<sub>n</sub> (i.e. we do worse, in terms of time, by buying an additional cookie farm). For example, in Figure 4, we do worse with L<sub>2</sub> than with L<sub>1</sub> (intersections with L<sub>X</sub>). We finally report  t<sub>n</sub> as our winning time.
</p>

<p>
A note on doing the actual line intersection computation follows. We want to compute the line intersections between lines L<sub>0</sub>, L<sub>1</sub>, L<sub>2</sub>, etc and y = C or y = X. Let our current line be L<sub>n</sub> starting at (S<sub>n</sub>, 0) and have a slope of m (i.e. cookies per second after buying n cookie farms). Note that s<sub>0</sub> is 0, and m = 2 + n * F. Then the time required to get A cookies is given as: S<sub>n</sub> + A / m.
</p>

<p>
Our solution strategy mentioned above iterates until a winning condition is achieved. But you might be wondering about total iterations needed before we are done. We want to point out that the number of iterations is bounded. In the solution strategy, we noted that the stopping condition for iteration is when we do worse (in terms of time) when buying an additional farm. Let’s formulate that as an equation. Let’s say our current iteration is i with line L<sub>i</sub> with the next line being L<sub>i+1</sub>. The intersection between line y = X and L<sub>i</sub> is given as t<sub>i</sub> = s<sub>i</sub> + X / (2 + i * F), and similarly intersection between line y = X and L<sub>i+1</sub> is given as t<sub>i+1</sub> = s<sub>i+1</sub> + X / (2 + (i + 1) * F). We stop when t<sub>i+1</sub> &gt; t<sub>i</sub>. Note that s<sub>i+1</sub> - s<sub>i</sub> = C / (2 + i * F). After going through some math, we get i &gt; (X / C) - 1 - (2 / F), which is the iteration when t<sub>i+1</sub> becomes bigger than t<sub>i</sub>. Therefore the iteration should terminate around X / C.
</p>

  <div class="test-data-download-wrapper">
    <div class="test-data-download-header">
      <div class="test-data-download-header-text">Test Data</div>
      <div class="test-data-download-header-download-button">
        <a href="test_data.zip" target="_blank">
          <i class="material-icons grey">save_alt</i>
        </a>
      </div>
    </div>
    <div class="test-data-download-content">
      <div class="test-data-download-warning">
        <span class="material-icons" style="color: grey; vertical-align: middle;">info</span>
        <span style="vertical-align: middle;">We recommend that you practice debugging solutions without looking at the test data.</span>
      </div>
    </div>
  </div>



    </div>
  </body>
</html>
