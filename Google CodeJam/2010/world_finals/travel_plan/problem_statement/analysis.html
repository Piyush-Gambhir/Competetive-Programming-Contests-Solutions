
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Code Jam 2010 - World Finals</h3><h1>Analysis: Travel Plan</h1><p>As with City Tour, this problem is closely related to <a href="http://www.google.com/search?q=hamiltonian+cycle" target="_blank">Hamiltonian cycles</a>. The good news is that here, the graph consists only of points on a line, and is therefore much easier to analyze. The bad news is we aren't looking for just any Hamiltonian cycle, or even the shortest one; we are looking for one of a particular length. A question this precise requires a complete search of some kind.</p>

<p>The simplest approach is to try all possible travel plans one at a time. This is much too slow for the large input, but it is fine for the small input.</p>

<p>Given that <code>N &le; 30</code> throughout, you might next think to try a dynamic programming solution that tracks how far you have gone and which nodes you have visited so far. Unfortunately, this is also too slow - large values of <b>F</b> are a big problem!</p>

<h3>A <code>3<sup>N</code> solution</h3>

<p>The first key step to solving this problem is to go from <code>N!</code> time to <code>3<sup>N</sup></code> time.</p>

<p>We first divide the line into intervals <code>I<sub>1</sub>, I<sub>2</sub>, ..., I<sub>N-1</sub></code>. Let <code>t<sub>j</sub></code> denote the number of times that the travel plan crosses interval <code>I<sub>j</sub></code>, and let <code>d<sub>j</sub></code> denote the length of interval <code>I<sub>j</sub></code>. Then the total length of the travel plan is exactly <code>t<sub>1</sub> * d<sub>1</sub> + t<sub>2</sub> * d<sub>2</sub> + ... + t<sub>N-1</sub> * d<sub>N-1</sub></code>. So this means that all we need to do is figure out what each <code>t<sub>j</sub></code> should be.</p>

<p>The big question is what <code>t<sub>j</sub></code> values are possible? Well, let's take a look.</p>

<ul>

<li> Each <code>t<sub>j</sub></code> must be positive.<br/> <i>Reason:</i> If <code>t<sub>j</sub> = 0</code>, then the travel plan never crosses the corresponding interval, and therefore cannot visit every planet.</li>

<li> For each <code>j</code>, <code>t<sub>j</sub> - t<sub>j-1</sub></code> must be -2, 0, or 2.<br/><i>Reason:</i> Let <code>P</code> denote the planet between the intervals <code>I<sub>j-1</sub></code> and <code>I<sub>j</sub></code>. In our travel plan, we can stop at <code>P</code> at most once. Every other time, we must travel through, which contributes 1 to both <code>t<sub>j-1</sub></code> and <code>t<sub>j</sub></code>. The one time we do hit the planet, we come in along one interval, and then leave along one interval. (These two intervals may or may not be the same.) This part of the travel plan contributes either (a) 1 to both <code>t<sub>j-1</sub></code> and <code>t<sub>j</sub></code>, or (b) 2 to one of these values, and 0 to the other. Regardless, <code>t<sub>j</sub> - t<sub>j-1</sub></code> must be -2, 0, or 2.</li>

<li> <code>t<sub>0</sub></code> and <code>t<sub>N-1</sub></code> must both be 2. <br/><i>Reason:</i> Consider the "outside interval" <code>I<sub>-1</sub></code> that is past the furthest planets. The travel plan cannot traverse this interval, so <code>t<sub>-1</sub> = 0</code>. The observation here now follows immediately from the previous two.</li>

<li> Every choice of <code>t<sub>j</sub></code> satisfying the previous conditions can be achieved by a legal travel plan.

<br/><i>Reason:</i> We can construct such a travel plan by scanning from left to right across the intervals. At any given time during the construction, we will have decided  what the travel plan does to the left of some planet <code>P</code>. Specifically, for each trip left of <code>P</code>, we will know what the trip does until it goes right of <code>P</code> again. We will not however know what happens between these visits, or even what order they occur in.<br/>
Now, suppose we want to extend our partial travel plan past the next interval <code>I<sub>j</sub></code>. If <code>t<sub>j</sub> = t<sub>j-1</sub> - 2</code>, then we need to merge two of our current trips via a stop to <code>P</code>, and extend the rest along <code>I<sub>j</sub></code>. If <code>t<sub>j</sub> = t<sub>j-1</sub> + 2</code>, then we add a new trip that goes along <code>I<sub>j</sub></code>, stops at <code>P</code>, and then goes back again. In the final case we just extend each trip along <code>I<sub>j</sub></code>, having one stop at <code>P</code> without changing direction.
<br/>If you think about this for a while, you should be able to convince yourself that this method does indeed generate a valid travel plan.</li>

</ul>

<p>Okay! We can now describe a <code>3<sup>N</sup></code> time solution to the original problem. Given <code>t<sub>j-1</sub></code>, there are at most 3 possible choices for <code>t<sub>j</sub></code>. Trying each one in turn, we can iterate over all possible assignments for the <code>t<sub>j</sub></code>'s, and then pick the one that leads to the optimal length travel plan.</p>

<h3>A <code>3<sup>N/2</code> solution</h3>

<p>Even this <code>3<sup>N</sup></code> time algorithm is too slow however. Fortunately, there is a very handy trick for situations like this.</p>

<p>Let's consider the middle interval <code>I<sub>N/2</sub></code> and some fixed value for <code>t<sub>N/2</sub></code>. Using the approach described above, we can enumerate in <code>3<sup>N/2</sup></code> time all choices for <code>t<sub>1</sub>, t<sub>2</sub>, ..., t<sub>N/2-1</sub></code> that are consistent with <code>t<sub>N/2</sub></code>. Let <b>A</b> be the set of all possible values <code>t<sub>1</sub> * d<sub>1</sub> + t<sub>2</sub> * d<sub>2</sub> + ... + t<sub>N/2</sub> * d<sub>N/2</sub></code> that can be achieved in this way.</p>

<p>Similarly, we can calculate <b>B</b>, the set of all possible values of <code>t<sub>N/2+1</sub> * d<sub>N/2+1</sub> + t<sub>N/2+2</sub> * d<sub>N/2+2</sub> + ... + t<sub>N-1</sub> * d<sub>N-1</sub></code> that are consistent with <code>t<sub>N/2</sub></code>. All this takes <code>3<sup>N/2</sup></code> time. What's left is to find two numbers in <b>A</b> and <b>B</b> whose sum is as close as possible to <b>F</b> without exceeding it. One efficient way to do this is to sort <b>B</b>, and then for each element in <b>A</b>, use binary search to decide which element in <b>B</b> you should try matching it with. That gives a O(3<sup>N/2</sup> * N) solution.
</p>
<p>
This can be improved to O(3<sup>N/2</sup>) by rearranging the formula a little: <code>t<sub>1</sub> * (d<sub>1</sub> + ... + d<sub>N/2</sub>) + (t<sub>2</sub> - t<sub>1</sub>) * (d<sub>2</sub> + ... + d<sub>N/2</sub>) + ... + (t<sub>N/2</sub> - t<sub>N/2-1</sub>) * d<sub>N/2<sub></code>. The list of these sums can be generated in sorted order iteratively by repeated merging while adding new terms. The difference <code>t<sub>j+1</sub> - t<sub>j</sub></code> is always one of -2, 0, 2, so we need to merge 3 sorted lists to add a new term.
</p>
<p>
When we have the two lists <b>A</b> and <b>B</b> in sorted order, we can process them in linear time with a single scan using two pointers.
</p>


  <div class="test-data-download-wrapper">
    <div class="test-data-download-header">
      <div class="test-data-download-header-text">Test Data</div>
      <div class="test-data-download-header-download-button">
        <a href="test_data.zip" target="_blank">
          <i class="material-icons grey">save_alt</i>
        </a>
      </div>
    </div>
    <div class="test-data-download-content">
      <div class="test-data-download-warning">
        <span class="material-icons" style="color: grey; vertical-align: middle;">info</span>
        <span style="vertical-align: middle;">We recommend that you practice debugging solutions without looking at the test data.</span>
      </div>
    </div>
  </div>



    </div>
  </body>
</html>
