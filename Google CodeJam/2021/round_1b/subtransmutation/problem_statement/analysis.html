
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Code Jam 2021 - Round 1B</h3><h1>Analysis: Subtransmutation</h1><p>
To solve this problem, we can first tackle a simplified version: given a unit of metal $$$x$$$,
can it be used to produce all the metals required by the input?
</p><p>
To solve this simplified problem, we can use a greedy strategy. Keep track of the
multiset $$$H$$$ of units of metal we have (starting with $$$\{x\}$$$) and the multiset $$$D$$$
of units of metal we owe (starting with the ones given as input). Iterate the following steps:
<ol>
<li>Remove the intersection $$$H \cap D$$$ from both $$$H$$$ and $$$D$$$.</li>
<li>If $$$D$$$ is empty, the answer is yes.</li>
<li>If $$$H$$$ is empty and $$$D$$$ is not, the answer is no.</li>
<li>Take all $$$c$$$ units of the metal $$$i$$$ with the largest number still in $$$H$$$.
Remove all $$$c$$$ units of $$$i$$$ from $$$H$$$ and insert $$$c$$$ units of $$$i - \mathbf{A}$$$
and $$$c$$$ units of $$$i - \mathbf{B}$$$ into $$$H$$$ (if either new metal number is invalid, skip
those).</li>
</ol>
</p><p>
This procedure works because those units that we greedily transform are not something that we owe,
so we have nothing better to do with them (it may be futile to convert them, but it does not hurt).
And since we have to produce the units that we owe, we might as well just pay them back as soon
as possible, as anything we could do with the current unit we could also do with a future unit
that we would use to pay the debt instead.
</p>
<h3>Test Set 1</h3>
<p>
In Test Set 1, notice that if it is possible to find an answer $$$m$$$
for an input where $$$\mathbf{N}$$$ and all $$$\mathbf{U_i}$$$ have maximum value, that procedure also produces enough
units for any other possible input. If we implement the greedy strategy above and
try it for this particular input on increasingly large values for $$$m$$$, we can quickly
arrive at the realization that $$$m=29$$$ solves it. This means that all inputs can be
generated with a metal with number no greater than $$$29$$$. So, using the same
procedure of checking increasingly large values of $$$m$$$ for the given input is a valid
solution for the full Test Set.
</p><p>
It is also possible to notice and/or prove theoretically that there are no impossible cases
and that the answers are small. A quick argument is that numbers grow exponentially: from
a single unit of number $$$m$$$ we can create 2 units of number $$$m-2$$$ (with leftovers).
This means we can create $$$2^i$$$ units of element $$$m-2i$$$ from a single unit of element
$$$m$$$. We can distribute these among the elements $$$m-2i-\mathbf{N}+1$$$ through $$$m-2i$$$ (with
a lot of leftovers), getting
$$$2^i / \mathbf{N}$$$ units of each of $$$\mathbf{N}$$$ consecutive elements. These can be further moved to elements
with lower numbers if needed.
This shows that an $$$m$$$ such that $$$2^{m - 2 \times 20} / 20 \gt 20$$$
ought to be enough, and $$$m=49$$$ fulfills such a requirement.
</p>
<h3>Test Set 2</h3>
<p>
As the samples show, impossible cases can happen in Test Set 2. This means running our Test
Set 1 solution as is will result in the program not finishing and getting a Time Limit Exceeded
error. A simple solution, however, is to notice that there is also a somewhat small maximum
answer for all possible cases, and then simply stop once we are past it and return impossible.
</p><p>
Knowing what that maximum answer is, and proving it, is harder as we cannot just rely on
experiments. We have to lean more on the theory of the problem.
</p><p>
We can first notice that starting from metal $$$m$$$, every metal we can possibly produce
has the same remainder as $$$m$$$ modulo the
<a href="https://en.wikipedia.org/wiki/Greatest_common_divisor" target="_blank">
greatest common divisor</a>
between $$$\mathbf{A}$$$ and $$$\mathbf{B}$$$ (let us call that $$$g$$$). This is an application of
<a href="https://en.wikipedia.org/wiki/Diophantine_equation" target="_blank">
Diophantine equations</a>, but
while knowing that specific theory could help tackle the problem, it is not absolutely necessary.
Now, consider the remainder modulo $$$g$$$ of every $$$i$$$ such that $$$\mathbf{U_i} \gt 0$$$.
If they are all the same value $$$k$$$, then $$$m$$$ modulo $$$g$$$ needs to be $$$k$$$ as well.
If they are not all the same, then the case is impossible.
</p><p>
At this point, we can express all metal numbers that matter as $$$g \times x + k$$$ for some
$$$x$$$. To show that all of remaining cases are possible, we can generalize the proof we did for
Test Set 1 and use
<a href="https://en.wikipedia.org/wiki/B%C3%A9zout%27s_identity">B&eacute;zout's identity</a>
to build them,
or we can simply iterate all relatively prime values for $$$\mathbf{A} / g$$$ and $$$\mathbf{B} / g$$$
and solve the largest case experimentally.
If we do that, we can arrive at the conclusion that the maximum
possible answer for a possible Test Set 2 case is $$$402$$$. Therefore, we can do the same solution
as in Test Set 1, exploring values for $$$m$$$ up to $$$402$$$, and returning impossible if we
did not find an answer.
</p>


  <div class="test-data-download-wrapper">
    <div class="test-data-download-header">
      <div class="test-data-download-header-text">Test Data</div>
      <div class="test-data-download-header-download-button">
        <a href="test_data.zip" target="_blank">
          <i class="material-icons grey">save_alt</i>
        </a>
      </div>
    </div>
    <div class="test-data-download-content">
      <div class="test-data-download-warning">
        <span class="material-icons" style="color: grey; vertical-align: middle;">info</span>
        <span style="vertical-align: middle;">We recommend that you practice debugging solutions without looking at the test data.</span>
      </div>
    </div>
  </div>


    </div>
  </body>
</html>
