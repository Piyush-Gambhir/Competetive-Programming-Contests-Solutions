
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Code Jam 2021 - World Finals</h3><h1>Analysis: Ropes</h1><a href="https://youtu.be/exEwKRKZP64" target="_blank">View problem and solution walkthrough video</a>
<p>
  This problem can be solved in many different ways! Below is a collection of different solutions
  we came across. If yours is not here, we would love to hear it! Head over to our
  <a href="https://groups.google.com/forum/#!forum/google-code" target="_blank">Code Jam group</a>
  and share your favorite idea.
</p>
<p>
  For consistency, here are a few terms we will use throughout:
  <ul>
    <li>
      "Playing $$$(x,y)$$$" means connecting tree $$$x$$$ on the North
      to tree $$$y$$$ on the South.
    </li><li>
      "Playing greedily" means looking at all possible options and choosing a move that
      maximizes your score on this turn. Sometimes we will choose randomly, sometimes
      we will pick a specific one of these. Note that the judge plays greedily (and
      chooses their move randomly).
    </li>
  </ul>
</p><p>
  The percentages given below are approximate (found via experimentation) and rounded to the
  closest integer value.
</p>

<h3>Playing Greedily</h3>
<p><b>... by picking randomly ($$$28\%$$$)</b></p>
<p>
  We just pick our move randomly like the opponent is going to. This is not a great strategy!
</p>
<p><b>... by picking non-randomly ($$$55\%$$$)</b></p>
<p>
  This strategy works surprisingly well for how simple it is. Simply play the same
  way as your opponent, except instead of picking randomly, choose the one that comes
  first lexicographically&mdash;that is, choose $$$(x,y)$$$ that minimizes $$$x$$$,
  then minimizes $$$y$$$ if there is a tie. To understand why it works well,
  read the "Push Them East!" strategy, as they work for similar reasons.
</p>
<p><b>... by picking non-randomly and starting in a better place</b></p>
<p>
  This the same as the previous strategy, but instead of starting at $$$(1,1)$$$, we
  pick some other spot. The result varies depending on the exact starting spot, but
  $$$(1,3)$$$ already gets us $$$75\%$$$ probability of winning. Read below to understand
  why this has such a big impact in the overall probability.
</p>

<h3>Mirroring</h3>
<p><b>First attempt ($$$64\%$$$)</b></p>
<p>
  This strategy is based on a simple idea: if the opposing team plays $$$(x,y)$$$, then
  we will play $$$(y,x)$$$. Why is this a good idea? Because if they just played $$$(x,y)$$$ and
  scored $$$\Delta$$$ points, then we will score $$$\Delta + 1$$$ points on our turn because
  we will also cross their newly placed rope as well as all other ropes the opponent just
  crossed.
</p><p>
  There are two issues, though. The first issue is that we are going first, so we cannot mirror
  them. We will solve this by playing $$$(1,1)$$$ as our first move. This move does not impact
  the remainder of the game as no other rope can cross this one. The second issue is what to
  do when they play $$$(x,x)$$$? In this case, we will just play
  the highest scoring $$$(z,z)$$$ that is available.
</p>
<p><b>Now with a better start ($$$82\%$$$)</b></p>
<p>
  This strategy is the same as the previous section, except our first move is $$$(10,10)$$$
  instead of $$$(1,1)$$$. Why is this better? Think about when we did well in the previous
  version. If $$$x \neq y$$$, then we gain one point on them. The only time they can gain
  on us is if $$$x = y$$$ (or it is their last turn). By playing $$$(10,10)$$$, we are encouraging
  them to play diagonal moves early on in the game, which gains us a reasonably good lead.
  10 was found experimentally to be the best value. Starting with $$$(2,2)$$$ gives $$$72\%$$$
  and starting with $$$(25,25)$$$ gives $$$64\%$$$.
</p>

<h3>Push It East!</h3>
<p><b>First attempt ($$$50\%$$$)</b></p>
<p>
  It will help to think of this in three phases:
  Phase $$$1$$$ sets up the ropes in a reasonable way (and hopefully gains us some points). Phase $$$2$$$
  plays greedily (and hopefully maintains the lead from Phase $$$1$$$). Phase $$$3$$$ is the final turn
  for our opponent (hopefully their score from this turn is small).
</p><p>
  This strategy is called "Push It East!" because our main goal is to make Phase $$$3$$$ as bad as
  possible for our opponent, and how we do that is ensure that their final move is as far
  East as possible. If their final move is $$$(x,y)$$$, then the maximum
  they can possibly score is $$$(100-x) + (100-y)$$$. In particular, if we can push them
  all the way to the East, they will score 0.
</p><p>
  For our first attempt, Phase $$$1$$$ will simply "give up" our first turn by playing $$$(1,1)$$$.
  We enter Phase $$$2$$$ now (note that we are currently tied).
  Phase $$$2$$$ will play greedily, breaking ties by taking more western trees as often as possible
  (say by choosing $$$(x,y)$$$ that minimizes $$$x + y$$$).
  With this setup, Phase $$$3$$$ will typically take a tree that is quite far East. (Yay!)
</p>
<p><b>A better start ($$$73\%$$$)</b></p>
<p>
  If we start Phase $$$1$$$ with $$$(2,2)$$$, then the opponents will play $$$(1,x)$$$ (or $$$(x,1)$$$),
  scoring one point. We then play $$$(1,3)$$$ (or $$$(3,1)$$$), scoring two points. At this point,
  we enter Phase $$$2$$$ ahead by one point and the opponent can only score at most one point on the
  next turn. This dramatically improves our win probability.
</p>
<p><b>A great start ($$$92\%$$$)</b></p>
<p>
  Let $$$z$$$ be an integer near 10 (say 9, 10, or 11). Let's start Phase $$$1$$$ with $$$(z,z)$$$.
  For the next few moves, the opponent's moves will typically be $$$(x,y)$$$,
  where one of
  $$$x$$$ and $$$y$$$ is "small" ($$$\lt z$$$) and the other is "large" ($$$\gt z$$$).
  We can continue encouraging the opponent to make these "small"/"large" moves by choosing
  moves that are "short" ($$$(x,y)$$$ or $$$(y,x)$$$ where $$$x \lt 10$$$,
  but as large as possible, and $$$y \gt 10$$$, but as small as possible). We will continue making
  "short" moves which further encourages the opponent making "small"/"large" moves.
</p><p>
  Say $$$z = 10$$$. After we have made $$$10$$$ moves (and the opponent has made $$$9$$$),
  we should now be ahead by $$$5$$$ to $$$10$$$ points
  (since we score approximately $$$0+2+\cdots+18$$$ and they score approximately
  $$$1+3+5+\cdots+17$$$). Phase $$$2$$$ contains 90 greedy moves for each of us where we
  typically maintain the $$$5-10$$$ point lead. Then, in the opponent's final turn,
  we hope they score fewer than 5 points since we have pushed them so far East.
</p><p>
  Notice that just choosing every move (except the first) to be $$$(x,y)$$$ that first maximizes
  the score, then minimizes $$$x + y$$$ as above
  also works quite well because maximum score moves will usually cross our $$$(z,z)$$$ rope.
  This gets win percentages around $$$92\%$$$ as well.
</p>

    </div>
  </body>
</html>
