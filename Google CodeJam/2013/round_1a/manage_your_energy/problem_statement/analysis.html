
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Code Jam 2013 - Round 1A</h3><h1>Analysis: Manage your Energy</h1><h2>The small dataset</h2>
<p>The limits in the small dataset are very small for this problem, and they allow brute-force approaches. With a fast enough language, even an algorithm that for each activity in the row tries each possible amount of energy usage (from 0 to current energy) will run in time.</p>

<p>The large dataset obviously does not allow such a solution &mdash; both the number of activities and the number of possible amounts of energy to consider are significantly too large.</p>

<h2>The highest-valued activity</h2>
<p>We will begin solving this problem by looking at the highest-value activity (if there is more than one, pick any of them), let this be activity number <b>a</b>. We will prove that there exists an optimal solution that uses full <b>E</b> joules for this activity.</p>

<p>Consider any optimal solution. First assume that we had less than <b>E</b> joules at the start of activity <b>a</b>. This means we spent energy on some other activity before (since we started with <b>E</b> energy), let <b>b</b> be the number of the last activity we spent non-zero energy on before <b>a</b>. Now consider a solution in which we spend one joule less on <b>b</b>. Since our energy wasn't <b>E</b> in the original solution at the beginning of <b>a</b>, if we spend one less joule on <b>b</b>, we will still have at most <b>E</b> energy at the beginning of <b>a</b>, and so it won't go to waste. Thus, we can spend this extra joule on <b>a</b>, and then proceed as in the original solution, since after <b>a</b> we have exactly the same amount of energy as in the original. The difference in values of these two solutions is -<b>v<sub>b</sub></b> + <b>v<sub>a</sub></b>, which is non-negative (since <b>a</b> was one of the highest-value solutions). We can repeat this procedure until we obtain a solution which is no worse than the original (and thus still optimal), and has <b>E</b> joules at the beginning of <b>a</b>.</p>

<p>Now assume that we have an optimal solution that enters <b>a</b> with <b>E</b> joules, but does not use all of them on <b>a</b>. We can change it in a similar fashion. Find the first activity after <b>a</b> on which we spend non-zero energy, call it <b>c</b>. If it doesn't exist, or if any energy is wasted between <b>a</b> and <b>c</b>, we can simply expend one more joule on <b>a</b> and obtain a strictly better solution. Otherwise, we can spend one joule less on <b>c</b> and one more on <b>a</b>, to obtain a solution that's no worse.</p>

<p>After repeating these procedures as long as we can, we obtain an optimal solution in which, indeed, we spend full <b>E</b> joules on <b>a</b>.</p>

<h2>Other activities</h2>
<p>Notice that the fact we are spending <b>E</b> energy on <b>a</b> has some implications on the nearby activites. For instance, we will have at most <b>R</b> energy available at <b>a</b>+1, at most 2<b>R</b> at <b>a</b>+2, etc. At the same time, we need to leave <b>a</b>-1 with at least <b>E</b>-<b>R</b> energy, leave <b>a</b>-2 with at least <b>E</b>-2<b>R</b> energy, and so on.</p>

<p>Consider the activity <b>d</b> with the next-highest value after <b>a</b>. We have a limit on how much energy we have at most when entering <b>d</b> (it's the lower of two numbers &mdash; <b>E</b> and whatever limit the spending on <b>a</b> imposed); and we know how much energy we have left unspent (the higher of 0 and the limit imposed by <b>a</b>). We will spend anything between these two limits on activity <b>d</b> &mdash; a reasoning identical to the one for <b>a</b> proves that this doesn't prevent us from getting an optimal solution.</p>

<p>We will continue in this fashion. At each step, we will have for each activity an amount of energy that we have to leave after ending it for activities we already considered, and the maximum amount of energy we can have beginning this activity. At each step, we will take the highest-valued activity we haven't considered yet, and assign to it all the energy we can, updating the limits afterwards.</p>

<p>The time complexity of this solution, as formulated, is O(<b>N</b><sup>2</sup>) &mdash; in each of the <b>N</b> steps we find the highest-valued activity not considered yet, assign energy to it, and update limits for all other activities. Due to the constraints on input size that we have this will be fast enough (at least if written reasonably efficiently). It is possible to do better, though.</p>

<h2>An O(<b>N</b> log<b>N</b>) solution</h2>
<p> First note that finding the highest-valued activity not considered yet can be done faster &mdash; it's enough to just sort the activities by value up front, and then consider them in descending order.</p>

<p>The more difficult part is updating the limits. To do this, we look at how the limits are set again. Each activity we assign imposes a limit on how much energy do we have in later activities, and how much do we have to leave behind in the previous activities. We would like to prove that for each activity <b>a</b> the limit we have to consider comes from the latest activity in the day we considered before <b>a</b> for how much energy we have, and the first activity we considered later in the day than <b>a</b> for how much we need to leave unspent.</p>

<p>This is not surprising. Consider, for instance, the activity <b>b</b>, which is the latest activity considered before <b>a</b>, and some activity <b>c</b> which comes even earlier in the day. If we considered <b>c</b> before <b>b</b>, the loss of energy on activity <b>c</b> is already taken into account when we consider <b>b</b>, so the limits imposed by <b>b</b> will be no less stringent. On the other hand, if we considered <b>c</b> after <b>b</b>, it means that the energy spent on <b>c</b> was already limited so that it would all be recovered by the time we reach <b>b</b> &mdash; and so it does not impact the amount of energy we have available at <b>a</b>. A similar reasoning works for activities later in the day than <b>a</b>.</p>

<p>A solution in which each step takes logarithmic time will take each considered activity and insert it (along with the limits it imposes) into a binary search tree allowing logarithmic-time insertions and lower/upper-bound operations (like the "set" structure of many languages). Then, at each subsequent activity, we find the nearest activity already considered before and after it, compute the limits they impose on the current activity, spend all the energy we can (updating the total value) and insert this activity (along with new limits) into the tree.</p>

<p>Note that if <b>R</b> &ge; <b>E</b>, you can just assume <b>R</b> = <b>E</b>, since any energy you regain above <b>E</b> will necessarily go to waste. We observed this and changed the problem statement to avoid this unnecessary case; but we missed some of the inputs in which this should have been corrected, due to which we had to change the statement back and issue a clarification during the contest. We apologize for the confusion this caused.</p>

<h2>An O(<b>N</b>) solution</h2>
<p>One nice thing about running a contest for a group of very smart people is that they come up with solutions for problems that the authors didn't even think of! This was the case with this problem &mdash; after the contest we learned some contestants came up with a O(<b>N</b>) solution.</p>

<p>The key to this solution is observing that we can actually know up front how much energy we will want to spend at a given day. As seen above, if there is no more valuable activity ahead of us, we should just spend all the energy we have at the moment. On the other hand, if there is something more valuable, it's always a good idea to save up energy if we will be able to use it for the more valuable activity. To make use of this we need to know, for each activity, the nearest activity in the future that's more valuable.</p>

<p>Calculating such an array is a classic problem, it is described, e.g., as the "Stock Span Problem" in the <a href="http://en.wikipedia.org/wiki/Stack_(abstract_data_type)" target="_blank">Wikipedia article on stacks</a>. Once we have this array, we can, for each activity in chronological order, do the following:
<ul>
<li> If there is no more valuable activity coming up, spend all the energy we have.</li>
<li> Consider the nearest more valuable activity <b>X</b>. If we can spend any energy, and still have <b>E</b> energy when <b>X</b> comes (assuming we don't spend any between now and <b>X</b>), spend as much as we can while still having <b>E</b> when <b>X</b> comes. Notice the alternative to spending it now would be to spend it between now and <b>X</b> &mdash; but there's no activity more valuable than the current one in the period to make it worthwhile.</li>
<li> If we can't spend any energy and still have <b>E</b> when <b>X</b> comes, we shouldn't spend any &mdash; all our energy will be better spent at <b>X</b>.</li>
</ul>
</p>

<p>Thanks to for pointing this out to us! The credit for this solution goes to  pedrosorio; other O(<b>N</b>) solutions are possible as well (see, e.g., misof's submission).</p>

  <div class="test-data-download-wrapper">
    <div class="test-data-download-header">
      <div class="test-data-download-header-text">Test Data</div>
      <div class="test-data-download-header-download-button">
        <a href="test_data.zip" target="_blank">
          <i class="material-icons grey">save_alt</i>
        </a>
      </div>
    </div>
    <div class="test-data-download-content">
      <div class="test-data-download-warning">
        <span class="material-icons" style="color: grey; vertical-align: middle;">info</span>
        <span style="vertical-align: middle;">We recommend that you practice debugging solutions without looking at the test data.</span>
      </div>
    </div>
  </div>



    </div>
  </body>
</html>
