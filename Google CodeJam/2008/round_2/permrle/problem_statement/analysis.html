
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Code Jam 2008 - Round 2</h3><h1>Analysis: PermRLE</h1><h3>Section A. The Hamiltonian cycle in a small world</h3>
<p>
  A Hamilton cycle in a graph is a cycle that visits each node exactly once.
  Given a weighted, directed, complete graph on n nodes, there are (n-1)!
  distinct Hamiltonian cycles. It is well known that the problem of finding the
  shortest (or longest) Hamilton cycle is NP-hard. It is also known to many
  contestants that, for n as small as 20, dynamic programming makes a difference
  of n*2<sup>n</sup> vs. n!, which is the difference between a second and an
  eternity.
</p><p>
  Let's have a look at the n*2<sup>n</sup> DP trick, in case you have not seen
  it before.
</p><p>
  Without loss of generality, we may view node 0 as the start point of the
  cycle, as well as its end point. For any subset A of the node set V and any
  node x in A, we define
</p>
<blockquote>
  dp[A][x] := The shortest path that starts from x, visits each point in A
  exactly once and ends up at node 0. (*)
</blockquote>
<p>
  To clarify, 0 does not necessary belong to A, but we do count the length of
  the edge from the last point to node 0. Thus the problem of finding the
  shortest Hamilton cycle is just dp[V][0]. (Convince yourself, maybe looking at
  (*).)
</p><p>
  We need to compute dp[A][x]. For the easy cases where A = {x}, the answer is
  just the length of edge x&rarr;0. Otherwise, we focus on the first step of the
  path. If the first step is x&rarr;y, with edge length q, then we pay
  <nobr>dp[A - x][y] + q</nobr>. In general, dp[A][x] is
</p>
<ul>
  <li>length(x&rarr;0), if A = {x}.</li>
  <li>min { dp[A - x][y] + length(x&rarr;y) | y in A - x }, if |A|&gt;1.</li>
</ul>

<h3>Section B. Wrap everything into a small world</h3>
<p>
  For any string, define the <i>number of switches</i> to be the number of times
  adjacent characters are different in the string. We want to find a permutation
  that transforms <b>S</b> to one <b>S'</b> where the number of switches is
  minimal. Assume the length of <b>S</b> is <b>mk</b>. Then <b>S</b> can be
  viewed as a string with <b>m</b> blocks of length <b>k</b>.
</p><p>
  Now we introduce a visual aid to simplify our writing. Let us draw the string
  <b>S</b> as <b>m</b> rows, each block on a single row. The key image is to
  count the number of switches one <i>column</i> at a time.
</p><p>
  Let us take a semi-concrete example. Suppose that at one point we have decided
  that 5 is permuted to the 7th position, and that 2 goes to the 8th position.
  Then without knowing the rest of the permutation, we can inspect the 5th and
  2nd characters in each block. Suppose that in Z of the blocks the 5th and the
  2nd characters are different, then we know that in any such permutation, we
  will have to pay the price of Z.
</p><p>
  The one exception is the last element of the permutation. In all cases but
  one, we simply wrap around to the beginning because the end of each k-block
  touches the beginning of the next k-block in the string, except for the last
  character in the string. We can handle both cases if we fix the last element
  of the permutation by trying all possibilities.
</p><p>
  Next, we reduce our problem to the one in Section A. Suppose we fix
  <b>T</b> as the last element in the permutation. Define a weighted, directed,
  complete graph G on <b>k</b> vertices {1, 2, ..., k}. The weight on the edge
  x&rarr;y is
</p>
<ul>
  <li>
    the number of blocks where the x-th character is different from the y-th
    character in the same block. (if x &ne; T)
  </li>
  <li>
    the number of blocks (excluding the last one) where the x-th character is
    different from the y-th character in the <i>next</i> block. (if x = T)
  </li>
</ul>
<p>
  It is easy to check that for any permutation, the number of switches is the
  same as the length of the corresponding Hamiltonian cycle in G.
</p><p>
  We have <b>k</b> different choices for T. For each T, finding the shortest
  Hamilton cycle takes O(2<sup>k</sup> k) time. The construction of the graph
  takes O(k<sup>2</sup>m) = O(k |S|) time for each T; it is also easy to
  construct in O(k<sup>2</sup>m) time the graphs for all the T's. The running
  time of the solution is O(2<sup>k</sup> k<sup>2</sup> + k |S|).
</p>


  <div class="test-data-download-wrapper">
    <div class="test-data-download-header">
      <div class="test-data-download-header-text">Test Data</div>
      <div class="test-data-download-header-download-button">
        <a href="test_data.zip" target="_blank">
          <i class="material-icons grey">save_alt</i>
        </a>
      </div>
    </div>
    <div class="test-data-download-content">
      <div class="test-data-download-warning">
        <span class="material-icons" style="color: grey; vertical-align: middle;">info</span>
        <span style="vertical-align: middle;">We recommend that you practice debugging solutions without looking at the test data.</span>
      </div>
    </div>
  </div>



    </div>
  </body>
</html>
