
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Code Jam 2008 - Round 3</h3><h1>Portal</h1><h3>Problem</h3>
<p>
  Portal<sup>TM</sup> is a first-person puzzle/platform game developed and
  published by Valve Software. The idea of the game was to create two portals on
  walls and then jump through one portal and come out the other. This problem
  has a similar idea but it does not assume you have played Portal.
</p><p>
  For this problem you find yourself in a <b>R</b> by <b>C</b> grid.
  Additionally there is a delicious cake somewhere else in the grid. You're very
  hungry and wish to arrive at the cake with as few moves as possible. You can
  move north, south, east or west to an empty cell. Additionally, you have the
  ability to create portals on walls.
</p><p>
  To help you get to the cake you have a portal gun which can shoot two types of
  portals, a yellow portal and a blue portal. A portal is created by shooting
  your portal gun either north, south, east or west. This emits a ball of energy
  that creates a portal on the first wall it hits. Note that for this problem
  shooting the portal gun does not count as a move. If you fire your portal gun
  at the cake, the energy ball will go right through it.
</p><p>
  After creating a yellow portal and a blue portal, you can move through the
  yellow portal to arrive at the blue portal or vice versa. Using these portals
  you may be able to reach the cake even faster! You can only use portals after
  you create both a yellow and a blue portal.
</p><p>
  Consider the following grid:
</p>
<img src="portal1.png" />
<p>
  Gray cells represent walls, white cells represent empty cells, and the red
  circle indicates your position.
</p><p>
  Suppose you shoot a blue portal east. The portal is created on the first wall
  it hits, resulting in:
</p>
<img src="portal2.png" />
<p>
  Now suppose you shoot a yellow portal south:
</p>
<img src="portal3.png" />
<p>
  Next you move south once:
</p>
<img src="portal4.png" />
<p>
  Now comes the interesting part. If you move south one more time you go through
  the yellow portal to the blue portal:
</p>
<img src="portal5.png" />
<p>
  There can only be one yellow portal and one blue portal at any time. For
  example if you attempt to create a blue portal to the west the other blue
  portal will disappear:
</p>
<img src="portal6.png" />
<p>
  A portal disappears only when another portal of the same color is fired.
</p><p>
  Note that the portals are created on one side of the wall. If a wall has a
  portal on its east side you must move into the wall from the east to go
  through the portal. Otherwise you'll be moving into a wall, which is
  improbable.
</p><p>
  Finally, you may not put two portals on top of each other. If you try to fire
  a portal at a side of a wall that already has a portal, the second portal will
  fail to form.
</p><p>
  Given the maze, your initial position, and the cake's position, you want to
  find the minimum number of moves needed to reach the cake if it is possible.
  Remember that shooting the portal gun does not count as a move.
</p>

<h3>Input</h3>
<p>
  The first line of input gives the number of cases, <b>N</b>. <b>N</b> test
  cases follow.
</p><p>
  The first line of each test case will contain the integers <b>R</b> and
  <b>C</b> separated by a space. <b>R</b> lines follow containing
  <b>C</b> characters each, representing the map:
</p>
<ul>
  <li><code>.</code> indicates an empty cell;</li>
  <li><code>#</code> indicates a wall;</li>
  <li><code>O</code> indicates your starting position; and</li>
  <li><code>X</code> indicates the cake's position.</li>
</ul>
<p>
  There will be exactly one <code>O</code> and one <code>X</code> character per
  case.
</p><p>
  Cells outside of the grid are all walls and you may use them to create
  portals.
</p>

<h3>Output</h3>
<p>
  For each test case you should output one line containing "Case #<b>X</b>:
  <b>Y</b>" (quotes for clarity) where <b>X</b> is the number of the test case
  and <b>Y</b> is the minimum number of moves needed to reach the cake or "THE
  CAKE IS A LIE" (quotes for clarity) if the cake cannot be reached.
</p>

<h3>Limits</h3>
<p>
  Time limit: 30 seconds per test set.<br>
  Memory limit: 1GB.
</p>

<h4>Small dataset (Test set 1 - Visible)</h4>
<p>
  <b>N</b> = 200<br>
  1 &le; <b>R</b>, <b>C</b> &le; 8
</p>

<h4>Large dataset (Test set 2 - Hidden)</h4>
<p>
  <b>N</b> = 50<br>
  1 &le; <b>R</b>, <b>C</b> &le; 15
</p>


  <h3>Sample</h3>
  <div class="problem-io-wrapper-new">
    <div class="sampleio-wrapper">
      <div class="sample-input">
        <div class="sample-header">
          <div class="sample-header-text">Sample Input</div>
          <div class="sample-header-download-button">
            <a href="portal_sample_ts1_input.txt" target="_blank" aria-label="Download">
              <i class="material-icons grey">save_alt</i>
            </a>
          </div>
          <div class="sample-header-copy-button" onclick="
              const copyText = document.getElementById('sample_input_0').textContent;
              const textArea = document.createElement('textarea');
              textArea.textContent = copyText;
              textArea.style.position = 'absolute';
              textArea.style.left = '-100%';
              document.body.append(textArea);
              textArea.select();
              document.execCommand('copy');
              textArea.remove();
              const copyPopup = document.getElementById('sample_input_copy_popup_0');
              copyPopup.classList.add('sample-header-copy-popup-shown');
              setTimeout(function(){ copyPopup.classList.remove('sample-header-copy-popup-shown'); }, 2000);
          " aria-label="Copy to clipboard">
            <i class="material-icons grey">content_copy</i>
            <span class="sample-header-copy-popup" id="sample_input_copy_popup_0">
              Copied!
            </span>
          </div>
        </div>
        <div class="sample-content">
          <pre class="sample-content-text" id="sample_input_0">3
4 7
.O..##.
.#.....
.#.####
.#...X.
5 5
O....
.....
.....
.....
....X
1 3
O#X
</pre>
        </div>
      </div>
      <div class="sample-output">
        <div class="sample-header">
          <div class="sample-header-text">Sample Output</div>
          <div class="sample-header-download-button">
            <a href="portal_sample_ts1_output.txt" target="_blank" aria-label="Download">
              <i class="material-icons grey">save_alt</i>
            </a>
          </div>
          <div class="sample-header-copy-button" onclick="
              const copyText = document.getElementById('sample_output_0').textContent;
              const textArea = document.createElement('textarea');
              textArea.textContent = copyText;
              textArea.style.position = 'absolute';
              textArea.style.left = '-100%';
              document.body.append(textArea);
              textArea.select();
              document.execCommand('copy');
              textArea.remove();
              const copyPopup = document.getElementById('sample_output_copy_popup_0');
              copyPopup.classList.add('sample-header-copy-popup-shown');
              setTimeout(function(){ copyPopup.classList.remove('sample-header-copy-popup-shown'); }, 2000);
          " aria-label="Copy to clipboard">
            <i class="material-icons grey">content_copy</i>
            <span class="sample-header-copy-popup" id="sample_output_copy_popup_0">
              Copied!
            </span>
          </div>
        </div>
        <div class="sample-content">
          <pre class="sample-content-text" id="sample_output_0">Case #1: 4
Case #2: 2
Case #3: THE CAKE IS A LIE
</pre>
        </div>
      </div>
    </div>
  </div>


<p>
  Here is the sequence of moves for the first case (note that shooting the
  portal gun does not count as a move):
</p>
<ol>
  <li>Move one step east.</li>
  <li>Shoot a blue portal north.</li>
  <li>Shoot a yellow portal south.</li>
  <li>Move one step north through the blue portal.</li>
  <li>Shoot a blue portal east.</li>
  <li>Move one step south through the yellow portal.</li>
  <li>Move one step west.</li>
  <li>Eat your delicious and moist cake.</li>
</ol>

<p>
  Portal<sup>TM</sup> is a trademark of Valve Inc. Valve Inc. does not endorse
  and has no involvement with Google Code Jam.
</p>

    </div>
  </body>
</html>
