
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Code Jam 2012 - Round 3</h3><h1>Analysis: Perfect Game</h1><h3>Preamble</h3>
<p>
It will come as no great surprise that this problem was inspired by a video game that the author played: Super Meat Boy.  Turning the real achievement challenge into a Code Jam problem involved a little simplifying: it doesn't take the same amount of time to lose a level as to win it, for example.
</p>

<h3>Total Expected Time and Number of Attempts</h3>

<p>
Your total expected time to complete the achievement will be the expected number of attempts, times the expected time per attempt.
</p>

<p>
First, let's figure out how many attempts it's going to take us to complete the achievement.  The probability of success in any given attempt is easy to compute, since it's simply the probability of succeeding on every level once without failing any of them: <code>(1-P<sub>1</sub>)*(1-P<sub>2</sub>)*...*(1-P<sub>N</sub>)</code>.  The expected number of attempts won't depend on anything other than this probability, and this probability doesn't depend on the order of the levels; so the expected number of attempts doesn't depend on the order of the levels, and we can ignore it when figuring out what order to attempt them in.
</p>

<p>
In case you're curious about what the expected number of attempts is anyway, read on.  Let's say that we're going to try to do something that might fail, like complete this achievement, and that we're going to keep trying until we succeed.  If the probability of success is <code>P</code>, then what we're doing is called a <a href="http://en.wikipedia.org/wiki/Bernoulli_trial" target="_blank">Bernoulli Trial</a>, repeated until we achieve success.  The number of attempts that will take falls into a random distribution called the <a href="http://en.wikipedia.org/wiki/Geometric_distribution" target="_blank">Geometric Distribution</a>.  The expected value of this distribution&ndash;the number of attempts it will take&ndash;is <code>1/P</code>.
</p>

<p>
Knowing about the Geometric Distribution lets us compute the expected number of attempts easily.  The chance that we'll complete every level successfully, one after another, is the product of the probabilities of success, which we'll call <code>P</code>; the number of attempts it will take us to complete that is <code>1/P</code>.  As promised, this number doesn't depend on the order in which we attempt the levels, and since what we're trying to do is compute the best order, we're going to ignore it.
</p>

<h3>Time Per Attempt</h3>

<p>
Let's choose an arbitrary order for the levels.  Suppose the i<sup>th</sup> of those levels takes t<sub>i</sub> time, and you die in that level with probability p<sub>i</sub>.  In any attempt, you'll definitely reach level 1; you'll reach level 2 with probability <code>1-p<sub>1</sub></code>; you'll reach level 3 with probability <code>(1-p<sub>1</sub>)*(1-p<sub>2</sub>)</code>; and so on.
</p>
<p>
Based on those calculations, the amount of time it takes you to make one attempt will be <code>expected time = t<sub>1</sub> + (1-p<sub>1</sub>)t<sub>2</sub> + (1-p<sub>1</sub>)(1-p<sub>2</sub>)t<sub>3</sub> + ...</code>.  This is because you will try level <code>i</code> only if you pass the first <code>i-1</code> levels.
</p>
<p>
Now, let's consider what would happen to that expected time if we swapped levels <code>i</code> and <code>i+1</code>.  Only two of the terms of the expected time equation would be affected&mdash;the others would simply reverse the order of <code>(1-p<sub>i</sub>)</code> and <code>(1-p<sub>i+1</sub>)</code>, which doesn't matter.  Those two terms themselves have several multiplicative terms in common:
</p>
<p>
<b>Pre-swap:</b><br/><code>(1-p<sub>1</sub>)(1-p<sub>2</sub>)...(1-p<sub>i-1</sub>)t<sub>i</sub> +<br/>(1-p<sub>1</sub>)(1-p<sub>2</sub>)...(1-p<sub>i-1</sub>)(1-p<sub>i</sub>)t<sub>i+1</sub></code>.<br/>
<b>Post-swap:</b><br/><code>(1-p<sub>1</sub>)(1-p<sub>2</sub>)...(1-p<sub>i-1</sub>)t<sub>i+1</sub> +<br/>(1-p<sub>1</sub>)(1-p<sub>2</sub>)...(1-p<sub>i-1</sub>)(1-p<sub>i+1</sub>)t<sub>i</sub></code>.
</p>
<p>
So we're better off post-swap iff:<br/>
<code>t<sub>i</sub> + (1-p<sub>i</sub>)t<sub>i+1</sub> &gt; t<sub>i+1</sub> + (1-p<sub>i+1</sub>)t<sub>i</sub></code><br/>
<code>t<sub>i</sub>p<sub>i+1</sub> &gt; t<sub>i+1</sub>p<sub>i</sub></code><br/>
</p>
<p>
Now we can compare two adjacent levels to see whether they should be swapped.  Doing this greedily results in a <a href="http://en.wikipedia.org/wiki/Sorting_algorithm#Stability" target="_blank">stable sort</a> of the levels.  With a little more work, you can prove that non-adjacent levels should be swapped under the same conditions, and that the stable sort is thus optimal.
</p>

<h3>Implementation Details</h3>
<p>
Our last inequality above said we should swap iff 
<code>t<sub>i</sub>p<sub>i+1</sub> &gt; t<sub>i+1</sub>p<sub>i</sub></code>.  It's tempting to go one step further, to <code>t<sub>i</sub>/p<sub>i</sub> &gt; t<sub>i+1</sub>/p<sub>i+1</sub></code>, but we can't: <code>p<sub>i</sub></code> or <code>p<sub>i+1</sub></code> could be zero, and dividing by zero isn't a mathematically valid thing to do.
</p>
<p>
Another reason not to make that final step&ndash;though the final step actually kind of works if you don't mind special-casing <code>p<sub>i</sub>=0</code> to give an infinite score&ndash;is because division almost inevitably makes us deal with floating-point numbers.  In a problem like this where we're trying to make a decision based on numbers, we want to make sure we're doing exact comparisons.  We wouldn't want to reverse two equivalent levels because <code>t<sub>i</sub>/p<sub>i</sub> = 10.0000000001</code> and <code> t<sub>i+1</sub>/p<sub>i+1</sub> = 10.0</code>.
</p>

  <div class="test-data-download-wrapper">
    <div class="test-data-download-header">
      <div class="test-data-download-header-text">Test Data</div>
      <div class="test-data-download-header-download-button">
        <a href="test_data.zip" target="_blank">
          <i class="material-icons grey">save_alt</i>
        </a>
      </div>
    </div>
    <div class="test-data-download-content">
      <div class="test-data-download-warning">
        <span class="material-icons" style="color: grey; vertical-align: middle;">info</span>
        <span style="vertical-align: middle;">We recommend that you practice debugging solutions without looking at the test data.</span>
      </div>
    </div>
  </div>



    </div>
  </body>
</html>
