
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Code Jam 2012 - World Finals</h3><h1>Analysis: Twirling Towards Freedom</h1><p><b>The Small Input</b></p>

<p>On most Google Code Jam problems, the small input can be solved without worrying about the running time. That was not the case here though. Even if N = 10 and M = 10, there are still 10<sup>10</sup> different rotation patterns you could try. That is a lot!</p>

<p>There are various ways you could try to bring the running time down to a more manageable amount, but here is one fact that makes it easy:
<ul>
<li>The 1st star you rotate around, the 5th star you rotate around, and the 9th star you rotate around should all be the same.
<li>The 2nd star you rotate around, the 6th star you rotate around, and the 10th star you rotate around should all be the same.
<li>The 3rd star you rotate around and the 7th star you rotate around should be the same.
<li>The 4th star you rotate around and the 8th star you rotate around should be the same.
</ul>
If you realize this, there are only 10<sup>4</sup> possibilities to try. But why is this fact true? Read on and you'll find out!</p>

<br/>
<p><b>Understanding Rotations</b></p>

<p>
One of the biggest challenges here is just wrapping your head around the problem. How can you intuitively understand what it means to rotate something 100,000 times? The best way to do this is to roll up your sleeves and write down a couple formulas.
</p>

<p>
When dealing with rotations and translations of points on a plane, <i>complex numbers</i> provide an excellent notation:
<ul>
<li> A point (x, y) can be represented as x + iy.
<li> Complex numbers can be added and subtracted just like vectors.
<li> Complex numbers can be rotated clockwise 90 degrees about the origin simply by multiplying them by -i.
</ul>
It is this last property that makes them so clean to work with, and it is what we will use for the analysis. If you prefer, you could also imagine replacing everything with matrices.
</p>

<p>
We know that rotating a point P<sub>0</sub> by 90 degrees about the origin will send it to -i * P<sub>0</sub>. However, what happens if we rotate it about a different point Q<sub>0</sub>? There is a standard formula for this situation that you may have already seen. The resulting point P<sub>1</sub> satisfies the following:<p>

<blockquote>P<sub>1</sub> - Q<sub>0</sub> = -i * (P<sub>0</sub> - Q<sub>0</sub>)</blockquote>

<p>This is our previous formula applied to the fact that rotating P<sub>0</sub> - Q<sub>0</sub> by 90 degrees about the origin must give you P<sub>1</sub> - Q<sub>0</sub>. (Do you see why that is true? It's really just a coordinate change.) In our case, it will be helpful to group things a little differently in the formula:

<blockquote>P<sub>1</sub> = -iP<sub>0</sub> + Q<sub>0</sub> * (1 - i)</blockquote>

<p>Now, suppose we rotate P<sub>1</sub> by 90 degrees about another point Q<sub>1</sub>, then by 90 degrees about another point Q<sub>2</sub>, and so on. What would happen to this formula? Let's write out a few examples:

<ul>
<li> P<sub>2</sub> = -iP<sub>1</sub> + Q<sub>1</sub> * (1 - i) = -P<sub>0</sub> + Q<sub>1</sub> * (1 - i) + Q<sub>0</sub> * (-1 - i).
<li> P<sub>3</sub> = -iP<sub>2</sub> + Q<sub>2</sub> * (1 - i) = iP<sub>0</sub> + Q<sub>2</sub> * (1 - i) + Q<sub>1</sub> * (-1 - i) + Q<sub>0</sub> * (-1 + i).
<li> P<sub>4</sub> = -iP<sub>3</sub> + Q<sub>3</sub> * (1 - i) = P<sub>0</sub> + Q<sub>3</sub> * (1 - i) + Q<sub>2</sub> * (-1 - i) + Q<sub>1</sub> * (-1 + i) + Q<sub>0</sub> * (1 + i).
<li> P<sub>5</sub> = -iP<sub>4</sub> + Q<sub>4</sub> * (1 - i) = -iP<sub>0</sub> + (Q<sub>4</sub> + Q<sub>0</sub>) * (1 - i) + Q<sub>3</sub> * (-1 - i) + Q<sub>2</sub> * (-1 + i) + Q<sub>1</sub> * (1 + i).
<li> etc.
</ul>

<p>From here, it's not too hard to guess the general formula. If the origin is rotated by 90 degrees about Q<sub>0</sub>, then Q<sub>1</sub>, and so on, all the way through Q<sub>m-1</sub>, then the final resulting point P<sub>m</sub> is given by:</p>

<blockquote>(1 - i) * (Q<sub>m-1</sub> + Q<sub>m-5</sub> + Q<sub>m-9</sub> + ...) + (-1 - i) * (Q<sub>m-2</sub> + Q<sub>m-6</sub> + Q<sub>m-10</sub> + ...) + (-1 + i) * (Q<sub>m-3</sub> + Q<sub>m-7</sub> + Q<sub>m-11</sub> + ...) + (1 + i) * (Q<sub>m-4</sub> + Q<sub>m-8</sub> + Q<sub>m-12</sub> + ...)</blockquote>

<p>And once the formula is written down, it's not too hard to check that it always works. So anyway, is this simpler than the original problem formulation? It may look pretty complicated, but for the most part, you're now just adding points together here, and addition is easier than rotation!</p>

<br/>
<p><b>Pick a Direction</b></p>

<p>
We want to choose stars Q<sub>0</sub>, Q<sub>1</sub>, ..., Q<sub>m-1</sub> in such a way as to make the following point as far away from the origin as possible:</p>

<blockquote>(1 - i) * (Q<sub>m-1</sub> + Q<sub>m-5</sub> + Q<sub>m-9</sub> + ...) + (-1 - i) * (Q<sub>m-2</sub> + Q<sub>m-6</sub> + Q<sub>m-10</sub> + ...) + (-1 + i) * (Q<sub>m-3</sub> + Q<sub>m-7</sub> + Q<sub>m-11</sub> + ...) + (1 + i) * (Q<sub>m-4</sub> + Q<sub>m-8</sub> + Q<sub>m-12</sub> + ...)</blockquote>

<p>There are different ways of thinking about things from here, but the key is always  <a href="https://www.google.com/search?q=convex+hull" target="_blank">convex hulls</a>.</p>

<p>Let X be the point furthest from the origin that we can attain, and more generally, let X<sub>v</sub> be the point that is furthest in the direction of v that we can attain. Certainly, X = X<sub>v</sub> for some v. (This is because X is surely the point that is furthest in the direction of X.) Therefore, it suffices to calculate X<sub>v</sub> for all v, and we can then measure which of these is furthest from the origin to get our final answer.</p>

<p>So how do we calculate X<sub>v</sub> for some given v? We want (1 - i) * Q<sub>m-1</sub> to be as far as possible in the v direction, or equivalently, we want Q<sub>m-1</sub> to be the star that is furthest in the (1 + i)*v direction. Of course, the same thing is true for Q<sub>m-5</sub>, Q<sub>m-9</sub>, etc. We should choose the same star for all of them. (This is the fact that we used for the small input solution!) Similarly, for Q<sub>m-2</sub>, Q<sub>m-6</sub>, etc., we want to choose the star is furthest in the (-1 + i)*v direction. In general, we want to choose stars from the original set that are as far as possible in the following directions: (1 + i)*v, (-1 + i)*v, (-1 - i)*v, (1 - i)*v.</p>

<p>We are now almost done (at least conceptually). First we find the convex hull of the stars and solve for one particular v. Now what happens when we rotate v? For a while, nothing will change, but eventually, one of the four directions we are trying to optimize will be perpendicular to an edge of the convex hull, and as a result, the optimal star will switch to the next point on the convex hull. This simulation can be done in constant time at each step, and there will be only O(N) steps since each star choice will rotate once around the convex hull.</p>

<p>At this point, we are done! We have found every X<sub>v</sub>, and we can manually check each of them to see which one is best. The implementation here is tricky, but it is an example of a general technique called <a href="https://www.google.com/search?q=rotating+calipers" target="_blank">rotating calipers</a>. You can find plenty more examples of it online. Or you can always download solutions from our finalists!</p>

<br/>
<p><b>Bonus Question!</b></p>

<p>When we generated test data for this problem, we were surprised to find that we could not come up with a case to break solutions which misread "clockwise" as "counter-clockwise" in the problem statement. In fact, there is no such case! Can you see why?
</p>

  <div class="test-data-download-wrapper">
    <div class="test-data-download-header">
      <div class="test-data-download-header-text">Test Data</div>
      <div class="test-data-download-header-download-button">
        <a href="test_data.zip" target="_blank">
          <i class="material-icons grey">save_alt</i>
        </a>
      </div>
    </div>
    <div class="test-data-download-content">
      <div class="test-data-download-warning">
        <span class="material-icons" style="color: grey; vertical-align: middle;">info</span>
        <span style="vertical-align: middle;">We recommend that you practice debugging solutions without looking at the test data.</span>
      </div>
    </div>
  </div>



    </div>
  </body>
</html>
