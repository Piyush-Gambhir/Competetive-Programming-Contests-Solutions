
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Code Jam 2017 - Round 1B</h3><h1>Analysis: Pony Express</h1><h2>Pony Express: Analysis</h2>
<h3>Small dataset</h3>
<p>
In the Small dataset, we are given a line of cities and the distances between them, and we want to
go from the first to the last city in the line. However, we need to minimize the time and not the
distance, and the obvious way to transform between the two (divide by speed) does not work
directly, because the horses we can use have different speeds. The solution, as in many
minimization algorithms on a path that only moves forward, is to use
<a href="https://en.wikipedia.org/wiki/Dynamic_programming">dynamic programming</a>.
</p><p>
Let us define f(i) as the quickest way to get from city i to the finish line, assuming we start
using the horse at city i. Of course, f(1) is the answer to the only query.
</p><p>
We do not know where we need to change horses, but we can try every possible intermediate city j
to change horses, thus completely defining f(i) by:
</p>
<ul>
  <li>f(i) = min { distance(i, j) / speed(i) + f(j) : for all j such that distance(i, j) &le;
        endurance(i) }, for i &lt; <b>N</b>.</li>
  <li>f(<b>N</b>) = 0.</li>
</ul>
<p>
This solves the problem in O(<b>N</b><sup>2</sup>) because the domain of f is of size <b>N</b>
and the iteration to calculate each value of the domain takes time O(<b>N</b>) if we memoize the
results. There are other dynamic programming approaches that also work in the same amount of time.
</p>
<h3>Large dataset</h3>
<p>
In the Large dataset, we are given a graph G of cities with distances between
them instead of just a line, but the setup of the problem is otherwise the same.
</p><p>
As mentioned above, one relatively unusual feature of this graph problem is that the desired
result (time) is not in the same units as the weights of the graph's edges (distance). Moreover,
the obvious way to transform between the two (speed) is not a constant.
This observation leads to a key insight: we should construct a new graph with weights of time
instead of distance. That way, we can apply a
<a href="https://en.wikipedia.org/wiki/Shortest_path_problem">shortest
path</a> algorithm to get the result we want.
</p><p>
We can do this by defining a graph G' that has the same nodes as G, but in which the weight
of edge (i, j) is the time that it takes to go from
city i to city j. As we said above, there is no fixed speed, but we can
fix it. The edge (i, j) then represents the time it takes to go from
city i to city j using a single horse, and the obvious choice is to
use the horse at the departure city i. Let us call that horse h.
In this way, the edge (i, j) on
G' represents a path on G, traversed using a single horse. That means the
edge (i, j) exists if and only if there is a path between i and j in G
with distance less than or equal to h's endurance. Moreover, the
weight (i, j) is a time now defined by a single speed, h's speed, and
thus it is just the distance between i and j in G, divided by h's speed.
You can see that a minimum path from a to b in G' represents a
succession of edges in G', that is, a succession of single-horse paths
in G, which is exactly what a solution looks like!
</p><p>
Since the limits are low enough, and we need all shortest paths in G
to construct G', and many shortest paths in G' to answer many queries,
the best option is to use an all-pairs shortest path algorithm.
<a href="https://en.wikipedia.org/wiki/Floyd%E2%80%93Warshall_algorithm">
Floyd-Warshall</a> is the easiest and fastest to implement, but others would work too. To also
check for existence of paths, you can use the trick of setting weights
to "infinity", that is, a distance too large for an actual shortest
path (larger than maximum distance &times; number of total edges). Thus,
an infinity distance simply means the edge or path does not exist in the
graph.
</p><p>
To summarize, this pseudocode solves the problem:
</p><ol>
<li>Apply Floyd-Warshall to input G getting distances between all pairs
  of nodes.</li>
<li>Create G' by adding all edges (i, j) such that the distance between
  i and j in G is less than or equal to the horse starting at city i's
  endurance, and set their weights to that same distance divided by that
  horse's speed.</li>
<li>Apply Floyd-Warshall to G' to get minimum times between all pairs
  of nodes.</li>
<li>Read queries and answer immediately from the output of the last
  step.</li>
</ol>
<p>
This solution takes time O(<b>N</b><sup>3</sup>). Both uses of Floyd-Warshall take time
O(<b>N</b><sup>3</sup>), and creating G' as an adjacency matrix only takes time
O(<b>N</b><sup>2</sup>).
</p>


  <div class="test-data-download-wrapper">
    <div class="test-data-download-header">
      <div class="test-data-download-header-text">Test Data</div>
      <div class="test-data-download-header-download-button">
        <a href="test_data.zip" target="_blank">
          <i class="material-icons grey">save_alt</i>
        </a>
      </div>
    </div>
    <div class="test-data-download-content">
      <div class="test-data-download-warning">
        <span class="material-icons" style="color: grey; vertical-align: middle;">info</span>
        <span style="vertical-align: middle;">We recommend that you practice debugging solutions without looking at the test data.</span>
      </div>
    </div>
  </div>



    </div>
  </body>
</html>
