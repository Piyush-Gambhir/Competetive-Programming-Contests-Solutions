
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Code Jam 2017 - Round 2</h3><h1>Beaming With Joy</h1><h3>Problem</h3>
<p>
  Joy is about to go on a long vacation, so she has hired technicians to
  install a security system based on infrared laser beams. The technicians have
  given her a diagram that represents her house as a grid of unit cells with
  <b>R</b> rows and <b>C</b> columns. Each cell in this grid contains one of
  the following:
</p>
<ul>
  <li><code>/</code>: A two-sided mirror that runs from the cell's lower left
    corner to its upper right corner.</li>
  <li><code>\</code>: A two-sided mirror that runs from the cell's upper left
    corner to its lower right corner.</li>
  <li><code>-</code>: A beam shooter that shoots horizontal beams out into the
    cells (if any) to the immediate left and right of this cell.</li>
  <li><code>|</code>: A beam shooter that shoots vertical beams out into the
    cells (if any) immediately above and below this cell.</li>
  <li><code>#</code>: A wall. (Note that the house is not necessarily
    surrounded by a border of walls; this is one reason why Joy needs a
    security system!)</li>
  <li><code>.</code>: Nothing; the cell is empty.</li>
</ul>
<p>
  Beams travel in straight lines and continue on through empty cells. When a
  beam hits a mirror, it bounces 90 degrees off the mirror's surface and
  continues. When a beam traveling to the right hits a <code>/</code> mirror,
  it bounces off the mirror and starts traveling up; beams traveling up, left,
  or down that hit a <code>/</code> mirror bounce off and travel right, down,
  or left, respectively. The <code>\</code> mirror behaves similarly: when a
  beam traveling right, up, left or down hits it, it bounces off and starts
  traveling down, left, up or right, respectively. When a beam hits a wall or
  goes out of the bounds of the grid, it stops. It is fine for beams to cross
  other beams, but if a beam hits any beam shooter (including, perhaps, the
  beam shooter that originated the beam), that beam shooter will be destroyed!
</p><p>
  Joy wants to make sure that every empty cell in the house has at least one
  beam passing through it, and that no beam shooters are destroyed, since that
  would just be wasting money! Unfortunately, the technicians have already
  installed the system, so the most Joy can do is rotate some of the existing
  beam shooters 90 degrees. That is, for any number (including zero) of beam
  shooters, she can turn <code>-</code> into <code>|</code> or vice versa.
</p><p>
  Can you find any way for Joy to achieve her goal, or determine that it is
  impossible? Note that it is <i>not</i> required to minimize the number of
  rotations of beam shooters.
</p>

<h3>Input</h3>
<p>
  The first line of the input gives the number of test cases, <b>T</b>.
  <b>T</b> test cases follow. Each case begins with one line with two integers
  <b>R</b> and <b>C</b>: the number of rows and columns in the grid
  representing the house. Then, <b>R</b> lines of <b>C</b> characters each
  follow; each character is <code>/</code>, <code>\</code>, <code>-</code>,
  <code>|</code>, <code>#</code>, or <code>.</code>, as described in the
  statement.
</p>

<h3>Output</h3>
<p>
  For each test case, output one line containing <code>Case #x: y</code>, where
  <code>x</code> is the test case number (starting from 1) and <code>y</code>
  is <code>IMPOSSIBLE</code> if Joy cannot accomplish her goal, or
  <code>POSSIBLE</code> if she can. Then, if the case is possible, output the
  same <b>R</b> lines of <b>C</b> characters each from the input grid, with
  zero or more instances of <code>-</code> replaced by <code>|</code> or vice
  versa.
</p><p>
  If there are multiple possible answers, you may output any of them.
</p>

<h3>Limits</h3>
<p>
Time limit: 20 seconds per test set.<br/>
Memory limit: 1 GB.<br/>
  1 &le; <b>T</b> &le; 100.<br/>
  1 &le; <b>C</b> &le; 50.<br/>
  Each character in the grid is one of <code>/</code>, <code>\</code>,
  <code>-</code>, <code>|</code>, <code>#</code>, or <code>.</code>.<br/>
  The number of <code>-</code> characters plus the number of <code>|</code>
  characters (that is, the number of beam shooters) in the grid is between 1
  and 100, inclusive.<br/>
  There is at least 1 <code>.</code> character (that is, empty space) in the
  grid.<br/>
</p>

<h4>Small dataset (Test Set 1 - Visible)</h4>
<p>
  1 &le; <b>R</b> &le; 5.<br/>
  There are no <code>/</code> or <code>\</code> characters (that is, no
  mirrors) in the grid.<br/>
</p>

<h4>Large dataset (Test Set 2 - Hidden)</h4>
<p>
  1 &le; <b>R</b> &le; 50.<br/>
</p>


  <h3>Sample</h3>
  <div class="problem-io-wrapper-new">
    <div class="sampleio-wrapper">
      <div class="sample-input">
        <div class="sample-header">
          <div class="sample-header-text">Sample Input</div>
          <div class="sample-header-download-button">
            <a href="beaming_with_joy_sample_ts1_input.txt" target="_blank" aria-label="Download">
              <i class="material-icons grey">save_alt</i>
            </a>
          </div>
          <div class="sample-header-copy-button" onclick="
              const copyText = document.getElementById('sample_input_0').textContent;
              const textArea = document.createElement('textarea');
              textArea.textContent = copyText;
              textArea.style.position = 'absolute';
              textArea.style.left = '-100%';
              document.body.append(textArea);
              textArea.select();
              document.execCommand('copy');
              textArea.remove();
              const copyPopup = document.getElementById('sample_input_copy_popup_0');
              copyPopup.classList.add('sample-header-copy-popup-shown');
              setTimeout(function(){ copyPopup.classList.remove('sample-header-copy-popup-shown'); }, 2000);
          " aria-label="Copy to clipboard">
            <i class="material-icons grey">content_copy</i>
            <span class="sample-header-copy-popup" id="sample_input_copy_popup_0">
              Copied!
            </span>
          </div>
        </div>
        <div class="sample-content">
          <pre class="sample-content-text" id="sample_input_0">5
1 3
-.-
3 4
#.##
#--#
####
2 2
-.
#|
4 3
.|.
-//
.-.
#\/
3 3
/|\
\\/
./#
</pre>
        </div>
      </div>
      <div class="sample-output">
        <div class="sample-header">
          <div class="sample-header-text">Sample Output</div>
          <div class="sample-header-download-button">
            <a href="beaming_with_joy_sample_ts1_output.txt" target="_blank" aria-label="Download">
              <i class="material-icons grey">save_alt</i>
            </a>
          </div>
          <div class="sample-header-copy-button" onclick="
              const copyText = document.getElementById('sample_output_0').textContent;
              const textArea = document.createElement('textarea');
              textArea.textContent = copyText;
              textArea.style.position = 'absolute';
              textArea.style.left = '-100%';
              document.body.append(textArea);
              textArea.select();
              document.execCommand('copy');
              textArea.remove();
              const copyPopup = document.getElementById('sample_output_copy_popup_0');
              copyPopup.classList.add('sample-header-copy-popup-shown');
              setTimeout(function(){ copyPopup.classList.remove('sample-header-copy-popup-shown'); }, 2000);
          " aria-label="Copy to clipboard">
            <i class="material-icons grey">content_copy</i>
            <span class="sample-header-copy-popup" id="sample_output_copy_popup_0">
              Copied!
            </span>
          </div>
        </div>
        <div class="sample-content">
          <pre class="sample-content-text" id="sample_output_0">Case #1: IMPOSSIBLE
Case #2: POSSIBLE
#.##
#||#
####
Case #3: POSSIBLE
|.
#|
Case #4: POSSIBLE
.-.
|//
.|.
#\/
Case #5: IMPOSSIBLE
</pre>
        </div>
      </div>
    </div>
  </div>


<p>
  Note that the last 2 sample cases would not appear in the Small dataset.
</p><p>
  In Sample Case #1, if a beam shooter is positioned to shoot its beam into
  the empty cell, it will necessarily destroy the other beam shooter. So the
  case is <code>IMPOSSIBLE</code>.
</p><p>
  In Sample Case #2, the leftmost beam shooter must be rotated to cover the
  empty cell. The rightmost beam shooter must also be rotated to avoid
  destroying the leftmost beam shooter.
</p><p>
  In Sample Case #3, the existing beam shooters already cover all empty cells
  with their beams and do not destroy each other, so outputting the grid from
  the input would be acceptable. However, notice that the output that we have
  given is also correct.
</p><p>
  In Sample Case #4, one acceptable solution is to rotate all three of the beam
  shooters. However, note that the following would also be acceptable:
</p>
<code>
  .-.<br/>
  |//<br/>
  .-.<br/>
  #\/<br/>
</code>
<p>
  since it is not necessary for cells with mirrors to have a beam pass through
  them. (Who would steal giant diagonal mirrors, anyway?)
</p><p>
  In Sample Case #5, the beam shooter would destroy itself no matter which
  orientation Joy chooses for it, so the case is <code>IMPOSSIBLE</code>.
</p>

    </div>
  </body>
</html>
