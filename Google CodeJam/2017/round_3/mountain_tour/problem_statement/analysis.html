
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Code Jam 2017 - Round 3</h3><h1>Analysis: Mountain Tour</h1><h2>Mountain Tour: Analysis</h2>
<h3>Small dataset</h3>
<p>
  Since each hiking tour can be taken only once, each of the hiking tours
  arriving at a camp must be followed by a different departing tour. Since each
  camp has two arriving and two departing tours, there are exactly two ways to
  &ldquo;pair&rdquo; the hiking tours at a camp: the first arrival with the
  first departure (and the second arrival with the second departure), or the
  first arrival with the second departure (and the second arrival with the
  first departure). We can think of a candidate solution as specifying this
  boolean decision for each camp. The total duration is the sum of each hiking
  trip's duration and the amount of time waiting at each camp.
</p><p>
  When evaluating a possible solution, you must check whether or not every
  hiking tour is present on the path beginning with your start hike. It is
  possible for a path through the graph to represent a cycle with fewer than
  2<b>C</b> edges. For example, the left side of the figure farther down on the
  page shows a setup with three disjoint paths through the graph.
</p><p>
  Because the time spent waiting at the base camp is calculated differently
  than the time spent waiting at all other camps, the base camp needs to be
  handled as a special case. You could simply run the algorithm four times,
  once for each &ldquo;start&rdquo; and &ldquo;end&rdquo; hike.
</p><p>
  The entire space can be explored in O(2<sup><b>C</b></sup>) time, which is
  sufficient for the Small dataset with <b>C</b>&nbsp;&le;&nbsp;15.
</p><p>
  Another way to look at the small dataset is as a special case of the
  Travelling Salesman Problem (TSP). Consider the directed graph in which each
  hiking tour is a node and edges are the possible pairings between hiking
  tours, four for each camp, with edge weights corresponding to the amount of
  time you would have to wait at the camp in order to make that transfer. For
  example, if hiking tour A arrived at node 1 at time 02:00, and hiking tour B
  left node 1 at time 06:00, there would be an edge from A to B with weight 4.
  Running TSP on this graph, again with special handling for the base camp, can
  also yield a correct solution.
</p>

<h3>Large dataset</h3>

<p>
  Let's look more closely at the two possible arrival-departure pairings for
  each camp. Suppose a camp has tours arriving at 13:00 and 21:00 and tours
  leaving at 22:00 and 07:00, such that there are no departures between the
  times that the two tours arrive. If the 13:00 arrival were paired with the
  22:00 departure and the 21:00 arrival were paired with the 07:00 departure,
  the total wait time at the camp would be (22&nbsp;&ndash;&nbsp;13)&nbsp;+
  ((7&nbsp;&ndash;&nbsp;21)&nbsp;mod&nbsp;24) =&nbsp;19&nbsp;hours. If we did
  the other pairing, the total wait time would be
  (22&nbsp;&ndash;&nbsp;21)&nbsp;+ ((7&nbsp;&ndash;&nbsp;13)&nbsp;mod&nbsp;24)
  =&nbsp;19&nbsp;hours.  Both pairings result in the same total wait time at
  the camp.  We will call these camps the &ldquo;free&rdquo; camps.
</p><p>
  Now consider a camp having tours arriving at 11:00 and 23:00 and tours
  leaving at 17:00 and 08:00, such that after each tour arrives, there is a
  tour that leaves before the other tour arrives. If the 11:00 arrival were
  paired with the 17:00 departure and the 23:00 arrival were paired with the
  08:00 departure, the total wait time at the camp would be
  (17&nbsp;&ndash;&nbsp;11)&nbsp;+ ((8&nbsp;&ndash;&nbsp;23)&nbsp;mod&nbsp;24)
  =&nbsp;15&nbsp;hours. If we did the other pairing, the total wait time would
  be ((17&nbsp;&ndash;&nbsp;23)&nbsp;mod&nbsp;24)&nbsp;+
  ((8&nbsp;&ndash;&nbsp;11)&nbsp;mod&nbsp;24) =&nbsp;39&nbsp;hours, 24 hours
  longer than the other pairing.
</p><p>
  We mentioned that for the small solution, you must ensure that every hiking
  tour is present on the path starting from the base camp. What does the graph
  look like if there are hiking tours that are not present on that path? It is
  a set of disjoint <em>cycles</em>. Each camp has two paths crossing through
  it.  If those paths are on different cycles, switching the pairing of that
  camp will in effect merge the two cycles together.
</p><p>
  For example, consider the following figure with 5 camps. Camps 2 and 5 are
  free, and camps 3 and 4 are 24-hour switches. The initial graph has 3
  disjoint cycles. As it turns out, to merge all of the cycles together, it is
  necessary to switch the pairing of camp 5 for free and either camp 3 or camp
  4 for a 24-hour penalty. Note that the red path, the one starting and ending
  at the base camp, does not pass through camp 5 prior to switching the
  pairings, but switching the pairing of camp 5 is nonetheless required.
</p><p>
  <img alt="A graph with three disjoint cycles requires switching two camp pairings. One of the switches is free, and the other costs 24 hours." src="mt3cycle1.png">
<p>
  In this initial state, wait times are minimized, but there are several disjoint cycles.
</p>
  <img alt="The same example, modified to have only one cycle." src="mt3cycle2.png">
<p>
  Now there is only one cycle.
</p><p>
  Thus, to solve the problem efficiently, add each hiking tour to a
  <a href="https://en.wikipedia.org/wiki/Disjoint-set_data_structure" target="_blank">Disjoint Sets data structure</a>.
  Iterate through each camp. If the camp is free, union all four hiking tours
  connected to that camp into the same set (this is analogous to letting the
  free camps take either pairing); otherwise, union each arrival with only its
  respective departure.  You will end up with one disjoint set per cycle in the
  graph. If there are <b>Q</b>&nbsp;&gt;&nbsp;1 disjoint sets, since all of the
  free camps have already been accounted for, you will need to switch the
  pairing of <b>Q</b>&nbsp;&ndash;&nbsp;1 camps with 24-hour penalties. These
  <b>Q</b>&nbsp;&ndash;&nbsp;1 camps are guaranteed to exist. The base camp
  still needs special handling; you can afford to run the algorithm once for
  each of the four possible start and end hikes. The total duration is the sum
  of all the hiking tour durations plus the lowest waiting time at each camp
  plus 24 hours for each of the <b>Q</b>&nbsp;&ndash;&nbsp;1 penalties. This
  solution takes O(<b>C</b>&nbsp;&alpha;(<b>C</b>)) time, where
  &alpha;(<b>C</b>), the
  <a href="https://en.wikipedia.org/wiki/Ackermann_function#Inverse" target="_blank">inverse Ackermann function</a>,
  is the amortized time per operation on the Disjoint Sets data structure.
</p>


  <div class="test-data-download-wrapper">
    <div class="test-data-download-header">
      <div class="test-data-download-header-text">Test Data</div>
      <div class="test-data-download-header-download-button">
        <a href="test_data.zip" target="_blank">
          <i class="material-icons grey">save_alt</i>
        </a>
      </div>
    </div>
    <div class="test-data-download-content">
      <div class="test-data-download-warning">
        <span class="material-icons" style="color: grey; vertical-align: middle;">info</span>
        <span style="vertical-align: middle;">We recommend that you practice debugging solutions without looking at the test data.</span>
      </div>
    </div>
  </div>



    </div>
  </body>
</html>
