
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Code Jam 2016 - Round 1C</h3><h1>Analysis: Fashion Police</h1><h2>Fashion Police: Analysis</h2>
<h3>Small dataset</h3>
<p>
Let us denote the number of possible outfits by <i>W</i>; <i>W</i> &equals;
<b>J</b> * <b>P</b> * <b>S</b>. A viable brute force approach is to produce all
2<sup><i>W</i></sup> subsets of the set of possible outfits, check them for
violations, and take one of the largest sets with no violation. We can check
a set of outfits without worrying about what order they are worn in; if some
outfits in that set create a fashion violation, it will eventually happen no
matter what order those outfits (and any other outfits) are worn in. Another
helpful observation is that if <b>S</b> &le; <b>K</b>, then the answer is
trivial: simply return every possible outfit.
</p><p>
This approach works for most of the Small cases, but not all of them. For
the cases <code>3 3 3 1</code> and <code>3 3 3 2</code>, there are
2<sup>27</sup> possible sets of outfits, and that is over 100 million. One
approach is to just solve these "problem cases" before downloading a dataset.
You can notice a pattern in the other answers (more on this later) and infer
that the maximum numbers of outfits you can wear are 9 and 18, respectively.
It is more tractable to find a set of outfits of a particular size than to
find the set of outfits of maximum size. If you are pretty sure that that size
is 18, for instance, you can check all sets of size 18 until you find a working
one, and maybe even check all sets of size 19 to confirm that none of them
work. This is much faster than checking every size between 1 and 19, especially
since 27 choose 18 is much smaller than 27 choose 13 and 27 choose 14, for
example.
</p><p>
In fact, there are only 100 possible test cases that fall within the limits of
the Small dataset, so you can compute the answer to any possible input before
even downloading the dataset!
</p>
<h3>Large dataset</h3>
<p>
Again, if <b>S</b> &le; <b>K</b>, we can return every possible outfit.
Otherwise, a key insight is that that the
<a href="https://en.wikipedia.org/wiki/Pigeonhole_principle">pigeonhole
principle</a> tells us that a maximum solution can have no more than
min(<b>J</b> &times; <b>P</b> &times; <b>K</b>, <b>P</b> &times; <b>S</b>
&times; <b>K</b>, <b>J</b> &times; <b>S</b> &times; <b>K</b>) different
outfits. Since <b>J</b> &le; <b>P</b> &le; <b>S</b>, this puts an upper bound
of <b>J</b> &times; <b>P</b> &times; <b>K</b> on our solution. You can also
infer this from the output of a brute force solution.
</p><p>
One pitfall to watch out for in this problem is that there exist sets of
outfits that are <i>maximal</i> &mdash; that is, you cannot add any new outfit
to such a set without going to jail &mdash; but are not the largest possible.
That is, they are maxim<i>al</i> but not maxim<i>um</i>.
</p><p>
For instance, for an input of <b>J</b> &equals; 1, <b>P</b> &equals; 3,
<b>S</b> &equals; 3, <b>K</b> &equals; 2, the following is a maximal set of
outfits that is not maximum (the maximum size is 6): <code>1 1 1</code>,
<code>1 1 2</code>, <code>1 2 2</code>, <code>1 2 1</code>, <code>1 3 3</code>.
</p><p>
So, if we just randomly choose outfits without violating the law, we are in
danger of being trapped in a locally maximal set.
</p><p>
Fortunately, there are several greedy approaches to achieve a set of size
<b>J</b> &times; <b>P</b> &times; <b>K</b> outfits without angering the Fashion
Police. As argued above, we know that <b>J</b> &times; <b>P</b> &times;
<b>K</b> is the maximum possible size, so if we can find a set of that size, we
are done!
</p><p>
We cannot use a jacket-pants combination more than <b>K</b> times, so if we
want to produce <b>J</b> &times; <b>P</b> &times; <b>K</b> outfits we are
forced to use each combination exactly <b>K</b> times. To simplify the math, we
use jacket, pants and shirt numbers between 0 and the appropriate total minus
1. We just need to remember to add 1 to every identifier when we print it to
the output.
</p><p>
Let us fix a combination with jacket number <i>j</i> and pants number <i>p</i>.
Our proposal is assign to it shirts (<i>j</i> + <i>p</i>) % <b>S</b>,
(<i>j</i> + <i>p</i> + 1) % <b>S</b>, ..., (<i>j</i> + <i>p</i> + <b>K</b> - 1)
% <b>S</b>, where % stands for the
<a href="https://en.wikipedia.org/wiki/Modulo_operation">modulo operation</a>.
Since <b>S</b> &gt; <b>K</b>, these are all different, and by construction, the
combination of jacket and pants is used exactly <b>K</b> times, as desired.
</p><p>
What about jacket-shirt and pants-shirt combinations? Let us fix a jacket
number <i>j</i> and a shirt number <i>s</i>. If the outfit (<i>j</i>, <i>p</i>,
<i>s</i>) appears in the constructed set, then <i>s</i> &equals; (<i>j</i> +
<i>p</i> + <i>d</i>) % <b>S</b> for some <i>d</i> between 0 and <b>K</b> - 1,
inclusive. Then, by modular arithmetic, and noticing that <i>j</i> % <b>S</b>
&equals; <i>j</i>, <i>p</i> % <b>S</b> &equals; <i>p</i>, and <i>s</i> %
<b>S</b> &equals; <i>s</i>, it turns out that <i>p</i> &equals; (<i>s</i> -
<i>j</i> - <i>d</i>) % <b>S</b>. Then, each choice of <i>d</i> uniquely
determines <i>p</i>, so there cannot be more <i>p</i>s to go with a given
combination of <i>j</i> and <i>s</i> than choices of <i>d</i>, and there are
<b>K</b> choices of <i>d</i>, which means the combination of <i>j</i> and
<i>s</i> does not exceed the maximum.
</p><p>
Since this is valid for any <i>j</i> and <i>s</i>, and a symmetrical proof is
valid for each pants-shirt combination, we have proven that the proposed set of
outfits does not break any of the rules of the Fashion Police.
</p>
<h3>Another way of thinking about it</h3>
<p>
The problem is equivalent to trying to select as many cells as possible in a
3-D <b>J</b> by <b>P</b> by <b>S</b> grid such that no line of three cells in
the x, y, or z direction includes more than <b>K</b> selected cells. Each
outfit corresponds to one such cell.
</p><p>
Here is an illustration of this approach for two cases. The left-right axis
corresponds to shirts, the up-down axis corresponds to pants, and the layers
(imagine them stacked up) correspond to jackets. Each <code>*</code> represents
a selected outfit, and each <code>.</code> represents an unused outfit.
<p>
<b>J</b> &equals; 2, <b>P</b> &equals; 3, <b>S</b> &equals; 4, <b>K</b>
&equals; 1:
</p><p>
<code>
*... .*..<br>
.*.. ..*.<br>
..*. ...*<br>
</code>
</p><p>
Outfits: <code>1 1 1</code>, <code>1 2 2</code>, <code>1 3 3</code>,
<code>2 1 2</code>, <code>2 2 3</code>, <code>2 3 4</code>.
</p><p>
<b>J</b> &equals; 2, <b>P</b> &equals; 3, <b>S</b> &equals; 4, <b>K</b>
&equals; 2:
</p><p>
<code>
**.. .**.<br>
.**. ..**<br>
..** *..*<br>
</code>
</p><p>
Outfits: <code>1 1 1</code>, <code>1 1 2</code>, <code>1 2 2</code>,
<code>1 2 3</code>, <code>1 3 3</code>, <code>1 3 1</code>, <code>2 1 2</code>,
<code>2 1 3</code>, <code>2 2 3</code>, <code>2 2 4</code>, <code>2 3 4</code>,
<code>2 3 1</code>.
</p><p>
Observe that:
</p><ul>
<li>In both cases, the second layer (jacket 2) is the first layer (jacket 1)
shifted one unit to the right (and wrapping around).</li>
<li>We can get the answer to the second case from the answer to the first case
just by adding a <code>*</code> to the right of every existing <code>*</code>
(and wrapping around).</li>
<li>By construction, the first layer does not have more than <b>K</b>
<code>*</code>s in any row or column. This is also true of each additional
layer, since they are all rotations of the first layer. Moreover, no line of
cells parallel to the jacket axis (that is, across layers) can possibly have
more than <b>K</b> <code>*</code>s; considering how the layers are constructed,
that would directly imply more than <b>K</b> <code>*</code>s in one row of the
first layer.
</ul>
<p>
This construction works for any set of <b>J</b>, <b>P</b>, and <b>S</b> values.
It takes advantage of the <b>J</b> &le; <b>P</b> &le; <b>S</b> condition in
the problem statement. We put that condition in to save you the trouble of
adding a bunch of case-based logic to try to figure out which dimension was
largest; the fashion-conscious GCJ staff is well aware that some closets have
more pants than shirts!
</p>


  <div class="test-data-download-wrapper">
    <div class="test-data-download-header">
      <div class="test-data-download-header-text">Test Data</div>
      <div class="test-data-download-header-download-button">
        <a href="test_data.zip" target="_blank">
          <i class="material-icons grey">save_alt</i>
        </a>
      </div>
    </div>
    <div class="test-data-download-content">
      <div class="test-data-download-warning">
        <span class="material-icons" style="color: grey; vertical-align: middle;">info</span>
        <span style="vertical-align: middle;">We recommend that you practice debugging solutions without looking at the test data.</span>
      </div>
    </div>
  </div>



    </div>
  </body>
</html>
