
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Code Jam 2016 - World Finals</h3><h1>Analysis: Gallery of Pillars</h1><h2>Gallery of Pillars: Analysis</h2>
<p>
A convenient way to look at this problem is to set up a coordinate system with the viewer at the
origin and the center of every pillar at other coordinates (x,y) with x and y non-negative
integers less than <b>N</b>.
</p><p>
Let us focus on a given pillar centered at (x,y). Suppose some other pillar centered at (a,b)
intersects the
segment [(0,0),(x,y)]. Then, (a,b) blocks at least half the view of (x,y), from the segment towards
one of the sides. Then, if we consider the pillar centered at (x - a, y - b), that is, the
one symmetric across the midpoint of the segment [(0,0),(x,y)], the distance from that pillar
to the segment is the same, so it also covers the segment; it's located on the other side of the
segment from (a,b), and so it blocks the other half of the view. It follows that the pillar
centered at (x,y) is visible from the origin if and only if the segment [(0,0),(x,y)] does not
intersect any other pillar. The following picture illustrates the situation.
</p>
<div style="text-align:center"><img src="editorial.png" width="400" height="400"/></div>
<p>
Assume the pillar centered at (a,b) intersects the segment [(0,0),(x,y)]. Clearly, a &le; x and
b &le; y. Moreover, the square of the
<a href="https://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line#Line_defined_by_two_points">
distance between the point and the segment</a> can be expressed as<br/>
d<sup>2</sup> = (ay - bx)<sup>2</sup> / (x<sup>2</sup> + y<sup>2</sup>).<br/>
Since the pillar intersects the segment, d<sup>2</sup> &times; 10<sup>6</sup> &le; <b>R</b>.
</p><p>
From this expression, we can tell in constant time whether a given pillar blocks the view of some
other pillar. This immediately gives an O(<b>N</b><sup>4</sup>) solution to the problem: for
each pillar, check every other pillar to see whether it blocks it. This is just shy of fast enough
for the Small, but there is a simple improvement: instead of checking every possible (a,b) for each
(x,y), it's enough, for each possible a between 0 and x - 1, to try only b = a * y / x, rounded up
and down (that is, the two points with that a coordinate that are clearly closest to the segment).
This makes the complexity O(<b>N</b><sup>3</sup>), which is definitely fast enough to solve the
Small dataset.
</p><p>
The Large dataset, as usual, requires a bit more work. Let us pick up where we left off:
our expression for the squared distance<br/>
d<sup>2</sup> = (ay - bx)<sup>2</sup> / (x<sup>2</sup> + y<sup>2</sup>).<br/>
If x and y are not relatively prime, choosing a = x / gcd(x,y) and b = y / gcd(x,y) yields a
pair (a,b) that fullfills every condition to cover (x,y). This is to be expected, as (a,b) clearly
covers all pillars (ka,kb) for each k &gt; 1. If x and y are not relatively prime, then
<a href="https://en.wikipedia.org/wiki/Diophantine_equation">there exist</a>
positive a and b such that |ay - bx| = 1. Since |ay - bx| is an integer, and it can only be 0 within
our constraints when x and y are not relatively prime, choosing a pair that makes it 1 yields the
closest distance. Thus, a pillar (x,y) is visible if and only if x and y are relatively prime and
10<sup>6</sup> / (x<sup>2</sup> + y<sup>2</sup>) &lt; <b>R</b>. That is, we need to count the pairs
of relatively prime integers within a circle of radius 10<sup>6</sup> / <b>R</b> and a square of
size <b>N</b> by <b>N</b>.
</p><p>
If <b>N</b> &ge; 10<sup>6</sup> / <b>R</b>, then the square contains the circle, so let us assume
further that <b>N</b> &le; 10<sup>6</sup> / <b>R</b> &le; 10<sup>6</sup>. We can count all points
inside the area, then subtract the multiples of 2, 3, 5, ..., etc, then add the multiples of
2 &times; 3 = 6, 2 &times; 5 = 10, 3 &times; 5 = 15, etc, that were subtracted twice,
and keep doing the <a href="https://en.wikipedia.org/wiki/Inclusion%E2%80%93exclusion_principle">
inclusion-exclusion argument</a> for each possible divisor k
between 1 and <b>N</b>. The count for points that are multiples of a given k should be multiplied by
the <a href="https://en.wikipedia.org/wiki/M%C3%B6bius_function">M&ouml;bius function</a> of k.
Calculating that function for each number between 1 and <b>N</b> can be done efficiently with
a slight modification of the <a href="https://en.wikipedia.org/wiki/Sieve_of_Eratosthenes">sieve of
Eratosthenes</a>, which runs in linear time. For each k, we count by iterating the possible values
of x, k, 2k, 3k, etc, and for each one we find the range of possible y values. We can do that by
taking the minimum of <b>N</b> and the square root of
(10<sup>6</sup> / <b>R</b>)<sup>2</sup> - x<sup>2</sup>, or by binary search, or by linear
search. Notice that the maximum value of y decreases from one value of x to the next, so if we
pick up at the value considered for the previous x, the linear search will only take linear time
overall (constant amortized time per each value of x). Linear and binary search are guaranteed to
give a precise number, but using the square root also works because we are dealing with fairly
small values.
For the most efficient versions, the time complexity of the algorithm to get the count for a given
value of k is O(<b>N</b> / k). Since the summation of 1 / k up to k = <b>N</b> can be approximated
by log <b>N</b>, the overall complexity of the algorithm is O(<b>N</b> log <b>N</b>). Using binary
search to find the range of values for y only adds a second log factor, yielding an overall
O(<b>N</b> log<sup>2</sup> <b>N</b>). Both are efficient enough for <b>N</b> up to 10<sup>6</sup>.
</p>


  <div class="test-data-download-wrapper">
    <div class="test-data-download-header">
      <div class="test-data-download-header-text">Test Data</div>
      <div class="test-data-download-header-download-button">
        <a href="test_data.zip" target="_blank">
          <i class="material-icons grey">save_alt</i>
        </a>
      </div>
    </div>
    <div class="test-data-download-content">
      <div class="test-data-download-warning">
        <span class="material-icons" style="color: grey; vertical-align: middle;">info</span>
        <span style="vertical-align: middle;">We recommend that you practice debugging solutions without looking at the test data.</span>
      </div>
    </div>
  </div>



    </div>
  </body>
</html>
