
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Code Jam 2018 - Round 1B</h3><h1>Mysterious Road Signs</h1><h3>Problem</h3>
<p>
  The town of Signfield is on a perfectly straight and infinitely long road
  running from west to east. Along that road, there is a sequence of <b>S</b>
  mysterious road signs with numbers on both sides. The i-th sign (numbered in
  order from west to east) is at a point <b>D<sub>i</sub></b> kilometers east
  of Signfield, and has a number <b>A<sub>i</sub></b> on the west-facing side
  and a number <b>B<sub>i</sub></b> on the east-facing side.
</p><p>
  Nobody in Signfield knows what these signs are trying to say. You think
  that the numbers on the west sides of the signs are intended for drivers
  traveling east, and that they represent distances to some particular
  destination. Similarly, you think that the numbers on the east sides of the
  signs are for drivers traveling west, and that they represent distances to
  some particular destination. You suspect that not all of the signs may be
  consistent with this theory, though.
</p><p>
  To start testing your theory, you are interested in finding valid sets of
  signs that obey the following rules:
</p>
<ul>
  <li>The set is a contiguous subsequence of the sequence of all road
    signs. (The entire sequence also counts as a contiguous subsequence.)</li>
  <li>There exist locations M and N kilometers east of Signfield, where M and N
    are (not necessarily positive and not necessarily distinct) numbers, such
    that for every sign in that set, at least one of the following is true:
    <ul>
      <li><b>D<sub>i</sub></b> + <b>A<sub>i</sub></b> = M.</li>
      <li><b>D<sub>i</sub></b> - <b>B<sub>i</sub></b> = N.</li>
    </ul>
  </li>
</ul>
<p>
  What is the largest possible number of signs in a valid set as described
  above, and how many different valid sets of that size are there?
</p>

<h3>Input</h3>
<p>
  The first line of the input gives the number of test cases, <b>T</b>.
  <b>T</b> test cases follow. Each begins with one line containing one integer
  <b>S</b>: the number of road signs. Then, <b>S</b> more lines follow. The
  i-th of these lines represents the i-th sign (in west-to-east order), and
  contains three integers <b>D<sub>i</sub></b>, <b>A<sub>i</sub></b>, and
  <b>B<sub>i</sub></b>: the sign's distance (in kilometers) east of Signfield,
  the number on its west side, and the number on its east side.
</p>

<h3>Output</h3>
<p>
  For each test case, output one line containing <code>Case #x: y z</code>,
  where <code>x</code> is the test case number (starting from 1), and
  <code>y</code> and <code>z</code> are the largest possible number of signs
  in a valid set and the number of valid sets of that size, as described in
  the problem statement.
</p>

<h3>Limits</h3>
<p>
  1 &le; <b>T</b> &le; 60.<br/>
  1 &le; <b>D<sub>i</sub></b> &le; 10<sup>6</sup>, for all i.<br/>
  <b>D<sub>i</sub></b> &lt; <b>D<sub>j</sub></b>, for all i &lt; j.<br/>
  1 &le; <b>A<sub>i</sub></b> &le; 10<sup>6</sup>, for all i.<br/>
  1 &le; <b>B<sub>i</sub></b> &le; 10<sup>6</sup>, for all i.<br/>
  Time limit (for each test set): 10 seconds.<br/>
  Memory limit: 1GB.<br/>
</p>

<h4>Test set 1 (Visible)</h4>
<p>
  1 &le; <b>S</b> &le; 100 for all test cases.<br/>
</p>

<h4>Test set 2 (Hidden)</h4>
<p>
  1 &le; <b>S</b> &le; 100 for all but 3 test cases.<br/>
  <b>S</b> = 10<sup>5</sup> for 3 test cases.<br/>
</p>


  <h3>Sample</h3>
  <div class="problem-io-wrapper-new">
    <div class="sampleio-wrapper">
      <div class="sample-input">
        <div class="sample-header">
          <div class="sample-header-text">Sample Input</div>
          <div class="sample-header-download-button">
            <a href="mysterious_road_signs_sample_ts1_input.txt" target="_blank" aria-label="Download">
              <i class="material-icons grey">save_alt</i>
            </a>
          </div>
          <div class="sample-header-copy-button" onclick="
              const copyText = document.getElementById('sample_input_0').textContent;
              const textArea = document.createElement('textarea');
              textArea.textContent = copyText;
              textArea.style.position = 'absolute';
              textArea.style.left = '-100%';
              document.body.append(textArea);
              textArea.select();
              document.execCommand('copy');
              textArea.remove();
              const copyPopup = document.getElementById('sample_input_copy_popup_0');
              copyPopup.classList.add('sample-header-copy-popup-shown');
              setTimeout(function(){ copyPopup.classList.remove('sample-header-copy-popup-shown'); }, 2000);
          " aria-label="Copy to clipboard">
            <i class="material-icons grey">content_copy</i>
            <span class="sample-header-copy-popup" id="sample_input_copy_popup_0">
              Copied!
            </span>
          </div>
        </div>
        <div class="sample-content">
          <pre class="sample-content-text" id="sample_input_0">3
1
1 1 1
5
2 7 12
6 3 11
8 10 1
11 11 12
13 9 14
5
1 3 3
2 2 2
3 1 1
4 2 2
5 3 3
</pre>
        </div>
      </div>
      <div class="sample-output">
        <div class="sample-header">
          <div class="sample-header-text">Sample Output</div>
          <div class="sample-header-download-button">
            <a href="mysterious_road_signs_sample_ts1_output.txt" target="_blank" aria-label="Download">
              <i class="material-icons grey">save_alt</i>
            </a>
          </div>
          <div class="sample-header-copy-button" onclick="
              const copyText = document.getElementById('sample_output_0').textContent;
              const textArea = document.createElement('textarea');
              textArea.textContent = copyText;
              textArea.style.position = 'absolute';
              textArea.style.left = '-100%';
              document.body.append(textArea);
              textArea.select();
              document.execCommand('copy');
              textArea.remove();
              const copyPopup = document.getElementById('sample_output_copy_popup_0');
              copyPopup.classList.add('sample-header-copy-popup-shown');
              setTimeout(function(){ copyPopup.classList.remove('sample-header-copy-popup-shown'); }, 2000);
          " aria-label="Copy to clipboard">
            <i class="material-icons grey">content_copy</i>
            <span class="sample-header-copy-popup" id="sample_output_copy_popup_0">
              Copied!
            </span>
          </div>
        </div>
        <div class="sample-content">
          <pre class="sample-content-text" id="sample_output_0">Case #1: 1 1
Case #2: 3 2
Case #3: 5 1
</pre>
        </div>
      </div>
    </div>
  </div>


<p>
  In Sample Case #1, there is only one sign. If we choose just that sign as our
  set, there are many possible values of M and N that work &mdash; for example:
</p>
<ul>
  <li>M = 2 and N = 0</li>
  <li>M = 1 and N = 0 (remember that each sign only needs to be correct for
    one of its values; also, M and N might be in the same place as one or more
    signs, or Signfield itself)</li>
  <li>M = 2 and N = -12345 (N might be west of Signfield)</li>
  <li>M = 0 and N = 0 (M and N are not necessarily distinct)</li>
  <li>M = 2 and N = 3 (N might be east of M)</li>
</ul>
<p>
  So, the set consisting of just that one sign is valid. That is the only set
  of that length, so the answer is <code>1 1</code>.
</p><p>
  In Sample Case #2, note that the first, second, fourth, and fifth signs would
  be consistent with M = 9 and N = -1, but they do not form a contiguous
  subsequence. (The 1 on the back of the third sign cannot be used as if it
  were on the front.) As it turns out, there is no valid set of four signs.
  There are two different valid sets of three signs. Note that although there
  are two different M/N pairs that make the second set of three signs valid,
  that set counts only once:
</p>
<ul>
  <li>the first, second, and third signs, with M = 9 and N = 7</li>
  <li>the third, fourth, and fifth signs, with M = 18 and N = -1 or with M = 22 and N = 7</li>
</ul>
<p>
  In Sample Case #3, the entire sequence is a valid set, with M = 4 and N = 2.
</p>

    </div>
  </body>
</html>
