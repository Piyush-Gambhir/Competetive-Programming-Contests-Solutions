
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Code Jam 2018 - Practice Session</h3><h1>Analysis: Bathroom Stalls</h1><h3>Test set 1</h3>

<p>
  For test set 1, the limits are small enough that you can just simulate
  the rules outlined in the statement. Most implementations of a simulation
  will run in O(<b>N</b><b>K</b>) time and thus finish immediately, but even a
  slow O(<b>N</b><sup>2</sup><b>K</b>) implementation like "try every possible
  stall for the next person, and for each empty stall run a loop for each side
  to check for the closest neighbors" will most likely finish in time.
</p><p>
  For test sets 2 and 3, however, something quadratic in the number of stalls
  won't cut it, so we have to do better.
</p>

<h3>Test set 2</h3>

<p>
  The critical observation to jump from test set 1 to test set 2 is
  that only the number of consecutive runs of empty stalls matters at any given
  time. The next person always chooses the middle stall or the left of the two
  middle stalls of a longest subsequence of consecutive empty stalls. Moreover,
  the output format already hints at this: even if you were to choose the
  rightmost of a set of two middle stalls, or a longest run of stalls other
  than the leftmost one, the answer would not change. Thus, we can rewrite the
  algorithm in this equivalent (for the required output) form:
</p><ol>
  <li>Find any longest subsequence of consecutive empty stalls.</li>
  <li>Choose the middle or one of the two middle stalls.</li>
</ol><p>
  Notice that even though there are still ties to be broken, the output is
  equivalent for all of them. Since the output is equivalent, so is the
  multiset of lengths of consecutive runs of empty stalls left behind, so the
  whole process only depends on that multiset. (As a reminder, a multiset is a
  set in which the same element can appear more than once.) We can write an
  optimized simulation that solves test set 2 following this pseudocode:
</p><pre>
  S = {<b>N</b>}  - This is a multiset!
  repeat <b>K</b> times:
    X = max(S)
    X0 = ceil((X - 1) / 2)
    X1 = floor((X - 1) / 2)
    if this is the last step:
      we are done; answer is X0 and X1
    else:
      remove one instance of X from S
      insert X0 and X1 into S
</pre><p>
  If the operations over <code>S</code> are efficient, this will run in
  quasilinear time. There are many data structures that support insertion,
  finding the maximum, and removal of the maximum in logarithmic time,
  including AVL trees, red-black trees, and heaps. Many languages have one such
  structure in their standard libraries (e.g., the <code>multiset</code> or
  <code>priority_queue</code> in C++, <code>TreeSet</code> in Java, and
  <code>heapq</code> module in Python). Since we take O(log <b>K</b>) time for
  each of K steps, the algorithm takes only O(<b>K</b> log <b>K</b>) time,
  which is fast enough to solve test set 2. However, for test set 3, even
  quasilinear time on K is not enough.
</p>

<h3>Test set 3</h3>

<p>
  The observation required to solve test set 3 is that we are simulating
  similar steps over and over again. The first time a bathroom user arrives, we
  partition <b>N</b> into ceil((<b>N</b> - 1) / 2) and
  floor((<b>N</b> - 1) / 2), which means that numbers between
  ceil((<b>N</b> - 1) / 2) and <b>N</b> will never appear in S. This hints at a
  logarithmic number of simulation steps.
</p><p>
  Let's divide the work in stages. The first stage processes only <b>N</b>.
  Then, stage <i>i</i>+1 processes all of the values spawned by stage <i>i</i>.
  So, stage 2 processes up to 2 values: ceil((<i>i</i> - 1) / 2) and
  floor((<i>i</i> - 1) / 2). What about the other stages? It is not hard to
  prove by induction that they also process at most two consecutive values:
  since stage i processes two consecutive values, they are either 2x and 2x+1 or
  2x and 2x-1, for some x (that is, one even and one odd number). Thus, the spawned
  values for stage i+1 can only be x and/or x-1.
  Since the largest value in each stage is at most half the largest
  value of the previous stage, there are a logarithmic number of stages. This all
  means that there are at most O(log <b>N</b>) different values
  that go into S at any point. Of course, some of them appear in S many, many
  times. So, the optimization to get the running time low enough for test
  set 3 is to process all repetitions of a given value at the same time,
  since all of them yield the same X0 and X1 values. We can do that by using a
  regular set with a separate count for the number of repetitions.
</p><pre>
  S = {<b>N</b>}  - This is a set, not a multiset!
  C(N) = 1
  P = 0
  repeat:
    X = max(S)
    X0 = ceil((X - 1) / 2)
    X1 = floor((X - 1) / 2)
    P = P + C(X)
    if P &ge; <b>K</b>:
      we are done; the answer is X0 and X1.
    else:
      remove X from S
      insert X0 and X1 into S
      add C(X) to the counts of X0 and X1 in C
</pre><p>
  Once again, we have structures that implement all the required operations in
  logarithmic time, yielding an O(log<sup>2</sup> <b>N</b>) running time
  overall. In general, adding any good dictionary implementation to the
  structure of choice from the test set 2 solution would work, either by
  plugging the dictionary functionality into the structure (like
  <code>map</code> in C++ or <code>TreeMap</code> in Java) or having a separate
  hash-table for the dictionary (which is the easiest implementation in Python).
</p><p>
  Moreover, since we proved the population of S is at most 4 at any given time
  (only values from two consecutive stages can coexist in S), any implementation
  of set and dictionary will provide all operations in constant time, because the
  size of the whole structure is bounded by a constant! This makes the overall
  time complexity just O(log <b>N</b>).
</p><p>
  This was a nice problem to put experimentation to work if your intuition was not
  enough. After solving test set 1, if you print the succession of values for a
  fixed <b>N</b>, you may spot the pattern of few values occurring
  in the set S, and from there, you can find the mathematical arguments to support
  the needed generalization. In harder problems in later rounds, this can become an
  even more important asset to tackle problems. As you can see in many parts of last
  year's finals <a href="https://www.youtube.com/watch?v=4diQ6JXY4cI">live stream</a>,
  finalists use experimentation a lot to inspire themselves and/or validate their ideas
  before committing to them.
</p>


  <div class="test-data-download-wrapper">
    <div class="test-data-download-header">
      <div class="test-data-download-header-text">Test Data</div>
      <div class="test-data-download-header-download-button">
        <a href="test_data.zip" target="_blank">
          <i class="material-icons grey">save_alt</i>
        </a>
      </div>
    </div>
    <div class="test-data-download-content">
      <div class="test-data-download-warning">
        <span class="material-icons" style="color: grey; vertical-align: middle;">info</span>
        <span style="vertical-align: middle;">We recommend that you practice debugging solutions without looking at the test data.</span>
      </div>
    </div>
  </div>



    </div>
  </body>
</html>
