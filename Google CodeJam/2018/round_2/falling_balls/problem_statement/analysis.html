
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Code Jam 2018 - Round 2</h3><h1>Analysis: Falling Balls</h1><h3>Test set 1</h3>
<p>
  We can narrow down the scope of Test set 1 with only a couple of insights:
</p>
<ul>
  <li>We cannot put any ramps in the leftmost and rightmost columns, so the
    balls dropped into those columns must fall straight down to the bottom. So,
    if either of those columns has no balls, the case is
    <code>IMPOSSIBLE</code>. (Later on in this analysis, it will become clear
    that this is the only way for a case to be impossible!)</li>
  <li>Suppose <b>C</b> has its maximum value of 5. Since we know the leftmost
    and rightmost columns must have at least one ball each, the only variation
    among cases comes from where the other 3 balls end up. It turns out that
    there are only 35 ways to partition 3 balls among 5 columns, and some of
    these cases are mirror reflections of each other, so there are really only
    19 distinct cases to consider. When <b>C</b> is smaller than 5, there are
    even fewer cases.</li>
</ul>
<p>
  So, we can experiment offline, generating potential ramp arrangements via
  simulation or by hand, until we are confident in our solutions for all cases,
  and then submit; since Test set 1 is Visible, we have little to lose.
  However, we can avoid this extra work, as follows...
</p>
<h3>Test set 2</h3>
<p>
  Consider the paths that each ball might take through the toy, and notice
  that whenever two balls' paths intersect, those balls must end up in the
  same final column. (Because we can never have a <code>\</code> ramp
  immediately to the left of a <code>/</code> ramp, paths cannot cross over
  each other.)
</p><p>
  So, for example, if your friend says there are exactly K balls in the
  leftmost column, they must have been the balls that were originally dropped
  into the K leftmost columns. Suppose that one of those balls had instead come
  from, e.g., the (K+1)-th column; then the path taken by that ball would have
  crossed all of the paths taken by the balls in the K leftmost columns, so all
  K+1 of the balls would have ended up in the leftmost column, which is a
  contradiction.
</p><p>
  With those observations in mind, let us think of the i-th column as both a
  <i>source</i> of one ball and a potential <i>target</i> of
  <b>B<sub>i</sub></b> balls (if <b>B<sub>i</sub></b> &gt; 0). We can scan our
  friend's list from left to right, and when we encounter a positive
  <b>B<sub>i</sub></b> value, we allocate the <b>B<sub>i</sub></b> leftmost
  source columns that we have not used so far to target column i. So, for
  example, if we have the data <code>3 2 0 0 0 0 2 1</code>, we map the source
  column range [1, 3] to target column 1, the source column range [4, 5] to
  target column 2, the source column range [6, 7] to target column 7, and the
  source column range [8, 8] to target column 8.
</p><p>
  Once we have this mapping, we can move on to designing the toy to ensure
  that every source column's ball will end up at the bottom of the appropriate
  target column. We will start with an empty top row, and add ramps and more
  rows as needed.
</p><p>
  For each source column range, we check whether the left endpoint is to the
  left of the target. If it is not, we do nothing. Suppose, on the other hand,
  that it is L columns to the left of the target. Then we add L <code>\</code>
  ramps, starting in the top row and the left endpoint's column, and proceeding
  diagonally, moving one cell to the right and one cell down each time. Notice
  that this line of ramps will catch all balls in that source column range that
  need to move to the right, so we do not need to explicitly worry about those
  balls. Then, we draw similar diagonal lines of <code>/</code> ramps running
  down and to the left from our right endpoints. Finally, if our bottom row is
  not empty, we add an empty bottom row, as the rules require.
</p><p>
  Can we convince ourselves that this construction is optimal? We have already
  shown that the mapping of source columns to target columns is forced.
  Consider the largest absolute difference, in columns, between a target column
  and one of the endpoints of the range of source columns mapped to it. (In our
  example above, this value is |5 - 2| = 3.) The toy must have at least this
  many rows (in addition to the empty bottom row), because a ball can only
  interact with one ramp per row, and each ramp only moves a ball one cell in
  the desired direction. Observe that our construction uses exactly this many
  rows, plus the required empty bottom row. For our example, our method
  produces:
</p>
<p><code>
    .././\..<br/>
    ././....<br/>
    ../.....<br/>
    ........<br/>
</code></p>
<p>
  Notice that there is no danger of creating a <code>\/</code> pattern within a
  range, since no target position could cause that.
</p>


  <div class="test-data-download-wrapper">
    <div class="test-data-download-header">
      <div class="test-data-download-header-text">Test Data</div>
      <div class="test-data-download-header-download-button">
        <a href="test_data.zip" target="_blank">
          <i class="material-icons grey">save_alt</i>
        </a>
      </div>
    </div>
    <div class="test-data-download-content">
      <div class="test-data-download-warning">
        <span class="material-icons" style="color: grey; vertical-align: middle;">info</span>
        <span style="vertical-align: middle;">We recommend that you practice debugging solutions without looking at the test data.</span>
      </div>
    </div>
  </div>



    </div>
  </body>
</html>
