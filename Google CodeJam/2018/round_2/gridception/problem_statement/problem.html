
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Code Jam 2018 - Round 2</h3><h1>Gridception</h1><h3>Problem</h3>
<p>
  The master thief Jom Codd is able to infiltrate the dreams of others. Since
  dream-viewing technology is not very good yet, Codd sees a dream as a
  <i>dream grid</i> of unit cells, each of which is white or black.
</p><p>
  Given a starting dream grid, Codd can <i>go deeper</i> by replacing each
  white cell with a 2x2 grid of white cells, and each black cell with a 2x2
  grid of black cells; this creates a new dream grid that is four times
  larger. He can go deeper again from that grid, and so on. For example, given
  this starting dream grid:
</p>
<p><code>
    BBB<br>
    BWB<br>
    BBB<br>
</code></p>
<p>
  then going deeper once produces this new dream grid:
</p>
<p><code>
    BBBBBB<br>
    BBBBBB<br>
    BBWWBB<br>
    BBWWBB<br>
    BBBBBB<br>
    BBBBBB<br>
</code></p>
<p>
  and going deeper again produces this new dream grid:
</p>
<p><code>
    BBBBBBBBBBBB<br>
    BBBBBBBBBBBB<br>
    BBBBBBBBBBBB<br>
    BBBBBBBBBBBB<br>
    BBBBWWWWBBBB<br>
    BBBBWWWWBBBB<br>
    BBBBWWWWBBBB<br>
    BBBBWWWWBBBB<br>
    BBBBBBBBBBBB<br>
    BBBBBBBBBBBB<br>
    BBBBBBBBBBBB<br>
    BBBBBBBBBBBB<br>
</code></p>
<p>
  and so on.
</p><p>
  Codd has just infiltrated a dream and viewed its starting dream grid. He is
  on a very difficult mission, and he knows that he will need to go deeper many
  times. To help him navigate, he is looking at various <i>patterns</i> in the
  starting dream grid. A pattern consists of a single group of cells connected
  by shared edges (shared corners do not count as connections), plus their
  colors. A pattern might contain internal gaps (as long as the pattern's cells
  are a single connected group); such gaps are not considered part of the
  pattern. Two patterns are the same if and only if they have the same number
  and arrangement of cells (not reflected or rotated), with the same colors.
<p>
  For example, in the grids above, the following 8-cell pattern is present in
  the starting grid:
</p>
<p><code>
  BBB<br>
  B B<br>
  BBB<br>
</code></p>
<p>
  It is not present after going deeper once, but it is present after going
  deeper twice, and three times, and so on for every deeper dream grid.
</p><p>
  Codd wants to find the largest pattern from the starting dream grid that will
  be present in at least a googol (10<sup>100</sup>) of deeper dream grids.
  For the given example, the pattern above is the largest such pattern. Even
  though it is not present after going deeper once, it is present in at least
  a googol of deeper levels. Other such patterns of smaller sizes also meet
  this condition, but there is no 9-cell pattern that does; the only such
  pattern would have to be identical to the entire starting dream grid, and
  that pattern will never show up in any deeper dream grid, let alone in a
  googol of them.
</p>

<h3>Input</h3>
<p>
  The first line of the input gives the number of test cases, <b>T</b>.
  <b>T</b> test cases follow. Each begins with one line with two integers
  <b>R</b> and <b>C</b>: the numbers of rows and columns, respectively, in the
  dream grid. Each case continues with <b>R</b> more lines of <b>C</b>
  characters each; every such character is either <code>B</code> or
  <code>W</code>. These lines directly represent the dream grid.
</p>

<h3>Output</h3>
<p>
  For each test case, output one line containing <code>Case #x: y</code>, where
  <code>x</code> is the test case number (starting from 1) and <code>y</code>
  is the largest possible size of at least one pattern that meets Codd's
  requirements, as described above.
</p>

<h3>Limits</h3>
<p>
  1 &le; <b>T</b> &le; 100.<br/>
  Time limit: 30 seconds per test set.<br/>
  Memory limit: 1GB.<br/>
</p>

<h4>Test set 1 (Visible)</h4>
<p>
  1 &le; <b>R</b> &le; 3.<br/>
  1 &le; <b>C</b> &le; 4.<br/>
</p>

<h4>Test set 2 (Hidden)</h4>
<p>
  1 &le; <b>R</b> &le; 20.<br/>
  1 &le; <b>C</b> &le; 20.<br/>
</p>


  <h3>Sample</h3>
  <div class="problem-io-wrapper-new">
    <div class="sampleio-wrapper">
      <div class="sample-input">
        <div class="sample-header">
          <div class="sample-header-text">Sample Input</div>
          <div class="sample-header-download-button">
            <a href="gridception_sample_ts1_input.txt" target="_blank" aria-label="Download">
              <i class="material-icons grey">save_alt</i>
            </a>
          </div>
          <div class="sample-header-copy-button" onclick="
              const copyText = document.getElementById('sample_input_0').textContent;
              const textArea = document.createElement('textarea');
              textArea.textContent = copyText;
              textArea.style.position = 'absolute';
              textArea.style.left = '-100%';
              document.body.append(textArea);
              textArea.select();
              document.execCommand('copy');
              textArea.remove();
              const copyPopup = document.getElementById('sample_input_copy_popup_0');
              copyPopup.classList.add('sample-header-copy-popup-shown');
              setTimeout(function(){ copyPopup.classList.remove('sample-header-copy-popup-shown'); }, 2000);
          " aria-label="Copy to clipboard">
            <i class="material-icons grey">content_copy</i>
            <span class="sample-header-copy-popup" id="sample_input_copy_popup_0">
              Copied!
            </span>
          </div>
        </div>
        <div class="sample-content">
          <pre class="sample-content-text" id="sample_input_0">5
3 3
BBB
BWB
BBB
2 3
BBB
WBW
1 1
W
3 3
WBW
BWB
WBW
2 4
BBWW
BBWW
</pre>
        </div>
      </div>
      <div class="sample-output">
        <div class="sample-header">
          <div class="sample-header-text">Sample Output</div>
          <div class="sample-header-download-button">
            <a href="gridception_sample_ts1_output.txt" target="_blank" aria-label="Download">
              <i class="material-icons grey">save_alt</i>
            </a>
          </div>
          <div class="sample-header-copy-button" onclick="
              const copyText = document.getElementById('sample_output_0').textContent;
              const textArea = document.createElement('textarea');
              textArea.textContent = copyText;
              textArea.style.position = 'absolute';
              textArea.style.left = '-100%';
              document.body.append(textArea);
              textArea.select();
              document.execCommand('copy');
              textArea.remove();
              const copyPopup = document.getElementById('sample_output_copy_popup_0');
              copyPopup.classList.add('sample-header-copy-popup-shown');
              setTimeout(function(){ copyPopup.classList.remove('sample-header-copy-popup-shown'); }, 2000);
          " aria-label="Copy to clipboard">
            <i class="material-icons grey">content_copy</i>
            <span class="sample-header-copy-popup" id="sample_output_copy_popup_0">
              Copied!
            </span>
          </div>
        </div>
        <div class="sample-content">
          <pre class="sample-content-text" id="sample_output_0">Case #1: 8
Case #2: 5
Case #3: 1
Case #4: 4
Case #5: 8
</pre>
        </div>
      </div>
    </div>
  </div>


<p>
  Sample Case #1 is the one described in the problem statement.
</p><p>
  In Sample Case #2, one possible largest pattern is:
</p>
<p><code>
  BBB<br>
  WB<br>
</code></p>
<p>Another equally large one is:</p>
<p><code>
  BBB<br>
  W W<br>
</code></p>
<p>
  In Sample Case #3, the entire starting dream grid is a largest pattern.
</p><p>
  In Sample Case #4, note that the five <code>W</code>s would not form a valid
  pattern, because they are not connected. However, this is a largest pattern:
</p>
<p><code>
  WB<br>
  BW<br>
</code></p>
<p>
  In Sample Case #5, the entire starting dream grid is a largest pattern.
  Note that even though this grid happens to be what Codd would get by going
  deeper starting from <code>BW</code>, that is irrelevant; Codd will never "go
  shallower".
</p>

    </div>
  </body>
</html>
