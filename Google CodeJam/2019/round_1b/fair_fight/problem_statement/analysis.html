
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Code Jam 2019 - Round 1B</h3><h1>Analysis: Fair Fight</h1><h3>Test set 1</h3>
<p>
  Let us call a pair (L, R) <i>fair</i> if choosing it produces a fair fight. Notice that
  since there are only 100 entries, there are at most 100*101/2 = 5050 possible intervals.
  For each interval, we may simply search for the maximum value is in each array via a
  linear search and check if those maximum values are close enough.
</p>
<h3>Test set 2</h3>
<p>
  Notice the random choice of sword in case of ties does not change whether (L, R)
  is fair or not, so we can further assume that, if there are ties, they are broken by choosing
  the sword with smallest index. To simplify the write-up below, we assume that each
  <b>C</b><sub>i</sub> is distinct.
</p><p>
  Let us consider a sub-problem: for each sword i that Charles can choose, how many fair
  intervals (L,R) are there which Charles chooses sword i? Let us call this value F<sub>i</sub>.
  The answer to the original problem is simply the sum of the F<sub>i</sub>s. For each interval
  (L,R), there are three properties we are concerned with:
</p><ul>
  <li>(P1) Charles chooses sword i. That is, L &le; i &le; R and
    max(<b>C</b><sub>L</sub>,<b>C</b><sub>L+1</sub>,...,<b>C</b><sub>R</sub>) = <b>C</b><sub>i</sub>.
  </li>
  <li>(P2) Charles' sword is <i>good enough</i>. That is,
    max(<b>D</b><sub>L</sub>,<b>D</b><sub>L+1</sub>,...,<b>D</b><sub>R</sub>) &le; <b>C</b><sub>i</sub> + <b>K</b>.
  </li>
  <li>(P3) Charles' sword is <i>too good</i>. That is,
    max(<b>D</b><sub>L</sub>,<b>D</b><sub>L+1</sub>,...,<b>D</b><sub>R</sub>) &lt; <b>C</b><sub>i</sub> - <b>K</b>.</li>
</ul><p>
  So we have F<sub>i</sub> = (# of intervals that satisfy P1 and P2) - (# of intervals that satisfy
  P1 and P3). These two quantities are computed very similarly since they just have a different
  bound on the right-hand side of the inequality in P2 and P3. We explain below just how to compute
  (# of intervals that satisfy P1 and P2) and leave computing (# of intervals that satisfy P1 and P3)
  to the reader.
</p><p>
  Note that if an interval (L,R) satisfies P2, then any subinterval of (L,R) also satisfies P2.
  Similarly, if (L,R) satisfies P1, then any subinterval of (L,R) that still contains i
  also satisfies P1. Thus, we are really only interested in how far left L can go with R=i (and
  how far right R can go with L=i). One option is to do a linear search for how far left L can go,
  but this is too slow. Instead, we
  <a href="https://en.wikipedia.org/wiki/Binary_search_algorithm">binary search</a>
  for how far away the left-endpoint is. A
  left-endpoint is too far left if P1 or P2 are no longer true. Otherwise, the left endpoint
  can be pushed further left. Once we know the furthest left L can go (let this index be L<sub>i</sub>)
  and the furthest right R can go (let this index be R<sub>i</sub>), then
  (# of intervals that satisfy P1 and P2) = (i - L<sub>i</sub> + 1) &times; (R<sub>i</sub> - i + 1).
  Calculating the maximum element in a range can be computed efficiently using a
  <a href="https://en.wikipedia.org/wiki/Range_minimum_query">range minimum (maximum) query</a>-type
  data structure in O(1) time per query, meaning O(log <b>N</b>) total time for the binary search.
</p><p>
  In terms of time complexity, for each i, we need to perform 4 binary searches, which take
  O(log <b>N</b>) time each, for an overall O(<b>N</b> log <b>N</b>) total time.
  Setting up the range maximum query data structure takes an additional
  O(<b>N</b> log <b>N</b>) time, yielding an overall O(<b>N</b> log <b>N</b>) time for
  the full algorithm. There are solutions that can compute all of
  the required L<sub>i</sub> and R<sub>i</sub> values (defined above) in O(<b>N</b>) total time
  by doing a couple of clever sweeps of the data to count the number of unfair
  intervals, but this was not needed for this problem.
</p>


  <div class="test-data-download-wrapper">
    <div class="test-data-download-header">
      <div class="test-data-download-header-text">Test Data</div>
      <div class="test-data-download-header-download-button">
        <a href="test_data.zip" target="_blank">
          <i class="material-icons grey">save_alt</i>
        </a>
      </div>
    </div>
    <div class="test-data-download-content">
      <div class="test-data-download-warning">
        <span class="material-icons" style="color: grey; vertical-align: middle;">info</span>
        <span style="vertical-align: middle;">We recommend that you practice debugging solutions without looking at the test data.</span>
      </div>
    </div>
  </div>



    </div>
  </body>
</html>
