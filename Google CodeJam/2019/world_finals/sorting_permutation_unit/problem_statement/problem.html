
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Code Jam 2019 - World Finals</h3><h1>Sorting Permutation Unit</h1><h3>Problem</h3>
<p>
  You may have heard of Google's Tensor Processing Units, which are used to
  build neural networks. However, there is one research area that is even
  deeper and more important than machine learning: sorting!
</p><p>
  We are working on a special new chip called the Sorting Permutation Unit,
  which is very fast at applying permutations to arrays of integers. Formally,
  a permutation is an ordering of the first n positive integers
</p><p>
  p<sub>1</sub>, p<sub>2</sub>, ..., p<sub>n</sub>
</p><p>
  and applying it to an array of n integers
</p><p>
  a<sub>1</sub>, a<sub>2</sub>, ..., a<sub>n</sub>
</p><p>
  yields the new array
</p><p>
  a<sub>p<sub>1</sub></sub>, a<sub>p<sub>2</sub></sub>, ...,
  a<sub>p<sub>n</sub></sub>.
</p><p>
  For example, applying the permutation 3, 1, 2, 4 to the array
  99, 234, 45, 800 would yield the new array 45, 99, 234, 800.
</p><p>
  However, permutations are expensive to represent in the hardware, so the unit
  can only have access to at most <b>P</b> distinct permutations. We need your
  help figuring out what those permutations should be!
</p><p>
  Given <b>K</b> arrays of <b>N</b> integers each, you must first specify up to
  <b>P</b> permutations (of size <b>N</b>) of your choice. Then, for each of
  those <b>K</b> input arrays, you must provide one sequence of up to <b>S</b>
  instructions (each of which is a permutation from your specified set). When
  the instructions in this sequence are applied, in the given order, to the
  array, they must yield an array sorted in nondecreasing order. In each of
  your <b>K</b> sequences of instructions, you may use each of your <b>P</b>
  permutations zero or more times (not necessarily consecutively).
</p>
<h3>Input</h3>
<p>
  The first line of the input gives the number of test cases, <b>T</b>.
  <b>T</b> test cases follow. Each begins with one line with four integers
  <b>P</b>, <b>S</b>, <b>K</b>, and <b>N</b>: the maximum number of
  permutations allowed, the maximum number of instructions you are allowed to
  use to sort each array, the number of arrays, and the number of integers in
  each array. Then, there are <b>K</b> more lines of <b>N</b> integers
  <b>A<sub>i1</sub></b>, <b>A<sub>i2</sub></b>, .., <b>A<sub>iN</sub></b>
  each, where the j-th integer on the i-th line, <b>A<sub>ij</sub></b>,
  represents the j-th value of the i-th array.
</p>

<h3>Output</h3>
<p>
  For each test case, first output the following, in this order:
</p>
<ul>
  <li>One line containing <code>Case #x:</code>, where <code>x</code> is the
    test case number (starting from 1).</li>
  <li>One line containing one integer P', where 1 &le; P' &le; <b>P</b>: the
    number of permutations you have chosen to use.</li>
  <li>P' lines, the i-th of which contains <b>N</b> integers
    p<sub>i1</sub> p<sub>i2</sub> ... p<sub>i<b>N</b></sub>, where
    <code>p<sub>ij</sub></code> is the j-th element of the i-th
    permutation.</li>
</ul>
<p>
  Then, output <b>K</b> more lines. The i-th of these gives the instructions
  that you will apply to the i-th array given in the input. Each such line
  must begin with one integer S', where 0 &le; S' &le; <b>S</b>, and must
  continue with S' integers X<sub>1</sub>, X<sub>2</sub>, ...,
  X<sub>S'</sub>, where 1 &le; X<sub>k</sub> &le; P' for all k.
  Here, X<sub>k</sub> represents that the k-th instruction you apply to the
  i-th array is the X<sub>k</sub>-th permutation (counting starting from 1) in
  your list of permutations. These instructions must yield an array with
  the elements of the i-th input array, sorted in nondecreasing order.
</p>

<h3>Limits</h3>
<p>
  Time limit: 20 seconds per test set.<br/>
  Memory limit: 1GB.<br/>
  1 &le; <b>T</b> &le; 10.<br/>
  <b>S</b> = 450.<br/>
  1 &le; <b>K</b> &le; 30.<br/>
  2 &le; <b>N</b> &le; 50.<br/>
  1 &le; <b>A<sub>ij</sub></b> &le; 1000, for all i and j.<br/>
</p>

<h4>Test set 1 (Visible)</h4>
<p>
  <b>P</b> = 20.<br/>
</p>

<h4>Test set 2 (Hidden)</h4>
<p>
  <b>P</b> = 5.<br/>
</p>


  <h3>Sample</h3>
  <div class="problem-io-wrapper-new">
    <div class="sampleio-wrapper">
      <div class="sample-input">
        <div class="sample-header">
          <div class="sample-header-text">Sample Input</div>
          <div class="sample-header-download-button">
            <a href="sorting_permutation_unit_sample_ts1_input.txt" target="_blank" aria-label="Download">
              <i class="material-icons grey">save_alt</i>
            </a>
          </div>
          <div class="sample-header-copy-button" onclick="
              const copyText = document.getElementById('sample_input_0').textContent;
              const textArea = document.createElement('textarea');
              textArea.textContent = copyText;
              textArea.style.position = 'absolute';
              textArea.style.left = '-100%';
              document.body.append(textArea);
              textArea.select();
              document.execCommand('copy');
              textArea.remove();
              const copyPopup = document.getElementById('sample_input_copy_popup_0');
              copyPopup.classList.add('sample-header-copy-popup-shown');
              setTimeout(function(){ copyPopup.classList.remove('sample-header-copy-popup-shown'); }, 2000);
          " aria-label="Copy to clipboard">
            <i class="material-icons grey">content_copy</i>
            <span class="sample-header-copy-popup" id="sample_input_copy_popup_0">
              Copied!
            </span>
          </div>
        </div>
        <div class="sample-content">
          <pre class="sample-content-text" id="sample_input_0">2
20 450 4 3
10 10 11
17 4 1000
999 998 997
10 10 11
20 450 5 5
1 2 3 4 5
2 3 4 5 1
3 4 5 1 2
4 5 1 2 3
5 1 2 3 4
</pre>
        </div>
      </div>
      <div class="sample-output">
        <div class="sample-header">
          <div class="sample-header-text">Sample Output</div>
          <div class="sample-header-download-button">
            <a href="sorting_permutation_unit_sample_ts1_output.txt" target="_blank" aria-label="Download">
              <i class="material-icons grey">save_alt</i>
            </a>
          </div>
          <div class="sample-header-copy-button" onclick="
              const copyText = document.getElementById('sample_output_0').textContent;
              const textArea = document.createElement('textarea');
              textArea.textContent = copyText;
              textArea.style.position = 'absolute';
              textArea.style.left = '-100%';
              document.body.append(textArea);
              textArea.select();
              document.execCommand('copy');
              textArea.remove();
              const copyPopup = document.getElementById('sample_output_copy_popup_0');
              copyPopup.classList.add('sample-header-copy-popup-shown');
              setTimeout(function(){ copyPopup.classList.remove('sample-header-copy-popup-shown'); }, 2000);
          " aria-label="Copy to clipboard">
            <i class="material-icons grey">content_copy</i>
            <span class="sample-header-copy-popup" id="sample_output_copy_popup_0">
              Copied!
            </span>
          </div>
        </div>
        <div class="sample-content">
          <pre class="sample-content-text" id="sample_output_0">Case #1:
2
3 1 2
2 1 3
0
1 2
2 2 1
1 2
Case #2:
1
5 1 2 3 4
0
1 1
2 1 1
3 1 1 1
4 1 1 1 1
</pre>
        </div>
      </div>
    </div>
  </div>


<p>
  In Sample Case #1, we can define up to <b>P</b> = 20 permutations. One
  viable strategy uses only these two:
</p>
<ol>
  <li>3 1 2</li>
  <li>2 1 3</li>
</ol>
<p>
  We can handle the four arrays as follows:
</p>
<ul>
  <li><code>10 10 11</code>: This is already sorted in nondecreasing order, so
    we do not need to do anything.</li>
  <li><code>17 4 1000</code>: We can apply permutation #2 to yield
    4 17 1000.</li>
  <li><code>999 998 997</code>: One option is to first apply permutation #2 to
    turn the array into 998 999 997, then apply permutation #1 to turn the array
    into 997 998 999.</li>
  <li><code>10 10 11</code>: This is the same as the first array. Applying
    permutation #2 also yields array sorted in nondecreasing order. (But we
    could have used the line <code>0</code> as we did before.)</li>
</ul>
<p>
  In Sample Case #2, notice that we can use the same permutation instruction
  more than once on the same array, if desired.
</p>

    </div>
  </body>
</html>
