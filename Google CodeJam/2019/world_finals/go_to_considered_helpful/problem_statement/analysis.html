
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Code Jam 2019 - World Finals</h3><h1>Analysis: Go To Considered Helpful</h1><p>
There are two kinds of programs: those that terminate, and those that don't!
</p><p>
For any set of instructions for Marlin that does not loop indefinitely (because it reaches the end
of the program), there is an equivalent program that has no goto instructions, and this is the
shortest way to write that program.
</p><p>
Similarly, if a program loops indefinitely, there is an equivalent program that consists only of
move instructions with a single goto at the end of the program, and this is the shortest way to
write that program.
</p><p>
So we only need to consider those two cases: programs that consist only of move instructions, and
programs with only a single goto, as the last instruction.  Then we take the shortest of all of
these.
</p><p>
We can easily find a minimal program of the first type with a breadth-first search (BFS) which
starts at <code>M</code> and stops when it reaches <code>N</code>, avoiding <code>#</code>s.
If the search terminates without reaching <code>N</code>, then we can output that the case is impossible.
</p><p>
Finding a minimal program of the second type is harder.  The program can be split into two sections
which compute two separate paths: an initial path P produced by the instructions which do not
repeat, and then a path Q which repeats until <code>N</code> is reached.
</p><p>
Let B be the point where P ends.  We can use a BFS, as in the previous case, to find a minimal P for
all possible points B.
</p><p>
Optimizing Q is slightly more involved.
The first time through Q, Marlin walks through some set of grid cells.  The second time through,
Marlin walks through grid cells of the same pattern, but offset by some displacement vector D.
This continues for
some number of iterations K until Marlin reaches the <code>N</code> cell.
So the first iteration of Q takes Marlin from B to B+D, but the path must avoid not only cells with
a <code>#</code>, but also cells which have an equivalent cell in a later iteration which is a <code>#</code>.
Additionally, the first iteration of Q must include a cell which, in a later iteration, will be <code>N</code>.
</p><p>
It is not easy to satisfy these constraints unless we already know the displacement D, and the
number of iterations, K.  So, we loop over all possibilities for these.
</p><p>
Inside this loop, we determine the shortest program for all possibilities for B, for the given
values of D and K.
We split Q into two parts, Q<sub>1</sub> and Q<sub>2</sub>.  Q<sub>1</sub> contains the instructions
which repeat K times, and reach
cell <code>N</code> on the final iteration.
Q<sub>2</sub> contains the instructions which only repeat K-1 times.  (If we reach <code>N</code> at
the end of an iteration, Q<sub>2</sub> is empty.)
</p><p>
Let N be the location of the cell containing <code>N</code>.
Q<sub>1</sub> is a path from B to N-(K-1)&times;D, and Q<sub>2</sub> is a path from N-(K-1)&times;D to B+D.
</p><p>
The path for Q<sub>1</sub> can only touch cells X such that X+i&times;D is empty for 0&lt;i&lt;K.
We do a BFS from
N-(K-1)&times;D, using these cells, to find an optimal Q<sub>1</sub> for all possibilities for B.
</p><p>
The path for Q<sub>2</sub> can only touch cells X such that X+i&times;D is empty for 0&lt;i&lt;K-1.
We do a BFS
from N-(K-1)&times;D, using these cells, to find an optimal Q<sub>2</sub> for all possibilties for B.
</p><p>
Finally, we loop over all possible cells for B, and sum up the lengths of the shortest P, Q<sub>1</sub> and
Q<sub>2</sub>, plus one for the goto statement.
</p>
<h4>
Running time
</h4>
<p>
Let max(<b>R</b>,<b>C</b>)=N.  For the outer loop that iterates over D and K, there are O(N<sup>2</sup>) choices for D and
O(N) choices for K.  However, not all combinations are possible.  If the number of iterations, K,
is large, then the displacement D for each iteration must be small; otherwise Marlin's path would
have to leave the grid to complete K iterations.  The total number of valid combinations of D and K
is O(N<sup>2</sup>) &mdash; we leave the proof as an exercise for the reader.
</p><p>
Inside the loop, setting up the grids for the BFS, running the two BFSs, and trying all values for
B all take O(N<sup>2</sup>) time.  So the loop takes O(N<sup>4</sup>) time.
</p><p>
The BFS outside the loop that computes all optimal paths P takes O(N<sup>2</sup>) time, and so does the
search for the optimal solution with no goto statements.
So the overall solution is O(N<sup>4</sup>), and runs fast enough to solve both test sets.
</p><p>
Being less careful can result in an O(N<sup>5</sup>) solution &mdash; for example, by doing O(K) work to check
whether a cell is valid for the two BFSs inside the loop.  This is sufficient to solve test set 1.
</p><p>
An exponential-time solution that naively tries all possibilities for Q is unlikely to work even for
test set 1, since the maximum length of Q is too large.
</p>


  <div class="test-data-download-wrapper">
    <div class="test-data-download-header">
      <div class="test-data-download-header-text">Test Data</div>
      <div class="test-data-download-header-download-button">
        <a href="test_data.zip" target="_blank">
          <i class="material-icons grey">save_alt</i>
        </a>
      </div>
    </div>
    <div class="test-data-download-content">
      <div class="test-data-download-warning">
        <span class="material-icons" style="color: grey; vertical-align: middle;">info</span>
        <span style="vertical-align: middle;">We recommend that you practice debugging solutions without looking at the test data.</span>
      </div>
    </div>
  </div>



    </div>
  </body>
</html>
