
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Code Jam 2019 - Round 2</h3><h1>Analysis: Pottery Lottery</h1><h3>A simple (but incorrect) approach</h3>
<p>
  Our tempting first thought might be: why not just put one of our tokens in
  each vase? Then we can sit back and just wait to win, no matter which vase
  gets chosen. Who needs the other 80 days?
</p><p>
  The flaw in this reasoning is that if multiple vases are tied for having the
  fewest tokens, there is no winner. A quick simulation can show us that there
  is only a unique winner around 57% of the time. So this approach has no
  hope of passing, and we have to work harder!
</p>
<h3>A slightly more complex (but also incorrect) approach</h3>
<p>
  It might still seem that we can succeed without inspecting any vases. What if
  we just choose one vase up front &mdash; without loss of generality, we will
  pick vase #20 &mdash; and try to make it the winning vase? Over the course
  of the first 99 nights, we distribute fake tokens among the other 19 vases,
  as evenly as possible (to prevent any one of those vases from becoming more
  of a threat than the others). The labels on these fake tokens do not matter,
  since we are banking on vase 20 winning. Then, on the 100th night, we place
  our token in vase 20. Since each of the other 19 vases will be burdened with
  5 (or maybe even 6) extra tokens, the odds are good that vase 20 will have
  the fewest, right?
</p><p>
  Unfortunately, those odds aren't so good. Again, we can write a quick
  simulation to verify that our strategy will only succeed around 53% of the
  time &mdash; it's even worse than the strategy above! The average "burden"
  that we add to the other vases just isn't large enough compared to the random
  variation in the number of tokens per vase. 
</p>
<h3>A better approach</h3>
<p>
  We will need to take advantage of our inspection ability, but when should
  we use it? There is not much value in inspecting early on in the lottery,
  since relatively few tokens will have been placed. On the other hand, if we
  inspect too late, we may not have enough nights left on which to react to
  whatever information we discover.
</p><p>
  We can devise a version of our first approach that also incorporates
  inspection. In this approach, V and N are parameters that we will have to
  discover:
</p>
<ol>
  <li>Choose to "give up on" the first V vases. We will assume that none of
    these will win, and so the labels on the tokens we add to them will not
    matter. Spend the first N nights sabotaging them (evenly).</li>
  <li>Spend the next 20 turns inspecting every vase, in order.</li>
  <li>Based on the results of our inspections, choose the vase with the fewest
    tokens (out of the remaining 20-V vases) to be our candidate winning
    vase.</li>
  <li>On each of the remaining 99 - 20 - N nights, choose a vase (other than
    our candidate vase) with the smallest number of tokens in our inspection
    results, and add a token to it. Then, update the inspection results to
    reflect this.</li>
  <li>On day 100, add our own token to the candidate vase.</li>
</ol>
<p>
  We might worry that our inspections are only snapshots in time that grow
  stale. By the time we inspect vase 20, our estimate for vase 1 is already
  out-of-date &mdash; what if more tokens have been added to it since then? To
  compare the estimates a little more fairly, we could adjust them by the
  expected number of tokens that have been added since the night of the
  estimate (i.e., the number of additional nights, divided by 20). This
  adjustment will be at most .95, which is less than a single full token, so
  the adjustments could only possibly be used to break ties among vases with
  the same number of tokens... and we can get the same effect by just choosing
  the vase with the highest-numbered ID in the event of a tie.
</p><p>
  It is not too hard to simulate this process, so we can try out different
  values of V and N to see what yields the best results, and find that V = 14,
  N = 60 works about 95% of the time. That gives us, per the binomial
  distribution, about a 99.96% chance of solving at least 225 out of 250 cases
  correctly. Since the problem only has one Visible test set, we should just
  submit and hope for the best!
</p>
<h3>Can we do even better?</h3>
<p>
  If we want to experiment further, there are even better solutions out there!
  Here is a variant of the above strategy; it succeeds over 98% of the time:
</p>
<ul>
  <li>Days 1-60: Put 4 tokens into each of vases 1-15.</li>
  <li>Days 61-80: Inspect every case. Find the <i>two</i> vases with the
    smallest number of tokens (breaking ties in favor of higher-numbered
    vases, as we will throughout this strategy), and designate them as
    candidates.</li>
  <li>Days 81-94: Greedily put a token into the non-candidate vase that
    has the smallest number of tokens, per our inspection results. Update
    those results.</li>
  <li>Days 95-96: Inspect the two candidates again and commit to the one
    with fewer tokens.</li>
  <li>Days 97-99: Sabotage the other candidate.</li>
</ul>
<p>
  If we hang onto two candidates, it is less likely that both of them will
  accumulate a lot of tokens via bad luck during the second sabotage phase. We
  benefit from delaying our decision point for as long as possible, while still
  leaving enough time to deal with our runner-up.
</p>


    </div>
  </body>
</html>
