
<html>
  <head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/external_hosted/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe"></script>
    <script>
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$$$','$$$'] ],
          displayMath: [ ['$$$$','$$$$'] ],
          skipTags: ["script","noscript","style","textarea","pre"],  // allow <code>.
          processEscapes: true
        },
        showProcessingMessages: false,
        messageStyle: "none",
        "HTML-CSS": { scale: 90, fonts: ["TeX"] }
      });
      MathJax.Ajax.loadComplete('https://codingcompetitions.withgoogle.com/static/mathjax-config.js');
      </script>
    <style>
.problem-io-wrapper-new .sampleio-wrapper {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  justify-content: flex-start;
  margin-top: 1rem;
  padding-left: 12.5px;
  padding-right: 12.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-input {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: -12.5px;
  margin-right: 12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-output {
  display: flex;
  flex-direction: column;
  flex: 1 1 0px;
  margin-left: 12.5px;
  margin-right: -12.5px;
  max-width: 50%;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-text {
  flex: 1;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-download-button {
  display: none;
  cursor: pointer;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button {
  display: none;
  cursor: pointer;
  position: relative;
  margin-left: 5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup {
  visibility: hidden;
  width: 100px;
  background-color: #999;
  color: #fff;
  text-align: center;
  border-radius: 3px;
  padding: 4px 0;
  position: absolute;
  z-index: 1;
  top: 125%;
  left: 50%;
  margin-left: -50px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup::before {
  content: "";
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent #999 transparent;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button .sample-header-copy-popup-shown {
  visibility: visible;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-header .sample-header-copy-button-hidden {
  display: none;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content {
  display: flex;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 0px 9.5px;
}
.problem-io-wrapper-new .sampleio-wrapper .sample-content .sample-content-text {
  flex-grow: 1;
  margin: 0px;
  overflow-x: auto;
  padding-bottom: 9.5px;
  line-height: normal;
  white-space: pre-wrap;
}
.test-data-download-wrapper {
  display: none;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  width: fit-content;
  max-width: 600px;
  margin-top: 1rem;
}
.test-data-download-wrapper .test-data-download-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-text {
  flex: 1;
}
.test-data-download-wrapper .test-data-download-header .test-data-download-header-download-button {
  display: none;
  cursor: pointer;
}
.test-data-download-wrapper .test-data-download-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #f5f5f5;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
  max-width: 600px;
  margin-top: 1rem;
}
.sample-interaction-wrapper .sample-interaction-header {
  display: flex;
  flex-direction: row;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
  border-top: 1px solid #ccc;
  border-radius: 4px 4px 0px 0px;
  padding: 9.5px 9.5px 7px 9.5px;
  font-family: 'Google Sans';
  font-size: 1.2rem;
  font-weight: 300;
}
.sample-interaction-wrapper .sample-interaction-header .sample-interaction-text {
  flex: 1;
}
.sample-interaction-wrapper .sample-interaction-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 0px 0px 4px 4px;
  background-color: #e6e6e6;
  padding: 9.5px 9.5px 9.5px 9.5px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-judge-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: left;
  flex-grow: 1;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-solution-labels .sample-interaction-solution-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: right;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper {
  display: flex;
  flex-direction: row;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-output-wrapper .sample-interaction-judge-output-box .sample-interaction-judge-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper {
  display: flex;
  flex-direction: row-reverse;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box {
  text-align: start;
  background: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 4px 8px;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-output-wrapper .sample-interaction-solution-output-box .sample-interaction-solution-output-test {
  margin: 0;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-judge-note {
  font-style: italic;
  color: #4e4e4e;
  margin-right: 20%;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-solution-note {
  font-style: italic;
  color: #4e4e4e;
  margin-left: 20%;
  text-align: end;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-section-label {
  font-weight: bold;
  color: #4e4e4e;
  text-align: center;
}
.sample-interaction-wrapper .sample-interaction-content .sample-interaction-block-spacer {
  height: 9.5px;
}
    </style>
  </head>
  <body>
    <div>
<h3>Code Jam 2011 - Round 2</h3><h1>Analysis: Expensive Dinner</h1><p>
This problem might look pretty intimidating at first:
</p>
<ul>
<li>There are <b>N</b>! possible orders in which your friends could arrive.</li>
<li>Not only is O(<b>N</b>!) too slow for this problem, even O(<b>N</b>) is too slow!</li>
<li>The actual price your friends are paying will quickly exceed the bounds of a 64-bit integer.</li>
</ul>
<p>
When O(<b>N</b>) is too slow, it means you need to forget about coding for a while and think. You will need some insight to even get started.
</p>

<p>
Let's begin by fixing an ordering (x<sub>1</sub>, x<sub>2</sub>, ..., x<sub><b>N</b></sub>) of your friends. Also let y<sub>i</sub> be the total price that your group is paying after the first i friends enter, the waiter has been called if necessary, and everyone has become happy.
</p>

<br/>
<p>
<b>Observation 1:</b> y<sub>i</sub> = LCM(x<sub>1</sub>, x<sub>2</sub>, ..., x<sub>i</sub>). This does not depend on the order your friends buy things after the waiter has been called.
</p>

<p>
<b>Explanation:</b> LCM(x<sub>1</sub>, x<sub>2</sub>, ..., x<sub>i</sub>) is, by definition, the smallest multiple of x<sub>1</sub>, x<sub>2</sub>, ..., x<sub>i</sub>. Since y<sub>i</sub> must be a multiple of all these numbers for your friends to be happy, it is certainly true that y<sub>i</sub> &ge; LCM(x<sub>1</sub>, x<sub>2</sub>, ..., x<sub>i</sub>). Conversely, a friend x<sub>j</sub> would never buy something that skips over a multiple of x<sub>j</sub>. In particular, none of the friends here would buy something that would skip over LCM(x<sub>1</sub>, x<sub>2</sub>, ..., x<sub>i</sub>). Since y<sub>i-1</sub> &le; LCM(x<sub>1</sub>, x<sub>2</sub>, ..., x<sub>i</sub>), you will eventually reach this price and then stop.
</p>
<br/>

<p>
Let <b>M</b> be the number of times the waiter is called over. Then, <b>M</b> is equal to the number of values i in {1, 2, ..., <b>N</b>} such that y<sub>i</sub> != y<sub>i-1</sub>. (We define y<sub>0</sub> = 0, because the waiter is always called over by the first friend who enters.) So the question becomes: how do we make <b>M</b> as big as possible according to this definition, and how do we make it as small as possible?
</p>

<p>
Least common multiples are closely related to prime numbers and factorizations, so let's define p<sub>1</sub>, p<sub>2</sub>, ..., p<sub><b>P</b></sub> to be the primes less than or equal to <b>N</b>. Also let e<sub>i</sub> be the largest integer such that p<sub>i</sub><sup>ei</sup> is less than or equal to <b>N</b>.
</p>

<p>
<br/>
<b>Observation 2:</b> Let <b>P'</b> be 1 + sum e<sub>i</sub> (i.e., the number of prime powers less than or equal to <b>N</b>, including 1). Then the maximum value of <b>M</b> is exactly equal to <b>P'</b>.
</p>

<p>
<b>Explanation:</b> Suppose your friends arrive in the order 1, 2, ..., <b>N</b>. Then each friend with a prime power index will cause the price to increase, and so the maximum value of <b>M</b> is at least <b>P'</b>.
</p>

<p>
On the other hand, the price is always a least-common multiple by the first observation, and it always increases to a multiple of itself. In particular, the sum of the exponents in its prime factorization must always go up every time the waiter is called. After the first friend arrives, this sum is at least 0. At the very end, it is equal to <b>P'</b> - 1. Therefore, the waiter can be called at most <b>P'</b> - 1 times after the first person arrives. Combining that with the initial increase proves that <b>M</b> &le; <b>P'</b>.
</p>

<p>
<br/>
<b>Observation 3:</b> If <b>N</b> &gt; 1, then the minimum value of <b>M</b> is equal to <b>P</b>.
</p>

<p>
<b>Explanation:</b> Suppose the first friends to arrive are numbered p<sub>1</sub><sup>e1</sup>, p<sub>2</sub><sup>e2</sup>, ..., p<sub><b>P</b></sub><sup>e<b>P</b></sup>. Then the price is already equal to
LCM(p<sub>1</sub><sup>e1</sup>, p<sub>2</sub><sup>e2</sup>, ..., p<sub><b>P</b></sub><sup>e<b>P</b></sup>) = LCM(1, 2, ..., <b>N</b>) after these friends have arrived. This means no subsequent friend will change the total price, and hence <b>M</b> = <b>P</b> in this case. 
</p>

<p>
On the other hand, notice there is no number less than <b>N</b> that is divisible by both <b>p</b><sub>i</sub><sup>ei</sup> and <b>p</b><sub>j</sub><sup>ej</sup>. This is because <b>p</b><sub>i</sub><sup>ei</sup> and <b>p</b><sub>i</sub><sup>ej</sup> are relatively prime and larger than sqrt(<b>N</b>). (If one of them was at most sqrt(<b>N</b>), then its exponent could be increased, which is a contradiction.) Therefore, no single friend can make the total price divisible by two different entries out of {p<sub>1</sub><sup>e1</sup>, p<sub>2</sub><sup>e2</sup>, ..., p<sub><b>P</b></sub><sup>e<b>P</b></sup>}. And so the waiter must be called at least <b>P</b> times, as claimed.
</p>
<br/>

<p>
To solve the small input, you can just calculate <b>P</b> and <b>P'</b> directly and go from there. The large input requires one last clever trick. The number of primes less than 10<sup>12</sup> is quite large, and you probably cannot afford to just count them all. However, calculating <b>P</b> - <b>P'</b> is actually easier than this!
</p>

<p>
If you go back to the original definitions, you can see <b>P</b> - <b>P'</b> is precisely the number of integers less than or equal to <b>N</b> that can be written in the form p<sup>e</sup> for e != 1. When e = 0, you just get 1. When e &gt; 1, then p &le; 10<sup>6</sup>, and you can easily enumerate all primes of this size! One good way is to use the <a href="http://www.google.com/search?q=sieve+of+eratosthenes" target="_blank">Sieve of Eratosthenes</a>. As always, you can look at solutions from other contestants to see a full implementation.
</p>

<br/>
<p>
<b>Bonus Comment:</b> The Sieve of Eratosthenes runs in O(<b>M</b> * log log <b>M</b>) time, so the simplest implementation of the method described here runs in O(sqrt(<b>N</b>) * <b>T</b> * log log <b>N</b>) time altogether. However, it's worth pointing out that you can do even better. If you pre-compute and sort all prime powers less than 10<sup>12</sup> with exponent other than one, you can then use a binary search to very efficiently count how many are less than <b>N</b> for each test case. This is not necessary to solve the problem, but it lets you speed things up even more to a blazing O(sqrt(<b>N</b>) * log log <b>N</b> + <b>T</b> * log <b>N</b>). Proving this running time is a little tricky though!
</p>


  <div class="test-data-download-wrapper">
    <div class="test-data-download-header">
      <div class="test-data-download-header-text">Test Data</div>
      <div class="test-data-download-header-download-button">
        <a href="test_data.zip" target="_blank">
          <i class="material-icons grey">save_alt</i>
        </a>
      </div>
    </div>
    <div class="test-data-download-content">
      <div class="test-data-download-warning">
        <span class="material-icons" style="color: grey; vertical-align: middle;">info</span>
        <span style="vertical-align: middle;">We recommend that you practice debugging solutions without looking at the test data.</span>
      </div>
    </div>
  </div>



    </div>
  </body>
</html>
